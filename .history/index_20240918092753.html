<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS S3 Image Gallery and Update Colors API Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .imageUrl {
            background-color: #f0f0f0;
            padding: 5px;
            border-radius: 3px;
            font-size: 0.8em;
            word-break: break-all;
            transition: background-color 0.3s ease;
        }

        .imageUrl:hover {
            background-color: #e0e0e0;
        }

        .tab {
            overflow: hidden;
            border: 1px solid #d3fb3e;
            background-color: #000000;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }

        h1,
        h2 {
            text-align: center;
        }

        #imageGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .imageItem {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .imageItem img {
            max-width: 100%;
            height: auto;
        }



        #uploadSection {
            margin-bottom: 30px;
            text-align: center;
        }

        #uploadedImageUrl {
            margin-top: 10px;
            font-weight: bold;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
            box-sizing: border-box;
        }

        button {
            margin-top: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .color-input {
            display: flex;
            align-items: center;
        }

        .color-input input[type="color"] {
            width: 50px;
            margin-right: 10px;
            padding: 0;
            height: 30px;
        }

        .color-input input[type="text"] {
            flex-grow: 1;
        }

        .ad-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            background-color: #f9f9f9;
        }

        .image-upload {
            margin-top: 10px;
        }

        .image-upload input[type="file"] {
            display: inline-block;
            width: auto;
        }

        .image-upload button {
            display: inline-block;
            margin-left: 10px;
        }

        .image-preview {
            max-width: 200px;
            margin-top: 10px;
            display: none;
        }

        .popup {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .popup-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .uploaded-url {
            word-break: break-all;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .image-selection {
            margin-top: 10px;
        }

        .image-selection select {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
        }
    </style>
</head>


<body>
    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'ImageGallery')" id="defaultOpen">AWS S3 Image
            Gallery</button>
        <button class="tablinks" onclick="openTab(event, 'UpdateColors')">Update Colors API Form</button>

        <button class="tablinks" onclick="openPropertyUpload()">Property Upload</button>

    </div>

    <div id="ImageGallery" class="tabcontent">
        <h1>AWS S3 Image Gallery</h1>

        <div id="uploadSection">
            <h2>Upload New Image</h2>
            <input type="file" id="imageUpload" accept="image/*">
            <button onclick="uploadImage()">Upload</button>
            <div id="uploadedImageUrl"></div>
        </div>

        <h2>Existing Images</h2>
        <div id="imageGrid"></div>
    </div>

    <div id="UpdateColors" class="tabcontent">
        <h1>Update Colors API Form</h1>
        <form id="updateForm">
            <h2>Header</h2>
            <div class="color-input">
                <input type="color" id="headerStartColor" value="#ffffff">
                <input type="text" name="header.startColor" value="#ffffff">
            </div>
            <div class="color-input">
                <input type="color" id="headerEndColor" value="#ffffff">
                <input type="text" name="header.endColor" value="#ffffff">
            </div>

            <h2>Button</h2>
            <div class="color-input">
                <input type="color" id="buttonStartColor" value="#ee0979">
                <input type="text" name="button.startColor" value="#ee0979">
            </div>
            <div class="color-input">
                <input type="color" id="buttonEndColor" value="#ff6a00">
                <input type="text" name="button.endColor" value="#ff6a00">
            </div>

            <h2>Button Background</h2>
            <div class="color-input">
                <input type="color" id="buttonBgStartColor" value="#ee0979">
                <input type="text" name="buttonBackground.startColor" value="#ee0979">
            </div>
            <div class="color-input">
                <input type="color" id="buttonBgEndColor" value="#ff6a00">
                <input type="text" name="buttonBackground.endColor" value="#ff6a00">
            </div>

            <h2>List Title Size</h2>
            <div class="color-input">
                <input type="color" id="listTitleColor" value="#333333">
                <input type="text" name="list_title_size.color" value="#333333">
            </div>
            <div class="color-input">
                <input type="color" id="listTitleBgColor" value="#f2f2f2">
                <input type="text" name="list_title_size.backgroundColor" value="#f2f2f2">
            </div>

            <h2>List Background</h2>
            <div class="color-input">
                <input type="color" id="listBgColor" value="#ededed">
                <input type="text" name="listbackground.backgroundColor" value="#ededed">
            </div>

            <h2>Search Filter</h2>
            <div class="color-input">
                <input type="color" id="searchFilterBgColor" value="#000000">
                <input type="text" name="search_filter.backgroundColor" value="#000000">
            </div>

            <h2>Other Settings</h2>
            <label for="listPriceSize">List Price Size:</label>
            <input type="number" id="listPriceSize" name="list_price_size" value="14">

            <div class="color-input">
                <input type="color" id="markerColor" value="#e1faeb">
                <input type="text" name="markerColor" value="#e1faeb">
            </div>

            <h2>Constant Data</h2>
            <label for="isPropertyUpload">Is Property Upload:</label>
            <select id="isPropertyUpload" name="constantData.isPropertyUpload">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="homeUrls">Home URLs:</label>
            <textarea id="homeUrls" name="constantData.homeUrls" rows="3"></textarea>

            <label for="isStrokeFilter">Is Stroke Filter:</label>
            <select id="isStrokeFilter" name="constantData.isStrokeFilter">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="isMaterialElevation">Is Material Elevation:</label>
            <select id="isMaterialElevation" name="constantData.isMaterialElevation">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="headerHeight">Header Height:</label>
            <input type="number" id="headerHeight" name="constantData.headerHeight" value="400">

            <label for="appPackageName">App Package Name:</label>
            <input type="text" id="appPackageName" name="constantData.appPackageName" value="">

            <label for="defaultLanguage">Default Language:</label>
            <input type="text" id="defaultLanguage" name="constantData.defaultLanguage" value="">

            <label for="currencyCode">Currency Code:</label>
            <input type="text" id="currencyCode" name="constantData.currencyCode" value="">

            <label for="appName">App Name:</label>
            <input type="text" id="appName" name="constantData.appName" value="">

            <label for="appEmail">App Email:</label>
            <input type="email" id="appEmail" name="constantData.appEmail" value="">

            <label for="appWebsite">App Website:</label>
            <input type="url" id="appWebsite" name="constantData.appWebsite" value="">

            <label for="facebookLink">Facebook Link:</label>
            <input type="url" id="facebookLink" name="constantData.facebookLink"
                value="https://www.geetikabuilders.in/gk/index.html">

            <label for="twitterLink">Twitter Link:</label>
            <input type="url" id="twitterLink" name="constantData.twitterLink" value="">

            <label for="instagramLink">Instagram Link:</label>
            <input type="url" id="instagramLink" name="constantData.instagramLink" value="">

            <label for="youtubeLink">YouTube Link:</label>
            <input type="url" id="youtubeLink" name="constantData.youtubeLink" value="">

            <label for="googlePlayLink">Google Play Link:</label>
            <input type="url" id="googlePlayLink" name="constantData.googlePlayLink" value="">

            <label for="appleStoreLink">Apple Store Link:</label>
            <input type="url" id="appleStoreLink" name="constantData.appleStoreLink" value="">

            <label for="appVersion">App Version:</label>
            <input type="text" id="appVersion" name="constantData.appVersion" value="">

            <label for="appUpdateHideShow">App Update Hide/Show:</label>
            <input type="text" id="appUpdateHideShow" name="constantData.appUpdateHideShow" value="">

            <label for="appUpdateVersionCode">App Update Version Code:</label>
            <input type="number" id="appUpdateVersionCode" name="constantData.appUpdateVersionCode" value="0">

            <label for="appUpdateDesc">App Update Description:</label>
            <textarea id="appUpdateDesc" name="constantData.appUpdateDesc" rows="3"></textarea>

            <label for="appUpdateLink">App Update Link:</label>
            <input type="url" id="appUpdateLink" name="constantData.appUpdateLink" value="">

            <label for="appUpdateCancelOption">App Update Cancel Option:</label>
            <input type="text" id="appUpdateCancelOption" name="constantData.appUpdateCancelOption" value="">

            <div class="color-input">
                <input type="color" id="priceColor" value="#000000">
                <input type="text" name="constantData.priceColor" value="#000000">
            </div>

            <div class="color-input">
                <input type="color" id="callButtonColor" value="#e1faeb">
                <input type="text" name="constantData.callButtonColor" value="#e1faeb">
            </div>

            <h3>Detail Page Button Color</h3>
            <div class="color-input">
                <input type="color" id="detailPageButtonStartColor" value="#e1faeb">
                <input type="text" name="constantData.DetailPageButtonColor.startColor" value="#e1faeb">
            </div>
            <div class="color-input">
                <input type="color" id="detailPageButtonEndColor" value="#e1faeb">
                <input type="text" name="constantData.DetailPageButtonColor.endColor" value="#e1faeb">
            </div>

            <label for="homePageLayoutOrder">Home Page Layout Order:</label>
            <input type="text" id="homePageLayoutOrder" name="constantData.homePageLayoutOrder" value="1,3,4,5,6">

            <label for="isCallDirect">Is Call Direct:</label>
            <select id="isCallDirect" name="constantData.isCallDirect">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="shadowOnImage">Shadow On Image:</label>
            <select id="shadowOnImage" name="constantData.shadowOnImage">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>


            <h2>Ads</h2>
            <div id="adsContainer">
                <div class="ad-item">
                    <h3>Ad 1</h3>
                    <label for="ad1Name">Name:</label>
                    <input type="text" id="ad1Name" name="ads[0].name" value="">

                    <label for="ad1Header">Header:</label>
                    <input type="text" id="ad1Header" name="ads[0].header" value="">

                    <label for="ad1PageLink">Page Link:</label>
                    <input type="url" id="ad1PageLink" name="ads[0].pagelink" value="">

                    <label for="ad1ImageLinks">Image Links (comma-separated):</label>
                    <input type="text" id="ad1ImageLinks" name="ads[0].imagelinks" value="">

                    <label for="ad1Contact">Contact Info (comma-separated):</label>
                    <input type="text" id="ad1Contact" name="ads[0].contact" value="">

                    <label for="ad1Type">Type:</label>
                    <select id="ad1Type" name="ads[0].type" onchange="showAdTypeFields(this)">
                        <option value="BANNER">Banner</option>
                        <option value="POPUP">Popup</option>
                        <option value="INTERSTITIAL">Interstitial</option>
                    </select>

                    <div class="banner-fields" style="display: none;">
                        <label for="ad1Width">Width:</label>
                        <input type="number" id="ad1Width" name="ads[0].width" value="">
                        <label for="ad1Height">Height:</label>
                        <input type="number" id="ad1Height" name="ads[0].height" value="">
                    </div>

                    <div class="popup-fields" style="display: none;">
                        <label for="ad1Delay">Delay (ms):</label>
                        <input type="number" id="ad1Delay" name="ads[0].delay" value="">
                    </div>

                    <div class="interstitial-fields" style="display: none;">
                        <label for="ad1Fullscreen">Fullscreen:</label>
                        <input type="checkbox" id="ad1Fullscreen" name="ads[0].fullscreen">
                    </div>
                </div>
            </div>

            <button type="button" id="addAdButton">Add Another Ad</button>

            <button type="submit">Submit</button>
        </form>
    </div>

    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">&times;</span>
            <p id="popup-message"></p>
        </div>
    </div>

    <div id="separateAdsManagement">
        <h2>Separate Ads Management</h2>
        <button type="button" id="addNewAdButton">Add New Ad</button>
        <button type="button" id="listAdsButton">List All Ads</button>
        <div id="adsList"></div>
    </div>
    
    <div id="adFormPopup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closeAdForm()">&times;</span>
            <h3>Ad Form</h3>
            <form id="separateAdForm">
                <input type="hidden" id="adId" name="adId">
                <label for="adName">Name:</label>
                <input type="text" id="adName" name="name" required>
                <label for="adHeader">Header:</label>
                <input type="text" id="adHeader" name="header">
                <label for="adPageLink">Page Link:</label>
                <input type="url" id="adPageLink" name="pagelink">
                <label for="adImageLinks">Image Links (comma-separated):</label>
                <input type="text" id="adImageLinks" name="imagelinks">
                <label for="adContact">Contact Info (comma-separated):</label>
                <input type="text" id="adContact" name="contact">
                <label for="adType">Type:</label>
                <select id="adType" name="type" onchange="showSeparateAdTypeFields()">
                    <option value="BANNER">Banner</option>
                    <option value="POPUP">Popup</option>
                    <option value="INTERSTITIAL">Interstitial</option>
                </select>
                <div id="separateBannerFields" style="display: none;">
                    <label for="adWidth">Width:</label>
                    <input type="number" id="adWidth" name="width">
                    <label for="adHeight">Height:</label>
                    <input type="number" id="adHeight" name="height">
                </div>
                <div id="separatePopupFields" style="display: none;">
                    <label for="adDelay">Delay (ms):</label>
                    <input type="number" id="adDelay" name="delay">
                </div>
                <div id="separateInterstitialFields" style="display: none;">
                    <label for="adFullscreen">Fullscreen:</label>
                    <input type="checkbox" id="adFullscreen" name="fullscreen">
                </div>
                <button type="submit">Save Ad</button>
            </form>
        </div>
    </div>

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1035.0.min.js"></script>
    <script>

function openPropertyUpload() {
        window.open('property-upload.html', '_blank');
    }
    
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Set the default open tab
        document.getElementById("defaultOpen").click();

        document.addEventListener('DOMContentLoaded', function () {
            openTab("ImageGallery");

            console.log('Script started');

            function openTab(tabName) {
                console.log('Opening tab:', tabName);
                var tabcontent = document.getElementsByClassName("tabcontent");
                for (var i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].classList.remove("active");
                }
                var tablinks = document.getElementsByClassName("tablinks");
                for (var i = 0; i < tablinks.length; i++) {
                    tablinks[i].classList.remove("active");
                }
                document.getElementById(tabName).classList.add("active");
                document.querySelector(`[data-tab="${tabName}"]`).classList.add("active");
            }
            // Set the default open tab
            document.getElementById("defaultOpen").click();

            openTab("ImageGallery");
            console.log('Default tab opened');
        });
        document.addEventListener('DOMContentLoaded', loadImages);



        // Add click event listeners to tab buttons
        var tabButtons = document.getElementsByClassName("tablinks");
        for (var i = 0; i < tabButtons.length; i++) {
            tabButtons[i].addEventListener("click", function (event) {
                openTab(event, this.getAttribute("onclick").split("'")[1]);
            });
        }

        async function loadImages() {
            const imageGrid = document.getElementById('imageGrid');
            const images = await fetchImagesFromS3();

            imageGrid.innerHTML = ''; // Clear existing images

            images.forEach(imageUrl => {
                const imageItem = document.createElement('div');
                imageItem.className = 'imageItem';

                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = 'AWS S3 Image';

                const urlText = document.createElement('p');
                urlText.className = 'imageUrl';
                urlText.textContent = imageUrl;
                urlText.title = 'Click to copy URL';
                urlText.style.cursor = 'pointer';

                urlText.onclick = function () {
                    navigator.clipboard.writeText(imageUrl).then(() => {
                        // Temporarily change the text to indicate it was copied
                        const originalText = urlText.textContent;
                        urlText.textContent = 'Copied!';
                        setTimeout(() => {
                            urlText.textContent = originalText;
                        }, 1500);
                    }, (err) => {
                        console.error('Could not copy text: ', err);
                    });
                };

                imageItem.appendChild(img);
                imageItem.appendChild(urlText);
                imageGrid.appendChild(imageItem);
            });
        }

        async function uploadImage() {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file to upload');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('uploadedFileName', file);

                const uploadResponse = await fetch('/imageUpload', {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error(`Upload failed: ${uploadResponse.status} ${uploadResponse.statusText}`);
                }

                const result = await uploadResponse.json();

                // Display the uploaded image URL
                const uploadedImageUrl = document.getElementById('uploadedImageUrl');
                uploadedImageUrl.textContent = `Uploaded Image URL: ${result.response_data.Location}`;

                // Reload the image grid
                await loadImages();
            } catch (error) {
                console.error('Error uploading image:', error);
                alert(`Failed to upload image: ${error.message}`);
            }
        }


        // AWS S3 Image Gallery functions
        async function fetchImagesFromS3() {
            try {
                const response = await fetch('/api/list-images');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching images:', error);
                alert('Failed to fetch images. Please try again.');
                return [];
            }
        }

        async function loadImages() {
            const imageGrid = document.getElementById('imageGrid');
            const images = await fetchImagesFromS3();

            imageGrid.innerHTML = ''; // Clear existing images

            images.forEach(imageUrl => {
                const imageItem = document.createElement('div');
                imageItem.className = 'imageItem';

                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = 'AWS S3 Image';

                const urlText = document.createElement('p');
                urlText.className = 'imageUrl';
                urlText.textContent = imageUrl;

                imageItem.appendChild(img);
                imageItem.appendChild(urlText);
                imageGrid.appendChild(imageItem);
            });
        }

        async function uploadImage() {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file to upload');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('uploadedFileName', file);

                const uploadResponse = await fetch('/imageUpload', {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error(`Upload failed: ${uploadResponse.status} ${uploadResponse.statusText}`);
                }

                const result = await uploadResponse.json();

                // Display the uploaded image URL
                const uploadedImageUrl = document.getElementById('uploadedImageUrl');
                uploadedImageUrl.textContent = `Uploaded Image URL: ${result.response_data.Location}`;

                // Reload the image grid
                await loadImages();
            } catch (error) {
                console.error('Error uploading image:', error);
                alert(`Failed to upload image: ${error.message}`);
            }
        }


        try {
            console.log('Script started');

            document.addEventListener('DOMContentLoaded', function () {
                console.log('DOM fully loaded and parsed');

                async function fetchImagesFromS3() {
                    try {
                        const response = await fetch('/api/list-images');
                        if (!response.ok) {
                            throw new Error('Failed to fetch images');
                        }
                        return await response.json();
                    } catch (error) {
                        console.error('Error fetching images:', error);
                        showPopup('Failed to fetch images. Please try again.');
                        return [];
                    }
                }

                async function handleFetchImages(fetchButton, previewContainer) {
                    fetchButton.disabled = true;
                    fetchButton.textContent = 'Fetching...';

                    try {
                        const imageUrls = await fetchImagesFromS3();
                        previewContainer.innerHTML = '';

                        imageUrls.forEach((url, index) => {
                            const img = document.createElement('img');
                            img.src = url;
                            img.alt = `Image ${index + 1}`;
                            img.style.width = '100px';
                            img.style.height = '100px';
                            img.style.objectFit = 'cover';
                            img.style.margin = '5px';
                            img.style.cursor = 'pointer';
                            img.onclick = () => selectImage(url, previewContainer.id);
                            previewContainer.appendChild(img);
                        });

                        previewContainer.style.display = 'flex';
                        previewContainer.style.flexWrap = 'wrap';
                    } catch (error) {
                        console.error('Error handling image fetch:', error);
                        showPopup('Failed to handle image fetch. Please try again.');
                    } finally {
                        fetchButton.disabled = false;
                        fetchButton.textContent = 'Fetch Existing Images';
                    }
                }

                function selectImage(url, containerId) {
                    const section = containerId.replace('PreviewContainer', '');
                    const previewImg = document.getElementById(`${section}Preview`);
                    const hiddenInput = document.getElementById(`${section}Hidden`);
                    const urlDisplay = document.getElementById(`${section}Url`);

                    previewImg.src = url;
                    previewImg.style.display = 'block';
                    hiddenInput.value = url;
                    if (urlDisplay) {
                        urlDisplay.textContent = url;
                        urlDisplay.style.display = 'block';
                    }

                    showPopup('Image selected successfully!');
                }

                async function handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay) {
                    console.log('handleImageUpload called');
                    const file = fileInput.files[0];
                    if (file) {
                        console.log('File selected:', file.name);
                        uploadButton.textContent = 'Uploading...';
                        uploadButton.disabled = true;

                        try {
                            const formData = new FormData();
                            formData.append('file', file);

                            const response = await fetch('/api/upload', {
                                method: 'POST',
                                body: formData
                            });

                            if (!response.ok) {
                                throw new Error('Upload failed');
                            }

                            const data = await response.json();
                            const fileUrl = data.url;

                            console.log('File uploaded successfully:', fileUrl);
                            previewImg.src = fileUrl;
                            previewImg.style.display = 'block';
                            hiddenInput.value = fileUrl;
                            if (urlDisplay) {
                                urlDisplay.textContent = fileUrl;
                                urlDisplay.style.display = 'block';
                            }
                            uploadButton.textContent = 'Upload Complete';
                            showPopup('File uploaded successfully!');
                        } catch (error) {
                            console.error('Upload error:', error);
                            uploadButton.textContent = 'Upload Failed';
                            showPopup('File upload failed. Please try again.');
                        } finally {
                            uploadButton.disabled = false;
                        }
                    } else {
                        console.log('No file selected');
                        showPopup('Please select a file to upload.');
                    }
                }

                ['AppLogo', 'AppCompany', 'AppContact'].forEach(section => {
                    const uploadButton = document.getElementById(`upload${section}`);
                    const fetchButton = document.getElementById(`fetchImages${section}`);
                    const fileInput = document.getElementById(section.toLowerCase());
                    const previewImg = document.getElementById(`${section.toLowerCase()}Preview`);
                    const hiddenInput = document.getElementById(`${section.toLowerCase()}Hidden`);
                    const urlDisplay = document.getElementById(`${section.toLowerCase()}Url`);
                    const previewContainer = document.getElementById(`${section.toLowerCase()}PreviewContainer`);

                    if (uploadButton && fileInput && previewImg && hiddenInput && fetchButton && previewContainer) {
                        console.log(`Setting up event listeners for ${section}`);
                        uploadButton.addEventListener('click', () => {
                            fileInput.click();
                        });
                        fileInput.addEventListener('change', () => {
                            console.log(`${section} file selected`);
                            handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay);
                        });
                        fetchButton.addEventListener('click', () => {
                            console.log(`${section} fetch button clicked`);
                            handleFetchImages(fetchButton, previewContainer);
                        });
                    } else {
                        console.error(`Missing elements for ${section}`);
                    }
                });
            });

            console.log('Event listener added');
        } catch (error) {
            console.error('Error in script:', error);
        }


        document.getElementById('updateForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('Form submission started');




            const formData = new FormData(this);
            const jsonData = {
                header: {
                    startColor: formData.get('header.startColor') || "#ffffff",
                    endColor: formData.get('header.endColor') || "#ffffff"
                },
                button: {
                    startColor: formData.get('button.startColor') || "#ee0979",
                    endColor: formData.get('button.endColor') || "#ff6a00"
                },
                buttonBackground: {
                    startColor: formData.get('buttonBackground.startColor') || "#ee0979",
                    endColor: formData.get('buttonBackground.endColor') || "#ff6a00"
                },
                list_title_size: {
                    color: formData.get('list_title_size.color') || "#333333",
                    backgroundColor: formData.get('list_title_size.backgroundColor') || "#f2f2f2"
                },
                listbackground: {
                    backgroundColor: formData.get('listbackground.backgroundColor') || "#ededed"
                },
                search_filter: {
                    backgroundColor: formData.get('search_filter.backgroundColor') || "#000000"
                },
                list_price_size: parseInt(formData.get('list_price_size')) || 14,
                markerColor: formData.get('markerColor') || "#e1faeb",
                constantData: {
                    isPropertyUpload: formData.get('constantData.isPropertyUpload') === 'true',
                    homeUrls: formData.get('constantData.homeUrls') ? formData.get('constantData.homeUrls').split(',') : [],
                    isStrokeFilter: formData.get('constantData.isStrokeFilter') === 'true',
                    isMaterialElevation: formData.get('constantData.isMaterialElevation') === 'true',
                    headerHeight: parseInt(formData.get('constantData.headerHeight')) || 400,
                    appPackageName: formData.get('constantData.appPackageName') || "",
                    defaultLanguage: formData.get('constantData.defaultLanguage') || "",
                    currencyCode: formData.get('constantData.currencyCode') || "",
                    appName: formData.get('constantData.appName') || "",
                    appEmail: formData.get('constantData.appEmail') || "",
                    appLogo: formData.get('constantData.appLogo') || "",
                    appCompany: formData.get('constantData.appCompany') || "",
                    appWebsite: formData.get('constantData.appWebsite') || "",
                    appContact: formData.get('constantData.appContact') || "",
                    facebookLink: formData.get('constantData.facebookLink') || "",
                    twitterLink: formData.get('constantData.twitterLink') || "",
                    instagramLink: formData.get('constantData.instagramLink') || "",
                    youtubeLink: formData.get('constantData.youtubeLink') || "",
                    googlePlayLink: formData.get('constantData.googlePlayLink') || "",
                    appleStoreLink: formData.get('constantData.appleStoreLink') || "",
                    appVersion: formData.get('constantData.appVersion') || "",
                    appUpdateHideShow: formData.get('constantData.appUpdateHideShow') || "",
                    appUpdateVersionCode: parseInt(formData.get('constantData.appUpdateVersionCode')) || 0,
                    appUpdateDesc: formData.get('constantData.appUpdateDesc') || "",
                    appUpdateLink: formData.get('constantData.appUpdateLink') || "",
                    appUpdateCancelOption: formData.get('constantData.appUpdateCancelOption') || "",
                    priceColor: formData.get('constantData.priceColor') || "#000000",
                    callButtonColor: formData.get('constantData.callButtonColor') || "#e1faeb",
                    DetailPageButtonColor: {
                        startColor: formData.get('constantData.DetailPageButtonColor.startColor') || "#e1faeb",
                        endColor: formData.get('constantData.DetailPageButtonColor.endColor') || "#e1faeb"
                    },
                    isCallDirect: formData.get('constantData.isCallDirect') === 'true',
                    homePageLayoutOrder: formData.get('constantData.homePageLayoutOrder')
                        ? formData.get('constantData.homePageLayoutOrder').split(',').map(Number)
                        : [1, 3, 4, 5, 6],
                    shadowOnImage: formData.get('constantData.shadowOnImage') === 'true'
                },
                ads: getAdsData()
            };
            console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

            console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

            try {
                const response = await fetch('https://propertify.onrender.com/api/colors/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                console.log('Success:', data);
                showPopup('Form submitted successfully!');
            } catch (error) {
                console.error('Error:', error);
                showPopup(`An error occurred while submitting the form: ${error.message}`);
            }
        });

        function showPopup(message) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            popupMessage.textContent = message;
            popup.style.display = 'block';

            // Hide the popup after 3 seconds
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function getAdsData() {
            console.log('getAdsData function called');
            const ads = [];
            const adItems = document.querySelectorAll('.ad-item');
            console.log('Number of ad items found:', adItems.length);

            adItems.forEach((item, index) => {
                console.log(`Processing ad item ${index + 1}`);
                const nameInput = item.querySelector(`input[name="ads[${index}].name"]`);
                const headerInput = item.querySelector(`input[name="ads[${index}].header"]`);
                const pageLinkInput = item.querySelector(`input[name="ads[${index}].pagelink"]`);
                const imageLinksInput = item.querySelector(`input[name="ads[${index}].imagelinks"]`);
                const contactInput = item.querySelector(`input[name="ads[${index}].contact"]`);
                const typeSelect = item.querySelector(`select[name="ads[${index}].type"]`);

                console.log('Input values:', {
                    name: nameInput ? nameInput.value : 'not found',
                    header: headerInput ? headerInput.value : 'not found',
                    pagelink: pageLinkInput ? pageLinkInput.value : 'not found',
                    imagelinks: imageLinksInput ? imageLinksInput.value : 'not found',
                    contact: contactInput ? contactInput.value : 'not found',
                    type: typeSelect ? typeSelect.value : 'not found'
                });

                const ad = {
                    name: nameInput ? nameInput.value.trim() : "",
                    header: headerInput ? headerInput.value.trim() : "",
                    pagelink: pageLinkInput ? pageLinkInput.value.trim() : "",
                    imagelinks: imageLinksInput ? imageLinksInput.value.split(',').map(link => link.trim()) : [],
                    contact: contactInput ? contactInput.value.split(',').map(contact => contact.trim()) : [],
                    type: {
                        type: typeSelect ? typeSelect.value : ""
                    }
                };

                if (ad.type.type === 'BANNER') {
                    ad.type.width = parseInt(item.querySelector(`input[name="ads[${index}].width"]`)?.value) || 0;
                    ad.type.height = parseInt(item.querySelector(`input[name="ads[${index}].height"]`)?.value) || 0;
                } else if (ad.type.type === 'POPUP') {
                    ad.type.delay = parseInt(item.querySelector(`input[name="ads[${index}].delay"]`)?.value) || 0;
                } else if (ad.type.type === 'INTERSTITIAL') {
                    ad.type.fullscreen = item.querySelector(`input[name="ads[${index}].fullscreen"]`)?.checked || false;
                }

                console.log('Processed ad object:', ad);

                // Only include the ad if it has any non-empty fields
                if (ad.name || ad.header || ad.pagelink || ad.imagelinks.length > 0 || ad.contact.length > 0) {
                    ads.push(ad);
                }
            });

            console.log('Final ads array:', ads);
            return ads;
        }

        function showAdTypeFields(selectElement) {
            const adItem = selectElement.closest('.ad-item');
            const bannerFields = adItem.querySelector('.banner-fields');
            const popupFields = adItem.querySelector('.popup-fields');
            const interstitialFields = adItem.querySelector('.interstitial-fields');

            bannerFields.style.display = 'none';
            popupFields.style.display = 'none';
            interstitialFields.style.display = 'none';

            switch (selectElement.value) {
                case 'BANNER':
                    bannerFields.style.display = 'block';
                    break;
                case 'POPUP':
                    popupFields.style.display = 'block';
                    break;
                case 'INTERSTITIAL':
                    interstitialFields.style.display = 'block';
                    break;
            }
        }



        document.addEventListener('DOMContentLoaded', function () {
            const addAdButton = document.getElementById('addAdButton');
            const adsContainer = document.getElementById('adsContainer');
            let adCount = 1;

            addAdButton.addEventListener('click', function () {
                adCount++;
                const newAdHtml = `
            <div class="ad-item">
                <h3>Ad ${adCount}</h3>
                <label for="ad${adCount}Name">Name:</label>
                <input type="text" id="ad${adCount}Name" name="ads[${adCount - 1}].name" value="">

                <label for="ad${adCount}Header">Header:</label>
                <input type="text" id="ad${adCount}Header" name="ads[${adCount - 1}].header" value="">

                <label for="ad${adCount}PageLink">Page Link:</label>
                <input type="url" id="ad${adCount}PageLink" name="ads[${adCount - 1}].pagelink" value="">

                <label for="ad${adCount}ImageLinks">Image Links (comma-separated):</label>
                <input type="text" id="ad${adCount}ImageLinks" name="ads[${adCount - 1}].imagelinks" value="">

                <label for="ad${adCount}Contact">Contact Info (comma-separated):</label>
                <input type="text" id="ad${adCount}Contact" name="ads[${adCount - 1}].contact" value="">

                <label for="ad${adCount}Type">Type:</label>
                <select id="ad${adCount}Type" name="ads[${adCount - 1}].type" onchange="showAdTypeFields(this)">
                    <option value="BANNER">Banner</option>
                    <option value="POPUP">Popup</option>
                    <option value="INTERSTITIAL">Interstitial</option>
                </select>

                <div class="banner-fields" style="display: none;">
                    <label for="ad${adCount}Width">Width:</label>
                    <input type="number" id="ad${adCount}Width" name="ads[${adCount - 1}].width" value="">
                    <label for="ad${adCount}Height">Height:</label>
                    <input type="number" id="ad${adCount}Height" name="ads[${adCount - 1}].height" value="">
                </div>

                <div class="popup-fields" style="display: none;">
                    <label for="ad${adCount}Delay">Delay (ms):</label>
                    <input type="number" id="ad${adCount}Delay" name="ads[${adCount - 1}].delay" value="">
                </div>

                <div class="interstitial-fields" style="display: none;">
                    <label for="ad${adCount}Fullscreen">Fullscreen:</label>
                    <input type="checkbox" id="ad${adCount}Fullscreen" name="ads[${adCount - 1}].fullscreen">
                </div>
            </div>
        `;
                adsContainer.insertAdjacentHTML('beforeend', newAdHtml);
            });
        });



        /////////////

        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM fully loaded and parsed=========>>>');
            async function fetchImagesFromS3() {
                try {
                    const response = await fetch('/api/list-images');
                    if (!response.ok) {
                        throw new Error('Failed to fetch images');
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Error fetching images:', error);
                    showPopup('Failed to fetch images. Please try again.');
                    return [];
                }
            }

            async function handleFetchImages(fetchButton, previewContainer) {
                fetchButton.disabled = true;
                fetchButton.textContent = 'Fetching...';

                try {
                    const imageUrls = await fetchImagesFromS3();
                    previewContainer.innerHTML = '';

                    imageUrls.forEach((url, index) => {
                        const img = document.createElement('img');
                        img.src = url;
                        img.alt = `Image ${index + 1}`;
                        img.style.width = '100px';
                        img.style.height = '100px';
                        img.style.objectFit = 'cover';
                        img.style.margin = '5px';
                        img.style.cursor = 'pointer';
                        img.onclick = () => selectImage(url, previewContainer.id);
                        previewContainer.appendChild(img);
                    });

                    previewContainer.style.display = 'flex';
                    previewContainer.style.flexWrap = 'wrap';
                } catch (error) {
                    console.error('Error handling image fetch:', error);
                    showPopup('Failed to handle image fetch. Please try again.');
                } finally {
                    fetchButton.disabled = false;
                    fetchButton.textContent = 'Fetch Existing Images';
                }
            }

            function selectImage(url, containerId) {
                const section = containerId.replace('PreviewContainer', '');
                const previewImg = document.getElementById(`${section}Preview`);
                const hiddenInput = document.getElementById(`${section}Hidden`);
                const urlDisplay = document.getElementById(`${section}Url`);

                previewImg.src = url;
                previewImg.style.display = 'block';
                hiddenInput.value = url;
                if (urlDisplay) {
                    urlDisplay.textContent = url;
                    urlDisplay.style.display = 'block';
                }

                showPopup('Image selected successfully!');
            }

            async function handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay) {
                console.log('handleImageUpload called');
                const file = fileInput.files[0];
                if (file) {
                    console.log('File selected:', file.name);
                    uploadButton.textContent = 'Uploading...';
                    uploadButton.disabled = true;

                    try {
                        const formData = new FormData();
                        formData.append('file', file);

                        const response = await fetch('/api/upload', {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            throw new Error('Upload failed');
                        }

                        const data = await response.json();
                        const fileUrl = data.url;

                        console.log('File uploaded successfully:', fileUrl);
                        previewImg.src = fileUrl;
                        previewImg.style.display = 'block';
                        hiddenInput.value = fileUrl;
                        if (urlDisplay) {
                            urlDisplay.textContent = fileUrl;
                            urlDisplay.style.display = 'block';
                        }
                        uploadButton.textContent = 'Upload Complete';
                        showPopup('File uploaded successfully!');
                    } catch (error) {
                        console.error('Upload error:', error);
                        uploadButton.textContent = 'Upload Failed';
                        showPopup('File upload failed. Please try again.');
                    } finally {
                        uploadButton.disabled = false;
                    }
                } else {
                    console.log('No file selected');
                    showPopup('Please select a file to upload.');
                }
            }

            async function uploadToS3(file) {
                console.log('Uploading to S3:', file.name);
                const response = await fetch(`/api/get-upload-url?fileName=${file.name}&fileType=${file.type}`);
                const { signedRequest, url } = await response.json();

                await fetch(signedRequest, {
                    method: 'PUT',
                    body: file,
                    headers: { 'Content-Type': file.type }
                });

                return url;
            }

            function showPopup(message) {
                console.log('Showing popup:', message);
                const popup = document.getElementById('popup');
                const popupMessage = document.getElementById('popup-message');
                popupMessage.textContent = message;
                popup.style.display = 'block';

                setTimeout(() => {
                    popup.style.display = 'none';
                }, 3000);
            }

            ['AppLogo', 'AppCompany', 'AppContact'].forEach(section => {
                const uploadButton = document.getElementById(`upload${section}`);
                const fetchButton = document.getElementById(`fetchImages${section}`);
                const fileInput = document.getElementById(section.toLowerCase());
                const previewImg = document.getElementById(`${section.toLowerCase()}Preview`);
                const hiddenInput = document.getElementById(`${section.toLowerCase()}Hidden`);
                const urlDisplay = document.getElementById(`${section.toLowerCase()}Url`);
                const previewContainer = document.getElementById(`${section.toLowerCase()}PreviewContainer`);

                if (uploadButton && fileInput && previewImg && hiddenInput && fetchButton && previewContainer) {
                    console.log(`Setting up event listeners for ${section}`);
                    uploadButton.addEventListener('click', () => {
                        fileInput.click(); // Trigger file input when upload button is clicked
                    });
                    fileInput.addEventListener('change', () => {
                        console.log(`${section} file selected`);
                        handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay);
                    });
                    fetchButton.addEventListener('click', () => {
                        console.log(`${section} fetch button clicked`);
                        handleFetchImages(fetchButton, previewContainer);
                    });
                } else {
                    console.error(`Missing elements for ${section}`);
                }
            });
        });

        console.log('Event listener added');

        document.getElementById('updateForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    console.log('Form submission started');

    try {
        const formData = new FormData(this);
        const jsonData = {
            header: {
                startColor: formData.get('header.startColor') || "#ffffff",
                endColor: formData.get('header.endColor') || "#ffffff"
            },
            button: {
                startColor: formData.get('button.startColor') || "#ee0979",
                endColor: formData.get('button.endColor') || "#ff6a00"
            },
            buttonBackground: {
                startColor: formData.get('buttonBackground.startColor') || "#ee0979",
                endColor: formData.get('buttonBackground.endColor') || "#ff6a00"
            },
            list_title_size: {
                color: formData.get('list_title_size.color') || "#333333",
                backgroundColor: formData.get('list_title_size.backgroundColor') || "#f2f2f2"
            },
            listbackground: {
                backgroundColor: formData.get('listbackground.backgroundColor') || "#ededed"
            },
            search_filter: {
                backgroundColor: formData.get('search_filter.backgroundColor') || "#000000"
            },
            list_price_size: parseInt(formData.get('list_price_size')) || 14,
            markerColor: formData.get('markerColor') || "#e1faeb",
            constantData: {
                // ... (keep all the constantData fields as they were)
            }
        };

        // Check if ads data is not empty
        const adsData = getAdsData();
        if (adsData.length > 0 && adsData.some(ad => Object.values(ad).some(value => value !== ''))) {
            jsonData.ads = adsData;
        }

        console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

        const response = await fetch('https://propertify.onrender.com/api/colors/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(jsonData)
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(`HTTP error! status: ${response.status}, message: ${JSON.stringify(errorData)}`);
        }

        const data = await response.json();
        console.log('Success:', data);
        showPopup('Form submitted successfully!');
    } catch (error) {
        console.error('Error:', error);
        showPopup(`An error occurred while submitting the form: ${error.message}`);
    }
});






        function showPopup(message) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            popupMessage.textContent = message;
            popup.style.display = 'block';

            // Hide the popup after 3 seconds
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function showSeparateAdTypeFields() {
    const adType = document.getElementById('adType').value;
    document.getElementById('separateBannerFields').style.display = adType === 'BANNER' ? 'block' : 'none';
    document.getElementById('separatePopupFields').style.display = adType === 'POPUP' ? 'block' : 'none';
    document.getElementById('separateInterstitialFields').style.display = adType === 'INTERSTITIAL' ? 'block' : 'none';
}

// Function to open ad form popup
function openSeparateAdForm(ad = null) {
    const form = document.getElementById('separateAdForm');
    form.reset();
    if (ad) {
        // Populate form for editing
        Object.keys(ad).forEach(key => {
            const input = form.elements[key];
            if (input) {
                if (input.type === 'checkbox') {
                    input.checked = ad[key];
                } else if (key === 'type') {
                    input.value = ad[key].type;
                } else {
                    input.value = Array.isArray(ad[key]) ? ad[key].join(', ') : ad[key];
                }
            }
        });
        document.getElementById('adId').value = ad._id;
    } else {
        document.getElementById('adId').value = '';
    }
    showSeparateAdTypeFields();
    document.getElementById('adFormPopup').style.display = 'block';
}

// Function to close ad form popup
function closeSeparateAdForm() {
    document.getElementById('adFormPopup').style.display = 'none';
}

// Function to add or update an ad
function openSeparateAdForm(ad = null) {
    const form = document.getElementById('separateAdForm');
    form.reset();
    if (ad) {
        // Populate form for editing
        Object.keys(ad).forEach(key => {
            const input = form.elements[key];
            if (input) {
                if (input.type === 'checkbox') {
                    input.checked = ad[key];
                } else if (key === 'type') {
                    input.value = ad[key].type;
                } else if (key === 'imagelinks' || key === 'contact') {
                    input.value = ad[key].join(', ');
                } else {
                    input.value = ad[key];
                }
            }
        });
        document.getElementById('adId').value = ad._id;
    } else {
        document.getElementById('adId').value = '';
    }
    showSeparateAdTypeFields();
    document.getElementById('adFormPopup').style.display = 'block';
}

// Function to add or update an ad
async function saveSeparateAd(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const adData = Object.fromEntries(formData.entries());
    
    adData.type = { type: adData.type };

    // Add type-specific fields
    if (adData.type.type === 'BANNER') {
        adData.type.width = parseInt(adData.width) || 0;
        adData.type.height = parseInt(adData.height) || 0;
    } else if (adData.type.type === 'POPUP') {
        adData.type.delay = parseInt(adData.delay) || 0;
    } else if (adData.type.type === 'INTERSTITIAL') {
        adData.type.fullscreen = adData.fullscreen === 'on';
    }

    // Convert imagelinks and contact to arrays
    adData.imagelinks = adData.imagelinks.split(',').map(link => link.trim());
    adData.contact = adData.contact.split(',').map(contact => contact.trim());

    try {
        // Fetch existing ads
        const response = await fetch('https://propertify.onrender.com/api/colors/ads');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        let ads = await response.json();

        if (adData.adId) {
            // Edit existing ad
            const index = ads.findIndex(ad => ad._id === adData.adId);
            if (index !== -1) {
                ads[index] = { ...ads[index], ...adData };
            }
        } else {
            // Add new ad
            ads.push(adData);
        }

        // Update all ads
        const updateResponse = await fetch('https://propertify.onrender.com/api/colors/update-ads', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ads: ads })
        });

        if (!updateResponse.ok) {
            throw new Error(`HTTP error! status: ${updateResponse.status}`);
        }

        console.log('Ad saved successfully');
        closeSeparateAdForm();
        listSeparateAds(); // Refresh the ads list
    } catch (error) {
        console.error('Error saving ad:', error);
        alert('Failed to save ad. Please try again.');
    }
}

// Function to list all ads
async function listSeparateAds() {
    try {
        const response = await fetch('https://propertify.onrender.com/api/colors/ads');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const ads = await response.json();
        const adsList = document.getElementById('adsList');
        adsList.innerHTML = '';
        ads.forEach(ad => {
            const adElement = document.createElement('div');
            adElement.innerHTML = `
                <h4>${ad.name}</h4>
                <p>Type: ${ad.type.type}</p>
                <button onclick='openSeparateAdForm(${JSON.stringify(ad)})'>Edit</button>
                <button onclick="deleteSeparateAd('${ad._id}')">Delete</button>
            `;
            adsList.appendChild(adElement);
        });
    } catch (error) {
        console.error('Error listing ads:', error);
        alert('Failed to list ads. Please try again.');
    }
}

// Function to delete an ad
async function deleteSeparateAd(adId) {
    if (confirm('Are you sure you want to delete this ad?')) {
        try {
            // Fetch existing ads
            const response = await fetch('https://propertify.onrender.com/api/colors/ads');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            let ads = await response.json();

            // Remove the ad with the given adId
            ads = ads.filter(ad => ad._id !== adId);

            // Update ads
            const updateResponse = await fetch('https://propertify.onrender.com/api/colors/update-ads', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ads: ads })
            });

            if (!updateResponse.ok) {
                throw new Error(`HTTP error! status: ${updateResponse.status}`);
            }

            console.log('Ad deleted successfully');
            listSeparateAds(); // Refresh the ads list
        } catch (error) {
            console.error('Error deleting ad:', error);
            alert('Failed to delete ad. Please try again.');
        }
    }
    if (confirm('Are you sure you want to delete this ad?')) {
        try {
            const response = await fetch(`https://propertify.onrender.com/api/colors/ads/${adId}`, {
                method: 'DELETE'
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            console.log('Ad deleted successfully');
            listSeparateAds(); // Refresh the ads list
        } catch (error) {
            console.error('Error deleting ad:', error);
            alert('Failed to delete ad. Please try again.');
        }
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('addNewAdButton').addEventListener('click', () => openSeparateAdForm());
    document.getElementById('listAdsButton').addEventListener('click', listSeparateAds);
    document.getElementById('separateAdForm').addEventListener('submit', saveSeparateAd);
});

    </script>
</body>

</html>