<!DOCTYPE html>
<html lang="en">
    <link rel="stylesheet" href="./styles.css">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFO Core</title>
    <link rel="stylesheet" href="./styles.css">

    <style>



.project-form-section {
    padding: 20px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.grid-2-cols {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.grid-3-cols {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 1rem;
}

.map-container {
    height: 300px;
    margin: 1rem 0;
    border-radius: 4px;
}

.floor-plan-item {
    border: 1px solid #ddd;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 4px;
}

.amenity-category,
.gallery-category {
    border: 1px solid #ddd;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 4px;
}

.project-card {
    border: 1px solid #ddd;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 4px;
    background: #fff;
}

.project-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
}

.project-status.upcoming {
    background: #fff3cd;
    color: #856404;
}

.project-status.under_construction {
    background: #cce5ff;
    color: #004085;
}

.project-status.completed {
    background: #d4edda;
    color: #155724;
}

.secondary-button {
    background: #6c757d;
    color: white;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.remove-button {
    background: #dc3545;
    color: white;
    padding: 0.25rem 0.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 0.5rem;
}
        .property-select-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 4px;
        }

        .search-box {
            margin-top: 1rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #eee;
            border-radius: 4px;
        }

        .grid-2-cols {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .image-preview-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
            margin-top: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .gallery-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .gallery-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .save-button {
            background: #4CAF50;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .cancel-button {
            background: #f44336;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .modified {
            border-color: #4CAF50;
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .imageUrl {
            background-color: #f0f0f0;
            padding: 5px;
            border-radius: 3px;
            font-size: 0.8em;
            word-break: break-all;
            transition: background-color 0.3s ease;
        }

        .imageUrl:hover {
            background-color: #e0e0e0;
        }

        .tab {
            overflow: hidden;
            border: 1px solid #d3fb3e;
            background-color: #000000;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }

        .property-select-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 4px;
        }

        .search-box {
            margin-top: 1rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        #propertyEditForm {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            padding: 1rem;
        }

        #propertyEditForm .full-width {
            grid-column: 1 / -1;
        }

        .form-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #eee;
            border-radius: 4px;
            grid-column: 1 / -1;
        }

        .image-preview-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
            margin-top: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .gallery-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .gallery-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
        }

        .form-actions {
            grid-column: 1 / -1;
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .save-button,
        .cancel-button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .save-button {
            background: #4CAF50;
            color: white;
        }

        .cancel-button {
            background: #f44336;
            color: white;
        }

        .modified {
            border-color: #4CAF50;
            background-color: #f0fff0;
        }

        .chip-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .chip {
            background: #e0e0e0;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chip button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0;
            font-size: 1.2rem;
        }

        .map-container {
            height: 400px;
            margin: 1rem 0;
            border-radius: 4px;
            overflow: hidden;
        }

        select[multiple] {
            height: auto;
            min-height: 120px;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }



        h1,
        h2 {
            text-align: center;
        }

        #imageGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .imageItem {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .imageItem img {
            max-width: 100%;
            height: auto;
        }



        #uploadSection {
            margin-bottom: 30px;
            text-align: center;
        }

        #uploadedImageUrl {
            margin-top: 10px;
            font-weight: bold;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
            box-sizing: border-box;
        }

        button {
            margin-top: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .color-input {
            display: flex;
            align-items: center;
        }

        .color-input input[type="color"] {
            width: 50px;
            margin-right: 10px;
            padding: 0;
            height: 30px;
        }

        .color-input input[type="text"] {
            flex-grow: 1;
        }

        .ad-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            background-color: #f9f9f9;
        }

        .image-upload {
            margin-top: 10px;
        }

        .image-upload input[type="file"] {
            display: inline-block;
            width: auto;
        }

        .image-upload button {
            display: inline-block;
            margin-left: 10px;
        }

        .image-preview {
            max-width: 200px;
            margin-top: 10px;
            display: none;
        }

        .popup {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .popup-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .uploaded-url {
            word-break: break-all;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .image-selection {
            margin-top: 10px;
        }

        .image-selection select {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
        }

        .delete-button {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            margin-top: 10px;
        }

        .delete-button:hover {
            background-color: #cc0000;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            padding: 15px;
        }

        .grid-item {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 0.9em;
            background-color: #f9f9f9;
        }

        .grid-item.building {
            background-color: #e6f3ff;
        }

        .grid-item.property {
            background-color: #fff0e6;
        }

        .grid-item img {
            max-width: 100%;
            height: 120px;
            object-fit: cover;
            margin-bottom: 10px;
        }

        .building-properties {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 5px;
            background-color: #ffffff;
            border: 1px solid #ddd;
        }

        .property-item {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        #searchInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
        }

        .connect-property {
            margin-top: 10px;
        }

        .connect-property select {
            width: 70%;
            padding: 5px;
        }

        .connect-property button {
            width: 28%;
            padding: 5px;
            margin-left: 2%;
        }

        .property-upload-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .property-upload-form label {
            display: block;
            margin-bottom: 5px;
        }

        .property-upload-form input,
        .property-upload-form select,
        .property-upload-form textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        .property-upload-form .full-width {
            grid-column: 1 / -1;
        }

        .image-upload-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
        }

        .property-upload-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .property-upload-form .full-width {
            grid-column: 1 / -1;
        }

        .map-container {
            height: 400px;
            margin-bottom: 15px;
        }

        .chip-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }

        .chip {
            background-color: #e0e0e0;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
        }

        select[multiple] {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        select[multiple] option {
            padding: 8px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        select[multiple] option:checked {
            background-color: #e0e0e0;
            color: #000;
            font-weight: bold;
        }

        select[multiple] option:hover {
            background-color: #f0f0f0;
        }

        .chip button {
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 5px;
        }

        .option-item {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 4px;
            background-color: #f9f9f9;
        }

        .option-content {
            margin-bottom: 10px;
        }

        .option-actions {
            display: flex;
            gap: 10px;
        }

        .edit-button,
        .delete-button {
            padding: 5px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .edit-button {
            background-color: #4CAF50;
            color: white;
        }

        .delete-button {
            background-color: #f44336;
            color: white;
        }

        #propertyUploadForm {
            position: relative;
        }

        #propertyUploadForm button[type="submit"] {
            position: relative;
            z-index: 1;
        }

        .edit-button:hover,
        .delete-button:hover {
            opacity: 0.8;
        }
    </style>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCAxLPWJ3If855zICuSdKNWCYrSDhPauVM&libraries=places"></script>


    const styleSheet = document.createElement('style');
    styleSheet.textContent = styles;
    document.head.appendChild(styleSheet);

</head>

<body>

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'ImageGallery')" id="defaultOpen">AWS S3 Image Gallery</button>
        <button class="tablinks" onclick="openTab(event, 'UpdateColors')">Update Colors API Form</button>
        <button class="tablinks" onclick="openTab(event, 'ListOptions')">List Options</button>
        <button class="tablinks" onclick="openTab(event, 'NewListOption')">New List Option</button>
        <button class="tablinks" onclick="openTab(event, 'BuildingsProperties')">Buildings & Properties</button>
        <button class="tablinks" onclick="openTab(event, 'PropertyUpload')">Upload Property</button>
        <button class="tablinks" onclick="openTab(event, 'BuildingUpload')">Upload Building</button>
        <button class="tablinks" onclick="openTab(event, 'DeeplinkGenerator')">Deeplink Generator</button>
        <button class="tablinks" onclick="openTab(event, 'CategoryManagement')">Category Management</button>
        <button class="tablinks" onclick="openTab(event, 'CarouselManagement')">Carousel Management</button>
        <button class="tablinks" onclick="openTab(event, 'BuilderUpload')">Builder Upload</button>
        <button class="tablinks" onclick="openTab(event, 'ProjectManagement')">Project Management</button>
    </div>

    


    <div id="ProjectManagement" class="tabcontent">
        <h1>Project Management</h1>
        
        <!-- Project List Section -->
        <div class="projects-list-section">
            <h2>Existing Projects</h2>
            <input type="text" id="projectSearch" placeholder="Search projects..." class="search-input">
            <div id="projectsList"></div>
        </div>
    
        <!-- Project Upload Form -->
        <div class="project-form-section">
            <h2>Create/Edit Project</h2>
            <form id="projectUploadForm">
                <input type="hidden" id="projectEditId">
                
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="grid-2-cols">
                        <div>
                            <label for="projectName">Project Name*:</label>
                            <input type="text" id="projectName" name="name" required>
                        </div>
                        <div>
                            <label for="projectType">Project Type*:</label>
                            <select id="projectType" name="type" required>
                                <option value="RESIDENTIAL">Residential</option>
                                <option value="COMMERCIAL">Commercial</option>
                                <option value="MIXED_USE">Mixed Use</option>
                            </select>
                        </div>
                        <div>
                            <label for="projectStatus">Status:</label>
                            <select id="projectStatus" name="status">
                                <option value="UPCOMING">Upcoming</option>
                                <option value="UNDER_CONSTRUCTION">Under Construction</option>
                                <option value="COMPLETED">Completed</option>
                            </select>
                        </div>
                        <div>
                            <label for="builderSelect">Builder*:</label>
                            <select id="builderSelect" name="builder" required>
                                <option value="">Select Builder</option>
                            </select>
                        </div>
                    </div>
    
                    <label for="projectDescription">Description:</label>
                    <textarea id="projectDescription" name="description" rows="4"></textarea>
                </div>
    
                <!-- Overview Section -->
                <div class="form-section">
                    <h3>Project Overview</h3>
                    <div class="grid-2-cols">
                        <div>
                            <label for="totalUnits">Total Units:</label>
                            <input type="number" id="totalUnits" name="overview.totalUnits">
                        </div>
                        <div>
                            <label for="totalTowers">Total Towers:</label>
                            <input type="number" id="totalTowers" name="overview.totalTowers">
                        </div>
                        <div>
                            <label for="launchDate">Launch Date:</label>
                            <input type="date" id="launchDate" name="overview.launchDate">
                        </div>
                        <div>
                            <label for="possessionDate">Possession Date:</label>
                            <input type="date" id="possessionDate" name="overview.possessionDate">
                        </div>
                    </div>
    
                    <!-- Price Range -->
                    <h4>Price Range</h4>
                    <div class="grid-3-cols">
                        <div>
                            <label for="priceMin">Minimum Price (₹):</label>
                            <input type="number" id="priceMin" name="overview.priceRange.min">
                        </div>
                        <div>
                            <label for="priceMax">Maximum Price (₹):</label>
                            <input type="number" id="priceMax" name="overview.priceRange.max">
                        </div>
                        <div>
                            <label for="pricePerSqFt">Price per sq.ft (₹):</label>
                            <input type="number" id="pricePerSqFt" name="overview.priceRange.pricePerSqFt">
                        </div>
                    </div>
                </div>
    
                <!-- Location Section -->
                <div class="form-section">
                    <h3>Location Details</h3>
                    <div class="grid-2-cols">
                        <div>
                            <label for="projectAddress">Address*:</label>
                            <input type="text" id="projectAddress" name="location.address" required>
                        </div>
                        <div>
                            <label for="projectLandmark">Landmark:</label>
                            <input type="text" id="projectLandmark" name="location.landmark">
                        </div>
                        <div>
                            <label for="projectCity">City*:</label>
                            <input type="text" id="projectCity" name="location.city" required>
                        </div>
                        <div>
                            <label for="projectState">State*:</label>
                            <input type="text" id="projectState" name="location.state" required>
                        </div>
                    </div>
                    
                    <!-- Map Location -->
                    <div class="map-section">
                        <label>Location on Map:</label>
                        <div id="projectMap" class="map-container"></div>
                        <input type="hidden" id="projectLatitude" name="location.coordinates[1]">
                        <input type="hidden" id="projectLongitude" name="location.coordinates[0]">
                    </div>
                </div>
    
                <!-- Floor Plans Section -->
                <div class="form-section">
                    <h3>Floor Plans</h3>
                    <div id="floorPlansContainer"></div>
                    <button type="button" onclick="addFloorPlan()" class="secondary-button">Add Floor Plan</button>
                </div>
    
                <!-- Amenities Section -->
                <div class="form-section">
                    <h3>Amenities</h3>
                    <div id="amenitiesContainer">
                        <div class="amenity-category">
                            <input type="text" placeholder="Category Name" class="category-input">
                            <div class="amenity-items">
                                <input type="text" placeholder="Amenity Item" class="amenity-input">
                            </div>
                            <button type="button" onclick="addAmenityItem(this)" class="small-button">Add Item</button>
                        </div>
                    </div>
                    <button type="button" onclick="addAmenityCategory()" class="secondary-button">Add Category</button>
                </div>
    
                <!-- Specification Section -->
                <div class="form-section">
                    <h3>Specifications</h3>
                    <div id="specificationsContainer">
                        <!-- Specifications will be added dynamically -->
                    </div>
                    <button type="button" onclick="addSpecificationCategory()" class="secondary-button">Add Specification Category</button>
                </div>
    
                <!-- Gallery Section -->
                <div class="form-section">
                    <h3>Project Gallery</h3>
                    <div id="galleryContainer">
                        <div class="gallery-category">
                            <input type="text" placeholder="Category Name" class="category-input">
                            <input type="file" multiple accept="image/*" class="gallery-input">
                            <div class="gallery-preview"></div>
                        </div>
                    </div>
                    <button type="button" onclick="addGalleryCategory()" class="secondary-button">Add Gallery Category</button>
                </div>
    
                <!-- Phases Section -->
                <div class="form-section">
                    <h3>Project Phases</h3>
                    <div id="phasesContainer"></div>
                    <button type="button" onclick="addPhase()" class="secondary-button">Add Phase</button>
                </div>
    
                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="save-button">Save Project</button>
                    <button type="button" class="cancel-button" onclick="resetProjectForm()">Reset</button>
                </div>
            </form>
        </div>
        
    </div>


<!-- Add this new tab content -->
<div id="BuilderUpload" class="tabcontent">
    <h1>Builder Management</h1>
    
    <!-- Builder Upload Form -->
    <div class="builder-form-section">
        <h2>Upload Builder</h2>
        <form id="builderUploadForm">
            <!-- Basic Information -->
            <div class="form-section">
                <h3>Basic Information</h3>
                <div class="grid-2-cols">
                    <div>
                        <label for="builderName">Builder Name*:</label>
                        <input type="text" id="builderName" name="name" required>
                    </div>
                    <div>
                        <label for="builderLogo">Logo URL:</label>
                        <input type="text" id="builderLogo" name="logo">
                    </div>
                    <div>
                        <label for="builderExperience">Experience (years)*:</label>
                        <input type="number" id="builderExperience" name="experience" required>
                    </div>
                    <div>
                        <label for="builderEstablished">Established Year*:</label>
                        <input type="number" id="builderEstablished" name="established" required>
                    </div>
                </div>
                
                <label for="builderDescription">Description:</label>
                <textarea id="builderDescription" name="description" rows="4"></textarea>
            </div>

            <!-- Contact Information -->
            <div class="form-section">
                <h3>Contact Information</h3>
                <div class="grid-2-cols">
                    <div>
                        <label for="builderEmail">Email:</label>
                        <input type="email" id="builderEmail" name="contact.email">
                    </div>
                    <div>
                        <label for="builderPhone">Phone:</label>
                        <input type="tel" id="builderPhone" name="contact.phone">
                    </div>
                    <div>
                        <label for="builderWebsite">Website:</label>
                        <input type="url" id="builderWebsite" name="contact.website">
                    </div>
                </div>
                
                <!-- Address -->
                <h4>Office Address</h4>
                <div class="grid-2-cols">
                    <div>
                        <label for="builderStreet">Street:</label>
                        <input type="text" id="builderStreet" name="contact.address.street">
                    </div>
                    <div>
                        <label for="builderCity">City:</label>
                        <input type="text" id="builderCity" name="contact.address.city">
                    </div>
                    <div>
                        <label for="builderState">State:</label>
                        <input type="text" id="builderState" name="contact.address.state">
                    </div>
                    <div>
                        <label for="builderPincode">Pincode:</label>
                        <input type="text" id="builderPincode" name="contact.address.pincode">
                    </div>
                </div>
                
                <!-- Location Map -->
                <div class="map-section">
                    <label>Office Location:</label>
                    <div id="builderMap" class="map-container"></div>
                    <input type="hidden" id="builderLatitude" name="contact.address.location.coordinates[1]">
                    <input type="hidden" id="builderLongitude" name="contact.address.location.coordinates[0]">
                </div>
            </div>

            <!-- Property Connection -->
            <div class="form-section">
                <h3>Connect Properties</h3>
                <div class="property-search">
                    <input type="text" id="propertySearch" placeholder="Search properties by ID or title...">
                    <div id="propertySearchResults" class="search-results"></div>
                </div>
                <div id="selectedProperties" class="selected-properties">
                    <h4>Selected Properties</h4>
                    <div class="property-chips"></div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="save-button">Upload Builder</button>
                <button type="button" class="cancel-button" onclick="resetBuilderForm()">Reset</button>
            </div>
        </form>
    </div>

    <!-- Existing Builders List -->
    <div class="builders-list-section">
        <h2>Existing Builders</h2>
        <div id="buildersList"></div>
    </div>
</div>

    <div id="CarouselManagement" class="tabcontent">
        <h1>Carousel Management</h1>
        <div id="carouselList"></div>

        <h2>Create/Edit Carousel</h2>
        <form id="carouselForm">
            <input type="hidden" id="carouselEditId">

            <label for="carouselId">Carousel ID:*</label>
            <input type="text" id="carouselId" required placeholder="e.g., featured-properties">

            <label for="carouselName">Name:*</label>
            <input type="text" id="carouselName" required placeholder="e.g., Featured Properties">

            <label for="autoPlay">Auto Play:</label>
            <input type="checkbox" id="autoPlay" checked>

            <label for="autoPlayInterval">Auto Play Interval (ms):</label>
            <input type="number" id="autoPlayInterval" value="3000">

            <label for="showIndicator">Show Indicator:</label>
            <input type="checkbox" id="showIndicator" checked>

            <h3>Carousel Items</h3>
            <div id="carouselItems">
                <!-- Items will be added here dynamically -->
            </div>

            <button type="button" onclick="addCarouselItem()">Add Item</button>
            <button type="submit">Save Carousel</button>
        </form>

        <template id="carouselItemTemplate">
            <div class="carousel-item">
                <h4>Item #</h4>
                <label for="imageUrl_IDX">Image URL:*</label>
                <input type="text" id="imageUrl_IDX" required>

                <label for="title_IDX">Title:</label>
                <input type="text" id="title_IDX">

                <label for="actionUrl_IDX">Action URL:</label>
                <input type="text" id="actionUrl_IDX" placeholder="e.g., ofo://property/123">

                <label for="propertyId_IDX">Property ID:</label>
                <input type="text" id="propertyId_IDX" placeholder="Optional: Link to a property">

                <label for="category_IDX">Category:</label>
                <input type="text" id="category_IDX">

                <button type="button" onclick="removeCarouselItem(this)">Remove Item</button>
            </div>
        </template>

        <style>
            .carousel-item {
                border: 1px solid #ddd;
                padding: 15px;
                margin: 10px 0;
                border-radius: 5px;
            }

            #carouselForm label {
                display: block;
                margin-top: 10px;
            }

            #carouselForm input:not([type="checkbox"]) {
                width: 100%;
                padding: 8px;
                margin-bottom: 10px;
            }

            #carouselForm button {
                margin-top: 10px;
                padding: 10px;
                background-color: #4CAF50;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            }

            .carousel-item button {
                background-color: #ff4444 !important;
            }

            #carouselList .carousel-entry {
                border: 1px solid #eee;
                padding: 10px;
                margin: 10px 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            
        </style>
    </div>


    <div id="CategoryManagement" class="tabcontent">
        <h1>Category Management</h1>
        <div id="categoryList"></div>
        <form id="categoryForm">
            <input type="hidden" id="categoryId">
            <label for="categoryName">Category Name:</label>
            <input type="text" id="categoryName" required>
            <label for="categoryIcon">Category Icon:</label>
            <input type="text" id="categoryIcon" required>
            <button type="submit">Save Category</button>
        </form>
    </div>


    <div id="DeeplinkGenerator" class="tabcontent">
        <h1>Deeplink Generator</h1>
        <form id="deeplinkForm">
            <h2>Filter Criteria</h2>
            <div>
                <label for="purpose">Purpose:</label>
                <select id="purpose" name="purpose">
                    <option value="">Select Purpose</option>
                    <option value="Rent">Rent</option>
                    <option value="Buy">Buy</option>
                </select>
            </div>


            <div>
                <label for="propertyType">Property Type:</label>
                <select id="propertyType" name="property_type">
                    <option value="">Select Property Type</option>
                    <option value="Apartment">Apartment</option>
                    <option value="House">House</option>
                    <option value="Villa">Villa</option>
                    <option value="Office">Office</option>
                    <option value="Shop">Shop</option>
                    <option value="Warehouse">Warehouse</option>
                    <option value="Factory">Factory</option>
                    <option value="Plot">Plot</option>
                    <option value="Room">Room</option>
                </select>
            </div>
            <div>
                <label for="minPrice">Min Price:</label>
                <input type="number" id="minPrice" name="min_price">
            </div>
            <div>
                <label for="maxPrice">Max Price:</label>
                <input type="number" id="maxPrice" name="max_price">
            </div>
            <div>
                <label for="bedroom">Bedrooms:</label>
                <input type="number" id="bedroom" name="bedrooms">
            </div>
            <div>
                <label for="bathroom">Bathrooms:</label>
                <input type="number" id="bathroom" name="bathrooms">
            </div>
            <div>
                <label for="latitude">Latitude:</label>
                <input type="number" id="latitude" name="lat" step="any">
            </div>
            <div>
                <label for="longitude">Longitude:</label>
                <input type="number" id="longitude" name="lng" step="any">
            </div>
            <div>
                <label for="amenities">Amenities (comma-separated):</label>
                <input type="text" id="amenities" name="amenities">
            </div>
            <button type="submit">Generate Deeplink</button>
        </form>
        <div id="deeplinkResult">
            <h3>Generated Deeplink:</h3>
            <p id="generatedDeeplink"></p>
            <button id="copyDeeplink">Copy Deeplink</button>
        </div>
    </div>


    <div id="PropertyEdit" class="tabcontent">
        <h1>Edit Property</h1>

        <!-- Property Selection Section -->
        <div class="property-select-section">
            <h2>Select Property to Edit</h2>
            <select id="propertySelector" onchange="loadPropertyForEdit()">
                <option value="">Select a property to edit</option>
            </select>

            <div class="search-box">
                <input type="text" id="propertySearch" placeholder="Search properties by title or ID..."
                    oninput="filterProperties()">
            </div>
        </div>

        <!-- Edit Form -->
        <form id="propertyEditForm" method="post" enctype="multipart/form-data" onsubmit="return false;">
            <input type="hidden" id="edit_property_id" name="property_id">

            <!-- Basic Information -->
            <div>
                <label for="edit_post_title">Property Title:</label>
                <input type="text" id="edit_post_title" name="post_title" required>
            </div>
            <div>
                <label for="edit_type_name">Property Type:</label>
                <select id="edit_type_name" name="type_name" required>
                    <option value="">Select Type</option>
                    <option value="Apartment">Apartment</option>
                    <option value="House">House</option>
                    <option value="Villa">Villa</option>
                    <option value="Office">Office</option>
                    <option value="Shop">Shop</option>
                    <option value="Warehouse">Warehouse</option>
                    <option value="Land">Land</option>
                </select>
            </div>
            <div>
                <label for="edit_purpose">Purpose:</label>
                <select id="edit_purpose" name="purpose" required>
                    <option value="">Select Purpose</option>
                    <option value="Rent">Rent</option>
                    <option value="Buy">Buy</option>
                </select>
            </div>
            <div>
                <label for="edit_building_id">Building ID:</label>
                <input type="text" id="edit_building_id" name="building_id">
            </div>
            <div>
                <label for="edit_price">Price:</label>
                <input type="number" id="edit_price" name="price" required>
            </div>
            <div>
                <label for="edit_priceUnit">Price Unit:</label>
                <input type="text" id="edit_priceUnit" name="priceUnit" required>
            </div>
            <div>
                <label for="edit_area">Area:</label>
                <input type="text" id="edit_area" name="area" required>
            </div>
            <div>
                <label for="edit_areaUnit">Area Unit:</label>
                <input type="text" id="edit_areaUnit" name="areaUnit" required>
            </div>
            <div>
                <label for="edit_bedrooms">Bedrooms:</label>
                <input type="number" id="edit_bedrooms" name="bedrooms" required>
            </div>
            <div>
                <label for="edit_bathrooms">Bathrooms:</label>
                <input type="number" id="edit_bathrooms" name="bathrooms" required>
            </div>
            <div>
                <label for="edit_floor">Floor:</label>
                <input type="text" id="edit_floor" name="floor">
            </div>
            <div>
                <label for="edit_furnishing">Furnishing:</label>
                <select id="edit_furnishing" name="furnishing" required>
                    <option value="">Select Furnishing</option>
                    <option value="Furnished">Furnished</option>
                    <option value="Semi-Furnished">Semi-Furnished</option>
                    <option value="Unfurnished">Unfurnished</option>
                </select>
            </div>
            <div>
                <label for="edit_carpetArea">Carpet Area:</label>
                <input type="number" id="edit_carpetArea" name="carpetArea">
            </div>
            <div>
                <label for="edit_superBuiltupArea">Super Built-up Area:</label>
                <input type="number" id="edit_superBuiltupArea" name="superBuiltupArea">
            </div>
            <div>
                <label for="edit_available">Available:</label>
                <input type="checkbox" id="edit_available" name="available">
            </div>
            <div>
                <label for="edit_category">Category:</label>
                <input type="number" id="edit_category" name="category">
            </div>
            <div>
                <label for="edit_region">Region:</label>
                <input type="text" id="edit_region" name="region">
            </div>
            <div>
                <label for="edit_possession">Possession:</label>
                <input type="text" id="edit_possession" name="possession">
            </div>
            <div>
                <label for="edit_agreement">Agreement:</label>
                <input type="text" id="edit_agreement" name="agreement">
            </div>

            <!-- Location Section -->
            <div class="full-width">
                <label for="edit_address">Address:</label>
                <textarea id="edit_address" name="address" required></textarea>
            </div>
            <div class="full-width">
                <label>Location:</label>
                <button type="button" id="edit_getCurrentLocation">Get Current Location</button>
                <div id="edit_map" class="map-container"></div>
                <input type="hidden" id="edit_latitude" name="latitude" required>
                <input type="hidden" id="edit_longitude" name="longitude" required>
                <p id="edit_locationDisplay"></p>
            </div>

            <!-- Description Section -->
            <div class="full-width">
                <label for="edit_post_description">Description:</label>
                <textarea id="edit_post_description" name="post_description" required></textarea>
            </div>

            <!-- Contact Section -->
            <div class="full-width">
                <label for="edit_contactList">Contact Numbers:</label>
                <input type="text" id="edit_contactListInput" placeholder="Type and press Enter to add">
                <div id="edit_contactListChips" class="chip-container"></div>
                <input type="hidden" id="edit_contactList" name="contactList">
            </div>

            <!-- Additional Fields -->
            <div>
                <label for="edit_viewType">View Type:</label>
                <select id="edit_viewType" name="viewType"></select>
            </div>
            <div>
                <label for="edit_propertyCondition">Property Condition:</label>
                <select id="edit_propertyCondition" name="propertyCondition"></select>
            </div>
            <div>
                <label for="edit_legalStatus">Legal Status:</label>
                <select id="edit_legalStatus" name="legalStatus"></select>
            </div>
            <div>
                <label for="edit_constructionStatus">Construction Status:</label>
                <select id="edit_constructionStatus" name="construction_status"></select>
            </div>
            <div>
                <label for="edit_ownershipType">Ownership Type:</label>
                <select id="edit_ownershipType" name="ownershipType"></select>
            </div>
            <div>
                <label for="edit_propertyTaxClass">Property Tax Class:</label>
                <select id="edit_propertyTaxClass" name="propertyTaxClass"></select>
            </div>

            <!-- Multiple Select Options -->
            <div>
                <label for="edit_financingOptions">Financing Options:</label>
                <select id="edit_financingOptions" name="financingOptions[]" multiple size="4"></select>
            </div>
            <div>
                <label for="edit_environmentalCertifications">Environmental Certifications:</label>
                <select id="edit_environmentalCertifications" name="environmentalCertifications[]" multiple
                    size="4"></select>
            </div>
            <div>
                <label for="edit_propertyManagementServices">Property Management Services:</label>
                <select id="edit_propertyManagementServices" name="propertyManagementServices[]" multiple
                    size="4"></select>
            </div>
            <div>
                <label for="edit_amenities">Amenities:</label>
                <select id="edit_amenities" name="amenities[]" multiple size="6"></select>
            </div>
            <div>
                <label for="edit_facilities">Facilities:</label>
                <select id="edit_facilities" name="facilities[]" multiple size="6"></select>
            </div>

            <!-- Images Section -->
            <div class="form-section">
                <h3>Images</h3>
                <div class="image-preview-section">
                    <div>
                        <label for="edit_post_image">Main Image:</label>
                        <input type="file" id="edit_post_image" name="post_image" accept="image/*">
                        <img id="edit_post_image_preview" class="image-preview" src="" alt="Current Main Image">
                    </div>

                    <div>
                        <label for="edit_floor_plan_image">Floor Plan:</label>
                        <input type="file" id="edit_floor_plan_image" name="floor_plan_image" accept="image/*">
                        <img id="edit_floor_plan_preview" class="image-preview" src="" alt="Current Floor Plan">
                    </div>

                    <div>
                        <label for="edit_gallery_images">Gallery Images:</label>
                        <input type="file" id="edit_gallery_images" name="gallery_images" multiple accept="image/*">
                        <div id="edit_gallery_preview" class="gallery-preview"></div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="save-button">Save Changes</button>
                <button type="button" class="cancel-button" onclick="cancelEdit()">Cancel</button>
            </div>
        </form>
    </div>



    <div id="PropertyUpload" class="tabcontent">
        <h1>Upload Property</h1>
        <form id="propertyUploadForm" method="post" enctype="multipart/form-data" onsubmit="return false;">
            <div>
                <label for="post_title">Property Title:</label>
                <input type="text" id="post_title" name="post_title" required>
            </div>
            <div>
                <label for="type_name">Property Type:</label>
                <select id="type_name" name="type_name" required>
                    <option value="">Select Type</option>
                    <option value="Apartment">Apartment</option>
                    <option value="House">House</option>
                    <option value="Villa">Villa</option>
                    <option value="Office">Office</option>
                    <option value="Shop">Shop</option>
                    <option value="Warehouse">Warehouse</option>
                    <option value="Land">Land</option>
                </select>
            </div>
            <div>
                <label for="purpose">Purpose:</label>
                <select id="purpose" name="purpose" required>
                    <option value="">Select Purpose</option>
                    <option value="Rent">Rent</option>
                    <option value="Buy">Buy</option>
                </select>
            </div>
            <div>
                <label for="building_id">Building ID:</label>
                <input type="text" id="building_id" name="building_id">
            </div>
            <div>
                <label for="price">Price:</label>
                <input type="number" id="price" name="price" required>
            </div>
            <div>
                <label for="priceUnit">Price Unit:</label>
                <input type="text" id="priceUnit" name="priceUnit" required>
            </div>
            <div>
                <label for="area">Area:</label>
                <input type="text" id="area" name="area" required>
            </div>
            <div>
                <label for="areaUnit">Area Unit:</label>
                <input type="text" id="areaUnit" name="areaUnit" required>
            </div>
            <div>
                <label for="bedrooms">Bedrooms:</label>
                <input type="number" id="bedrooms" name="bedrooms" required>
            </div>
            <div>
                <label for="bathrooms">Bathrooms:</label>
                <input type="number" id="bathrooms" name="bathrooms" required>
            </div>
            <div>
                <label for="floor">Floor:</label>
                <input type="text" id="floor" name="floor">
            </div>
            <div>
                <label for="furnishing">Furnishing:</label>
                <select id="furnishing" name="furnishing" required>
                    <option value="">Select Furnishing</option>
                    <option value="Furnished">Furnished</option>
                    <option value="Semi-Furnished">Semi-Furnished</option>
                    <option value="Unfurnished">Unfurnished</option>
                </select>
            </div>

            <div>
                <label for="carpetArea">Carpet Area:</label>
                <input type="number" id="carpetArea" name="carpetArea">
            </div>
            <div>
                <label for="superBuiltupArea">Super Built-up Area:</label>
                <input type="number" id="superBuiltupArea" name="superBuiltupArea">
            </div>
            <div>
                <label for="available">Available:</label>
                <input type="checkbox" id="available" name="available">
            </div>
            <div>
                <label for="category">Category:</label>
                <input type="number" id="category" name="category">
            </div>
            <div>
                <label for="region">Region:</label>
                <input type="text" id="region" name="region">
            </div>

            <div>
                <label for="possession">Possession:</label>
                <input type="text" id="possession" name="possession">
            </div>

            <div>
                <label for="agreement">Agreement:</label>
                <input type="text" id="agreement" name="agreement">
            </div>
            <div class="full-width">
                <label for="address">Address:</label>
                <textarea id="address" name="address" required></textarea>
            </div>
            <div class="full-width">
                <label>Location:</label>
                <button type="button" id="getCurrentLocation">Get Current Location</button>
                <div id="map" class="map-container"></div>
                <input type="hidden" id="latitude" name="latitude" required>
                <input type="hidden" id="longitude" name="longitude" required>
                <p id="locationDisplay"></p>
            </div>
            <div class="full-width">
                <label for="post_description">Description:</label>
                <textarea id="post_description" name="post_description" required></textarea>
            </div>

            <div class="full-width">
                <label for="contactList">Contact Numbers:</label>
                <input type="text" id="contactListInput" placeholder="Type and press Enter to add">
                <div id="contactListChips" class="chip-container"></div>
                <input type="hidden" id="contactList" name="contactList">
            </div>




            <div>
                <label for="viewType">View Type:</label>
                <select id="viewType" name="viewType">
                    <option value="">Select View Type</option>
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="propertyCondition">Property Condition:</label>
                <select id="propertyCondition" name="propertyCondition">
                    <option value="">Select Property Condition</option>
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="legalStatus">Legal Status:</label>
                <select id="legalStatus" name="legalStatus">
                    <option value="">Select Legal Status</option>
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="constructionStatus">Construction Status:</label>
                <select id="constructionStatus" name="construction_status">
                    <option value="">Select Construction Status</option>
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="ownershipType">Ownership Type:</label>
                <select id="ownershipType" name="ownershipType">
                    <option value="">Select Ownership Type</option>
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="propertyTaxClass">Property Tax Class:</label>
                <select id="propertyTaxClass" name="propertyTaxClass">
                    <option value="">Select Property Tax Class</option>
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="financingOptions">Financing Options (Ctrl+Click for multiple):</label>
                <select id="financingOptions" name="financingOptions[]" multiple size="4">
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="environmentalCertifications">Environmental Certifications (Ctrl+Click for multiple):</label>
                <select id="environmentalCertifications" name="environmentalCertifications[]" multiple size="4">
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="propertyManagementServices">Property Management Services (Ctrl+Click for multiple):</label>
                <select id="propertyManagementServices" name="propertyManagementServices[]" multiple size="4">
                    <!-- Options will be dynamically populated -->
                </select>
            </div>


            <div>
                <label for="amenitiess">Amenities (Ctrl+Click for multiple):</label>
                <select id="amenitiess" name="amenities[]" multiple size="6">
                    <!-- Options will be dynamically populated -->
                </select>
            </div>

            <div>
                <label for="facilitiess">Facilities (Ctrl+Click for multiple):</label>
                <select id="facilitiess" name="facilities[]" multiple size="6">
                    <!-- Options will be dynamically populated -->
                </select>
            </div>


            <div>
                <label for="investmentStrategy">Investment Strategy:</label>
                <select id="investmentStrategy" name="investmentStrategy">
                    <option value="">Select Investment Strategy</option>
                    <!-- Options will be dynamically populated -->
                </select>
            </div>


            <div>
                <label for="post_image">Main Image:</label>
                <input type="file" id="post_image" name="post_image" accept="image/*" required>
                <img id="post_image_preview" class="image-upload-preview" src="#" alt="Main Image Preview"
                    style="display:none;">
            </div>
            <div>
                <label for="floor_plan_image">Floor Plan Image:</label>
                <input type="file" id="floor_plan_image" name="floor_plan_image" accept="image/*">
                <img id="floor_plan_image_preview" class="image-upload-preview" src="#" alt="Floor Plan Preview"
                    style="display:none;">
            </div>
            <div class="full-width">
                <label for="gallery_images">Gallery Images:</label>
                <input type="file" id="gallery_images" name="gallery_images" accept="image/*" multiple>
                <div id="gallery_images_preview"></div>
            </div>
            <div class="full-width">
                <button type="submit">Upload Property</button>
            </div>
        </form>
    </div>


    <div id="BuildingsProperties" class="tabcontent">
        <h1>Buildings and Properties</h1>
        <input type="text" id="searchInput" placeholder="Search buildings or properties...">
        <div class="grid-container" id="buildingsPropertiesGrid">
            <!-- Buildings and properties will be dynamically added here -->
        </div>
    </div>

    <div id="ListOptions" class="tabcontent">
        <h1>List Options Management</h1>
        <div>
            <h2>Available Lists</h2>
            <select id="listSelector">

            </select>
            <button onclick="loadListOptions()">Load Options</button>
        </div>
        <div id="optionsList"></div>
        <div>
            <h2>Add/Edit Option</h2>
            <form id="optionForm">
                <input type="hidden" id="optionId">
                <label for="imagelink">Image Link:</label>
                <input type="text" id="imagelink" required>
                <label for="textview">Text View:</label>
                <input type="text" id="textview" required>
                <label for="link">Link:</label>
                <input type="text" id="link" required>
                <button type="submit" onclick="saveOptions()">Save Option</button>
            </form>
        </div>
        <button id="deleteListButton" style="display: none;">Delete List</button>

    </div>


    <div id="ImageGallery" class="tabcontent">
        <h1>AWS S3 Image Gallery</h1>

        <div id="uploadSection">
            <h2>Upload New Image</h2>
            <input type="file" id="imageUpload" accept="image/*">
            <button onclick="uploadImage()">Upload</button>
            <div id="uploadedImageUrl"></div>
        </div>

        <h2>Existing Images</h2>
        <div id="imageGrid"></div>
    </div>

    <div id="UpdateColors" class="tabcontent">
        <h1>Update Colors API Form</h1>
        <form id="updateForm">
            <h2>Header</h2>
            <div class="color-input">
                <input type="color" id="headerStartColor" value="#ffffff">
                <input type="text" name="header.startColor" value="#ffffff">
            </div>
            <div class="color-input">
                <input type="color" id="headerEndColor" value="#ffffff">
                <input type="text" name="header.endColor" value="#ffffff">
            </div>

            <h2>Button</h2>
            <div class="color-input">
                <input type="color" id="buttonStartColor" value="#ee0979">
                <input type="text" name="button.startColor" value="#ee0979">
            </div>
            <div class="color-input">
                <input type="color" id="buttonEndColor" value="#ff6a00">
                <input type="text" name="button.endColor" value="#ff6a00">
            </div>

            <h2>Button Background</h2>
            <div class="color-input">
                <input type="color" id="buttonBgStartColor" value="#ee0979">
                <input type="text" name="buttonBackground.startColor" value="#ee0979">
            </div>
            <div class="color-input">
                <input type="color" id="buttonBgEndColor" value="#ff6a00">
                <input type="text" name="buttonBackground.endColor" value="#ff6a00">
            </div>

            <h2>List Title Size</h2>
            <div class="color-input">
                <input type="color" id="listTitleColor" value="#333333">
                <input type="text" name="list_title_size.color" value="#333333">
            </div>
            <div class="color-input">
                <input type="color" id="listTitleBgColor" value="#f2f2f2">
                <input type="text" name="list_title_size.backgroundColor" value="#f2f2f2">
            </div>

            <h2>List Background</h2>
            <div class="color-input">
                <input type="color" id="listBgColor" value="#ededed">
                <input type="text" name="listbackground.backgroundColor" value="#ededed">
            </div>

            <h2>Search Filter</h2>
            <div class="color-input">
                <input type="color" id="searchFilterBgColor" value="#000000">
                <input type="text" name="search_filter.backgroundColor" value="#000000">
            </div>

            <h2>Other Settings</h2>
            <label for="listPriceSize">List Price Size:</label>
            <input type="number" id="listPriceSize" name="list_price_size" value="14">

            <div class="color-input">
                <input type="color" id="markerColor" value="#e1faeb">
                <input type="text" name="markerColor" value="#e1faeb">
            </div>

            <h2>Constant Data</h2>
            <label for="isPropertyUpload">Is Property Upload:</label>
            <select id="isPropertyUpload" name="constantData.isPropertyUpload">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="homeUrls">Home URLs:</label>
            <textarea id="homeUrls" name="constantData.homeUrls" rows="3"></textarea>

            <label for="isStrokeFilter">Is Stroke Filter:</label>
            <select id="isStrokeFilter" name="constantData.isStrokeFilter">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="isMaterialElevation">Is Material Elevation:</label>
            <select id="isMaterialElevation" name="constantData.isMaterialElevation">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="headerHeight">Header Height:</label>
            <input type="number" id="headerHeight" name="constantData.headerHeight" value="400">

            <label for="appPackageName">App Package Name:</label>
            <input type="text" id="appPackageName" name="constantData.appPackageName" value="">

            <label for="defaultLanguage">Default Language:</label>
            <input type="text" id="defaultLanguage" name="constantData.defaultLanguage" value="">

            <label for="currencyCode">Currency Code:</label>
            <input type="text" id="currencyCode" name="constantData.currencyCode" value="">

            <label for="appName">App Name:</label>
            <input type="text" id="appName" name="constantData.appName" value="">

            <label for="appEmail">App Email:</label>
            <input type="email" id="appEmail" name="constantData.appEmail" value="">

            <label for="appWebsite">App Website:</label>
            <input type="url" id="appWebsite" name="constantData.appWebsite" value="">

            <label for="facebookLink">Facebook Link:</label>
            <input type="url" id="facebookLink" name="constantData.facebookLink"
                value="https://www.geetikabuilders.in/gk/index.html">

            <label for="twitterLink">Twitter Link:</label>
            <input type="url" id="twitterLink" name="constantData.twitterLink" value="">

            <label for="instagramLink">Instagram Link:</label>
            <input type="url" id="instagramLink" name="constantData.instagramLink" value="">

            <label for="youtubeLink">YouTube Link:</label>
            <input type="url" id="youtubeLink" name="constantData.youtubeLink" value="">

            <label for="googlePlayLink">Google Play Link:</label>
            <input type="url" id="googlePlayLink" name="constantData.googlePlayLink" value="">

            <label for="appleStoreLink">Apple Store Link:</label>
            <input type="url" id="appleStoreLink" name="constantData.appleStoreLink" value="">

            <label for="appVersion">App Version:</label>
            <input type="text" id="appVersion" name="constantData.appVersion" value="">

            <label for="appUpdateHideShow">App Update Hide/Show:</label>
            <input type="text" id="appUpdateHideShow" name="constantData.appUpdateHideShow" value="">

            <label for="appUpdateVersionCode">App Update Version Code:</label>
            <input type="number" id="appUpdateVersionCode" name="constantData.appUpdateVersionCode" value="0">

            <label for="appUpdateDesc">App Update Description:</label>
            <textarea id="appUpdateDesc" name="constantData.appUpdateDesc" rows="3"></textarea>

            <label for="appUpdateLink">App Update Link:</label>
            <input type="url" id="appUpdateLink" name="constantData.appUpdateLink" value="">

            <label for="appUpdateCancelOption">App Update Cancel Option:</label>
            <input type="text" id="appUpdateCancelOption" name="constantData.appUpdateCancelOption" value="">

            <div class="color-input">
                <input type="color" id="priceColor" value="#000000">
                <input type="text" name="constantData.priceColor" value="#000000">
            </div>

            <div class="color-input">
                <input type="color" id="callButtonColor" value="#e1faeb">
                <input type="text" name="constantData.callButtonColor" value="#e1faeb">
            </div>

            <h3>Detail Page Button Color</h3>
            <div class="color-input">
                <input type="color" id="detailPageButtonStartColor" value="#e1faeb">
                <input type="text" name="constantData.DetailPageButtonColor.startColor" value="#e1faeb">
            </div>
            <div class="color-input">
                <input type="color" id="detailPageButtonEndColor" value="#e1faeb">
                <input type="text" name="constantData.DetailPageButtonColor.endColor" value="#e1faeb">
            </div>

            <label for="homePageLayoutOrder">Home Page Layout Order:</label>
            <input type="text" id="homePageLayoutOrder" name="constantData.homePageLayoutOrder" value="1,3,4,5,6">

            <label for="isCallDirect">Is Call Direct:</label>
            <select id="isCallDirect" name="constantData.isCallDirect">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="shadowOnImage">Shadow On Image:</label>
            <select id="shadowOnImage" name="constantData.shadowOnImage">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>


            <h2>Ads</h2>
            <div id="adsContainer">
                <div class="ad-item">
                    <h3>Ad 1</h3>
                    <label for="ad1Name">Name:</label>
                    <input type="text" id="ad1Name" name="ads[0].name" value="">

                    <label for="ad1Header">Header:</label>
                    <input type="text" id="ad1Header" name="ads[0].header" value="">

                    <label for="ad1PageLink">Page Link:</label>
                    <input type="url" id="ad1PageLink" name="ads[0].pagelink" value="">

                    <label for="ad1ImageLinks">Image Links (comma-separated):</label>
                    <input type="text" id="ad1ImageLinks" name="ads[0].imagelinks" value="">

                    <label for="ad1Contact">Contact Info (comma-separated):</label>
                    <input type="text" id="ad1Contact" name="ads[0].contact" value="">

                    <label for="ad1Type">Type:</label>
                    <select id="ad1Type" name="ads[0].type" onchange="showAdTypeFields(this)">
                        <option value="BANNER">Banner</option>
                        <option value="POPUP">Popup</option>
                        <option value="INTERSTITIAL">Interstitial</option>
                    </select>

                    <div class="banner-fields" style="display: none;">
                        <label for="ad1Width">Width:</label>
                        <input type="number" id="ad1Width" name="ads[0].width" value="">
                        <label for="ad1Height">Height:</label>
                        <input type="number" id="ad1Height" name="ads[0].height" value="">
                    </div>

                    <div class="popup-fields" style="display: none;">
                        <label for="ad1Delay">Delay (ms):</label>
                        <input type="number" id="ad1Delay" name="ads[0].delay" value="">
                    </div>

                    <div class="interstitial-fields" style="display: none;">
                        <label for="ad1Fullscreen">Fullscreen:</label>
                        <input type="checkbox" id="ad1Fullscreen" name="ads[0].fullscreen">
                    </div>
                </div>
            </div>

            <button type="button" id="addAdButton">Add Another Ad</button>

            <button type="submit">Submit</button>
        </form>
    </div>

    <div id="NewListOption" class="tabcontent">
        <h1>Create New List Option</h1>
        <form id="newListOptionForm">
            <label for="newListName">List Name:</label>
            <input type="text" id="newListName" required>

            <div id="newOptionsContainer">
                <div class="option-item">
                    <label for="newImageLink0">Image Link:</label>
                    <input type="text" id="newImageLink0" required>
                    <label for="newTextView0">Text View:</label>
                    <input type="text" id="newTextView0" required>
                    <label for="newLink0">Link:</label>
                    <input type="text" id="newLink0" required>
                </div>
            </div>

            <button type="button" id="addNewOptionButton">Add Another Option</button>
            <button type="submit">Create New List Option</button>
        </form>
    </div>

    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">&times;</span>
            <p id="popup-message"></p>
        </div>
    </div>

    <div id="separateAdsManagement">
        <h2>Separate Ads Management</h2>
        <button type="button" id="addNewAdButton">Add New Ad</button>
        <button type="button" id="listAdsButton">List All Ads</button>
        <div id="adsList"></div>
    </div>

    <div id="adFormPopup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closeAdForm()">&times;</span>
            <h3>Ad Form</h3>
            <form id="separateAdForm">
                <input type="hidden" id="adId" name="adId">
                <label for="adName">Name:</label>
                <input type="text" id="adName" name="name" required>
                <label for="adHeader">Header:</label>
                <input type="text" id="adHeader" name="header">
                <label for="adPageLink">Page Link:</label>
                <input type="url" id="adPageLink" name="pagelink">
                <label for="adImageLinks">Image Links (comma-separated):</label>
                <input type="text" id="adImageLinks" name="imagelinks">
                <label for="adContact">Contact Info (comma-separated):</label>
                <input type="text" id="adContact" name="contact">
                <label for="adType">Type:</label>
                <select id="adType" name="type" onchange="showSeparateAdTypeFields()">
                    <option value="BANNER">Banner</option>
                    <option value="POPUP">Popup</option>
                    <option value="INTERSTITIAL">Interstitial</option>
                </select>
                <div id="separateBannerFields" style="display: none;">
                    <label for="adWidth">Width:</label>
                    <input type="number" id="adWidth" name="width">
                    <label for="adHeight">Height:</label>
                    <input type="number" id="adHeight" name="height">
                </div>
                <div id="separatePopupFields" style="display: none;">
                    <label for="adDelay">Delay (ms):</label>
                    <input type="number" id="adDelay" name="delay">
                </div>
                <div id="separateInterstitialFields" style="display: none;">
                    <label for="adFullscreen">Fullscreen:</label>
                    <input type="checkbox" id="adFullscreen" name="fullscreen">
                </div>
                <button type="submit">Save Ad</button>
            </form>
        </div>
    </div>
    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">&times;</span>
            <div id="popup-message"></div>
        </div>
    </div>

    <div id="BuildingUpload" class="tabcontent">
        <h1>Upload Building Details</h1>
        <form id="buildingUploadForm">
            <div>
                <label for="buildingId">Building ID:</label>
                <input type="text" id="buildingId" name="buildingId" required>
            </div>
            <div>
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div>
                <label for="frontRoad">Front Road:</label>
                <input type="text" id="frontRoad" name="frontRoad">
            </div>
            <div>
                <label for="parkingArea">Parking Area:</label>
                <input type="text" id="parkingArea" name="parkingArea">
            </div>
            <div>
                <label for="description">Description:</label>
                <textarea id="description" name="description"></textarea>
            </div>
            <div>
                <label for="areaUSP">Area USP:</label>
                <input type="text" id="areaUSP" name="areaUSP">
            </div>
            <div>
                <label for="ownerName">Owner Name:</label>
                <input type="text" id="ownerName" name="ownerName">
            </div>
            <div>
                <label for="ownerId">Owner ID:</label>
                <input type="text" id="ownerId" name="ownerId">
            </div>
            <div>
                <label for="storey">Storey:</label>
                <input type="text" id="storey" name="storey">
            </div>
            <div>
                <label for="age">Age:</label>
                <input type="text" id="age" name="age">
            </div>
            <div>
                <label for="type">Type:</label>
                <input type="text" id="type" name="type">
            </div>
            <div>
                <label for="luda">LUDA:</label>
                <input type="text" id="luda" name="luda">
            </div>
            <div>
                <label for="totalProperties">Total Properties:</label>
                <input type="text" id="totalProperties" name="totalProperties">
            </div>
            <div>
                <label for="developmentStatus">Development Status:</label>
                <input type="text" id="developmentStatus" name="developmentStatus">
            </div>
            <div>
                <label for="allowPreBooking">Allow Pre-Booking:</label>
                <input type="checkbox" id="allowPreBooking" name="allowPreBooking">
            </div>
            <div>
                <label for="allocatedProperties">Allocated Properties:</label>
                <input type="text" id="allocatedProperties" name="allocatedProperties">
            </div>
            <div>
                <label for="freeProperties">Free Properties:</label>
                <input type="text" id="freeProperties" name="freeProperties">
            </div>
            <div>
                <label for="contactNumber">Contact Number:</label>
                <input type="tel" id="contactNumber" name="contactNumber">
            </div>
            <div>
                <label for="latitude">Latitude:</label>
                <input type="number" id="latitude" name="latitude" step="any">
            </div>
            <div>
                <label for="longitude">Longitude:</label>
                <input type="number" id="longitude" name="longitude" step="any">
            </div>
            <div>
                <label for="galleryList">Gallery Images:</label>
                <input type="file" id="galleryList" name="galleryList" multiple accept="image/*">
            </div>


            <div>
                <label for="numberOfFlatsAvailable">Number of Flats Available:</label>
                <input type="number" id="numberOfFlatsAvailable" name="numberOfFlatsAvailable" required>
            </div>
            <div>
                <label for="totalFloors">Total Number of Floors:</label>
                <input type="number" id="totalFloors" name="totalFloors" required>
            </div>
            <div id="flatsDetailsContainer">
                <h3>Flats Details</h3>
                <!-- JavaScript will dynamically add input fields here based on totalFloors -->
            </div>
            <div>
                <label for="areaUSP">Area USP:</label>
                <textarea id="areaUSP" name="areaUSP"></textarea>
            </div>
            <div>
                <label for="brochureLink">Brochure Link:</label>
                <input type="url" id="brochureLink" name="brochureLink">
            </div>
            <div>
                <label for="mapLink">Map Link:</label>
                <input type="url" id="mapLink" name="mapLink">
            </div>
            <div>
                <label for="connectedProperties">Connected Properties (Property IDs, comma-separated):</label>
                <input type="text" id="connectedProperties" name="connectedProperties">
            </div>
            <button type="submit">Upload Building</button>
        </form>
    </div>



    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1035.0.min.js"></script>
    <script>
////////////////


// Helper function to handle map marker placement
function placeProjectMarker(location) {
    if (projectMarker && projectMap) {
        projectMarker.setPosition(location);
        projectMap.panTo(location);
        updateProjectLatLng(location);
    }
}

// Helper function to update lat/lng fields
function updateProjectLatLng(location) {
    const latInput = document.getElementById('projectLatitude');
    const lngInput = document.getElementById('projectLongitude');
    
    if (latInput && lngInput) {
        latInput.value = location.lat();
        lngInput.value = location.lng();
    }
}

// Add a resize observer to handle map rendering when tab becomes visible
const resizeObserver = new ResizeObserver(entries => {
    entries.forEach(entry => {
        if (entry.target.id === 'projectMap' && projectMap) {
            google.maps.event.trigger(projectMap, 'resize');
        }
    });
});

// Observe the map container
const mapContainer = document.getElementById('projectMap');
if (mapContainer) {
    resizeObserver.observe(mapContainer);
}

let projectMap, projectMarker;

function initializeProjectMap() {
    projectMap = new google.maps.Map(document.getElementById('projectMap'), {
        center: { lat: 20.5937, lng: 78.9629 }, // Center of India
        zoom: 5
    });

    projectMarker = new google.maps.Marker({
        map: projectMap,
        draggable: true
    });

    google.maps.event.addListener(projectMap, 'click', function(event) {
        placeProjectMarker(event.latLng);
    });

    google.maps.event.addListener(projectMarker, 'dragend', function(event) {
        updateProjectLatLng(event.latLng);
    });
}

function placeProjectMarker(location) {
    projectMarker.setPosition(location);
    projectMap.setCenter(location);
    updateProjectLatLng(location);
}

function updateProjectLatLng(location) {
    document.getElementById('projectLatitude').value = location.lat();
    document.getElementById('projectLongitude').value = location.lng();
}

function addFloorPlan() {
    const container = document.getElementById('floorPlansContainer');
    const floorPlanDiv = document.createElement('div');
    floorPlanDiv.className = 'floor-plan-item';
    floorPlanDiv.innerHTML = `
        <div class="grid-2-cols">
            <div>
                <label>Plan Name:</label>
                <input type="text" name="floorPlans[][name]" required>
            </div>
            <div>
                <label>Type:</label>
                <input type="text" name="floorPlans[][type]" placeholder="e.g., 2BHK, 3BHK" required>
            </div>
            <div>
                <label>Super Area (sq.ft):</label>
                <input type="number" name="floorPlans[][superArea]" required>
            </div>
            <div>
                <label>Carpet Area (sq.ft):</label>
                <input type="number" name="floorPlans[][carpetArea]" required>
            </div>
            <div>
                <label>Price:</label>
                <input type="number" name="floorPlans[][price]" required>
            </div>
            <div>
                <label>Floor Plan Image:</label>
                <input type="file" name="floorPlans[][image]" accept="image/*">
            </div>
        </div>
        <button type="button" onclick="removeFloorPlan(this)" class="remove-button">Remove Floor Plan</button>
    `;
    container.appendChild(floorPlanDiv);
}

// Add other functions for handling amenities, specifications, gallery, and phases...

document.getElementById('projectUploadForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    try {
        const formData = new FormData(this);
        const projectData = {
            name: formData.get('name'),
            type: formData.get('type'),
            status: formData.get('status'),
            builder: formData.get('builder'),
            description: formData.get('description'),
            // Add all other form fields...
        };

        const response = await fetch('https://propertify.onrender.com/api/projects', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(projectData)
        });

        if (!response.ok) {
            throw new Error('Failed to save project');
        }

        showPopup('Project saved successfully!');
        resetProjectForm();
        loadProjectsList();
    } catch (error) {
        console.error('Error saving project:', error);
        showPopup('Failed to save project: ' + error.message);
    }
});


async function initializeProjectManagement() {
    console.log('Initializing Project Management...');
    
    try {
        // Initialize map first
        if (typeof google !== 'undefined') {
            // Ensure map container is visible
            document.getElementById('projectMap').style.display = 'block';
            initializeProjectMap();
            console.log('Project map initialized');
        } else {
            console.error('Google Maps API not loaded');
        }

        // Load builders list
        await loadBuildersList();
        console.log('Builders list loaded');

        // Load existing projects
        await loadProjectsList();
        console.log('Projects list loaded');

    } catch (error) {
        console.error('Error initializing Project Management:', error);
        showPopup('Error initializing project management. Please refresh the page.');
    }
}

// Function to load builders into the select dropdown
async function loadBuildersList() {
    try {
        const response = await fetch('https://propertify.onrender.com/api/builders');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const builders = await response.json();
        const builderSelect = document.getElementById('builderSelect');
        
        // Clear existing options except the default one
        builderSelect.innerHTML = '<option value="">Select Builder</option>';
        
        // Add builders to dropdown
        builders.forEach(builder => {
            const option = document.createElement('option');
            option.value = builder._id;
            option.textContent = builder.name;
            builderSelect.appendChild(option);
        });
        
        console.log('Builders loaded successfully');
    } catch (error) {
        console.error('Error loading builders:', error);
        showPopup('Failed to load builders list');
    }
}

async function loadProjectsList() {
    try {
        const response = await fetch('https://propertify.onrender.com/api/projects');
        const projects = await response.json();
        
        const projectsList = document.getElementById('projectsList');
        projectsList.innerHTML = projects.map(project => `
            <div class="project-card">
                <div class="project-header">
                    <h3>${project.name}</h3>
                    <span class="project-status ${project.status.toLowerCase()}">${project.status}</span>
                </div>
                <div class="project-details">
                    <p><strong>Type:</strong> ${project.type}</p>
                    <p><strong>Total Units:</strong> ${project.overview.totalUnits}</p>
                    <p><strong>Location:</strong> ${project.location.city}</p>
                </div>
                <div class="project-actions">
                    <button onclick="editProject('${project._id}')">Edit</button>
                    <button onclick="deleteProject('${project._id}')">Delete</button>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading projects:', error);
        showPopup('Failed to load projects list');
    }
}

const prefillProjectButton = document.createElement('button');
prefillProjectButton.type = 'button';
prefillProjectButton.textContent = 'Pre-fill Project Form (Testing)';
prefillProjectButton.className = 'prefill-button';
prefillProjectButton.style.cssText = `
    position: fixed;
    bottom: 80px;
    right: 20px;
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
`;
prefillProjectButton.onclick = prefillProjectForm;

// Add button to document when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    document.body.appendChild(prefillProjectButton);
});



function prefillProjectForm() {
    // Helper function to set value for single inputs
    function setValue(id, value) {
        const element = document.getElementById(id);
        if (element) {
            if (element.type === 'checkbox') {
                element.checked = value;
            } else {
                element.value = value;
            }
        }
    }

    // Basic Information
    setValue('projectName', 'Green Valley Residences');
    setValue('projectType', 'RESIDENTIAL');
    setValue('projectStatus', 'UNDER_CONSTRUCTION');
    setValue('builderSelect', '1'); // Assuming builder ID
    setValue('projectDescription', 'Luxury residential project featuring modern amenities, sustainable design, and premium finishes. Located in a prime area with excellent connectivity.');

    // Overview Section
    setValue('totalUnits', '250');
    setValue('totalTowers', '3');
    setValue('launchDate', '2024-06-01');
    setValue('possessionDate', '2027-12-31');
    
    // Price Range
    setValue('priceMin', '8500000');
    setValue('priceMax', '25000000');
    setValue('pricePerSqFt', '7500');

    // Location Details
    setValue('projectAddress', '123 Green Valley Road, Sector 15');
    setValue('projectLandmark', 'Near Central Metro Station');
    setValue('projectCity', 'Bangalore');
    setValue('projectState', 'Karnataka');
    setValue('projectLatitude', '12.9716');
    setValue('projectLongitude', '77.5946');

    // Set map location if map is initialized
    if (typeof projectMap !== 'undefined' && projectMarker) {
        const position = new google.maps.LatLng(12.9716, 77.5946);
        projectMarker.setPosition(position);
        projectMap.setCenter(position);
        projectMap.setZoom(15);
    }

    // Add Floor Plans
    const floorPlansContainer = document.getElementById('floorPlansContainer');
    floorPlansContainer.innerHTML = ''; // Clear existing floor plans
    
    const floorPlans = [
        {
            name: '2 BHK Premium',
            type: '2BHK',
            superArea: 1250,
            carpetArea: 1000,
            price: 8500000
        },
        {
            name: '3 BHK Luxury',
            type: '3BHK',
            superArea: 1750,
            carpetArea: 1400,
            price: 12500000
        },
        {
            name: '4 BHK Penthouse',
            type: '4BHK',
            superArea: 2500,
            carpetArea: 2000,
            price: 25000000
        }
    ];

    floorPlans.forEach(plan => {
        const floorPlanDiv = document.createElement('div');
        floorPlanDiv.className = 'floor-plan-item';
        floorPlanDiv.innerHTML = `
            <div class="grid-2-cols">
                <div>
                    <label>Plan Name:</label>
                    <input type="text" name="floorPlans[][name]" value="${plan.name}" required>
                </div>
                <div>
                    <label>Type:</label>
                    <input type="text" name="floorPlans[][type]" value="${plan.type}" required>
                </div>
                <div>
                    <label>Super Area (sq.ft):</label>
                    <input type="number" name="floorPlans[][superArea]" value="${plan.superArea}" required>
                </div>
                <div>
                    <label>Carpet Area (sq.ft):</label>
                    <input type="number" name="floorPlans[][carpetArea]" value="${plan.carpetArea}" required>
                </div>
                <div>
                    <label>Price:</label>
                    <input type="number" name="floorPlans[][price]" value="${plan.price}" required>
                </div>
                <div>
                    <label>Floor Plan Image:</label>
                    <input type="file" name="floorPlans[][image]" accept="image/*">
                </div>
            </div>
            <button type="button" onclick="removeFloorPlan(this)" class="remove-button">Remove Floor Plan</button>
        `;
        floorPlansContainer.appendChild(floorPlanDiv);
    });

    // Add Amenities
    const amenitiesContainer = document.getElementById('amenitiesContainer');
    amenitiesContainer.innerHTML = ''; // Clear existing amenities

    const amenities = {
        'Outdoor Features': ['Swimming Pool', 'Garden', 'Kids Play Area', 'Jogging Track'],
        'Indoor Features': ['Gymnasium', 'Community Hall', 'Indoor Games Room'],
        'Security': ['24/7 Security', 'CCTV Surveillance', 'Access Control'],
        'Convenience': ['Power Backup', 'Car Parking', 'Visitor Parking']
    };

    Object.entries(amenities).forEach(([category, items]) => {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'amenity-category';
        categoryDiv.innerHTML = `
            <input type="text" placeholder="Category Name" class="category-input" value="${category}">
            <div class="amenity-items">
                ${items.map(item => `
                    <input type="text" placeholder="Amenity Item" class="amenity-input" value="${item}">
                `).join('')}
            </div>
            <button type="button" onclick="addAmenityItem(this)" class="small-button">Add Item</button>
        `;
        amenitiesContainer.appendChild(categoryDiv);
    });
}



/////////////////


function initializeProjectMap() {
    projectMap = new google.maps.Map(document.getElementById('projectMap'), {
        center: { lat: 20.5937, lng: 78.9629 }, // Center of India
        zoom: 5
    });

    projectMarker = new google.maps.Marker({
        map: projectMap,
        draggable: true
    });

    google.maps.event.addListener(projectMap, 'click', function(event) {
        placeProjectMarker(event.latLng);
    });

    google.maps.event.addListener(projectMarker, 'dragend', function(event) {
        updateProjectLatLng(event.latLng);
    });
}

function placeProjectMarker(location) {
    projectMarker.setPosition(location);
    projectMap.setCenter(location);
    updateProjectLatLng(location);
}

function updateProjectLatLng(location) {
    document.getElementById('projectLatitude').value = location.lat();
    document.getElementById('projectLongitude').value = location.lng();
}

function addFloorPlan() {
    const container = document.getElementById('floorPlansContainer');
    const floorPlanDiv = document.createElement('div');
    floorPlanDiv.className = 'floor-plan-item';
    floorPlanDiv.innerHTML = `
        <div class="grid-2-cols">
            <div>
                <label>Plan Name:</label>
                <input type="text" name="floorPlans[][name]" required>
            </div>
            <div>
                <label>Type:</label>
                <input type="text" name="floorPlans[][type]" placeholder="e.g., 2BHK, 3BHK" required>
            </div>
            <div>
                <label>Super Area (sq.ft):</label>
                <input type="number" name="floorPlans[][superArea]" required>
            </div>
            <div>
                <label>Carpet Area (sq.ft):</label>
                <input type="number" name="floorPlans[][carpetArea]" required>
            </div>
            <div>
                <label>Price:</label>
                <input type="number" name="floorPlans[][price]" required>
            </div>
            <div>
                <label>Floor Plan Image:</label>
                <input type="file" name="floorPlans[][image]" accept="image/*">
            </div>
        </div>
        <button type="button" onclick="removeFloorPlan(this)" class="remove-button">Remove Floor Plan</button>
    `;
    container.appendChild(floorPlanDiv);
}

// Add other functions for handling amenities, specifications, gallery, and phases...

document.getElementById('projectUploadForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    try {
        const formData = new FormData(this);
        const projectData = {
            name: formData.get('name'),
            type: formData.get('type'),
            status: formData.get('status'),
            builder: formData.get('builder'),
            description: formData.get('description'),
            // Add all other form fields...
        };

        const response = await fetch('https://propertify.onrender.com/api/projects', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(projectData)
        });

        if (!response.ok) {
            throw new Error('Failed to save project');
        }

        showPopup('Project saved successfully!');
        resetProjectForm();
        loadProjectsList();
    } catch (error) {
        console.error('Error saving project:', error);
        showPopup('Failed to save project: ' + error.message);
    }
});

async function loadProjectsList() {
    try {
        const response = await fetch('https://propertify.onrender.com/api/projects');
        const projects = await response.json();
        
        const projectsList = document.getElementById('projectsList');
        projectsList.innerHTML = projects.map(project => `
            <div class="project-card">
                <div class="project-header">
                    <h3>${project.name}</h3>
                    <span class="project-status ${project.status.toLowerCase()}">${project.status}</span>
                </div>
                <div class="project-details">
                    <p><strong>Type:</strong> ${project.type}</p>
                    <p><strong>Total Units:</strong> ${project.overview.totalUnits}</p>
                    <p><strong>Location:</strong> ${project.location.city}</p>
                </div>
                <div class="project-actions">
                    <button onclick="editProject('${project._id}')">Edit</button>
                    <button onclick="deleteProject('${project._id}')">Delete</button>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading projects:', error);
        showPopup('Failed to load projects list');
    }
}

let builderMap, builderMarker;
let selectedProperties = new Set();

function initializeBuilderMap() {
    builderMap = new google.maps.Map(document.getElementById('builderMap'), {
        center: { lat: 20.5937, lng: 78.9629 }, // Center of India
        zoom: 5
    });

    builderMarker = new google.maps.Marker({
        map: builderMap,
        draggable: true
    });

    // Add click event for map
    google.maps.event.addListener(builderMap, 'click', function(event) {
        placeBuilderMarker(event.latLng);
    });

    // Add dragend event for marker
    google.maps.event.addListener(builderMarker, 'dragend', function(event) {
        updateBuilderLatLng(event.latLng);
    });
}

function placeBuilderMarker(location) {
    builderMarker.setPosition(location);
    builderMap.setCenter(location);
    updateBuilderLatLng(location);
}

function updateBuilderLatLng(location) {
    document.getElementById('builderLatitude').value = location.lat();
    document.getElementById('builderLongitude').value = location.lng();
}

// Property search functionality
let searchTimeout;
const propertySearch = document.getElementById('propertySearch');
const searchResults = document.getElementById('propertySearchResults');

propertySearch.addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(async () => {
        const searchTerm = this.value.trim();
        if (searchTerm.length < 2) {
            searchResults.innerHTML = '';
            return;
        }
        
        try {
            const response = await fetch(`https://propertify.onrender.com/api/properties/search?q=${searchTerm}`);
            const properties = await response.json();
            
            searchResults.innerHTML = properties.map(property => `
                <div class="search-result-item" onclick="selectProperty('${property.post_id}', '${property.post_title}')">
                    <img src="${property.post_image}" alt="${property.post_title}">
                    <div class="property-info">
                        <div class="property-title">${property.post_title}</div>
                        <div class="property-id">ID: ${property.post_id}</div>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error searching properties:', error);
        }
    }, 300);
});

function selectProperty(propertyId, propertyTitle) {
    if (selectedProperties.has(propertyId)) return;
    
    selectedProperties.add(propertyId);
    const propertyChips = document.querySelector('.property-chips');
    
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.innerHTML = `
        ${propertyTitle}
        <button onclick="removeProperty('${propertyId}', this)">&times;</button>
    `;
    propertyChips.appendChild(chip);
    
    // Clear search
    propertySearch.value = '';
    searchResults.innerHTML = '';
}

function removeProperty(propertyId, button) {
    selectedProperties.delete(propertyId);
    button.parentElement.remove();
}

// Form submission
document.getElementById('builderUploadForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const builderData = {
        name: formData.get('name'),
        logo: formData.get('logo'),
        experience: parseInt(formData.get('experience')),
        established: parseInt(formData.get('established')),
        description: formData.get('description'),
        contact: {
            email: formData.get('contact.email'),
            phone: formData.get('contact.phone'),
            website: formData.get('contact.website'),
            address: {
                street: formData.get('contact.address.street'),
                city: formData.get('contact.address.city'),
                state: formData.get('contact.address.state'),
                pincode: formData.get('contact.address.pincode'),
                location: {
                    type: 'Point',
                    coordinates: [
                        parseFloat(formData.get('contact.address.location.coordinates[0]')),
                        parseFloat(formData.get('contact.address.location.coordinates[1]'))
                    ]
                }
            }
        },
        properties: Array.from(selectedProperties)
    };

    try {
        const response = await fetch('https://propertify.onrender.com/api/builders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(builderData)
        });

        if (!response.ok) {
            throw new Error('Failed to upload builder');
        }

        const result = await response.json();
        showPopup('Builder uploaded successfully!');
        resetBuilderForm();
        loadBuildersList();
    } catch (error) {
        console.error('Error uploading builder:', error);
        showPopup('Failed to upload builder: ' + error.message);
    }
});

function resetBuilderForm() {
    document.getElementById('builderUploadForm').reset();
    selectedProperties.clear();
    document.querySelector('.property-chips').innerHTML = '';
    if (builderMarker) builderMarker.setPosition(null);
}

async function loadBuildersList() {
    try {
        const response = await fetch('https://propertify.onrender.com/api/builders');
        const builders = await response.json();
        
        const buildersList = document.getElementById('buildersList');
        buildersList.innerHTML = builders.map(builder => `
            <div class="builder-card">
                <div class="builder-header">
                    <img src="${builder.logo || 'placeholder-logo.png'}" alt="${builder.name}">
                    <h3>${builder.name}</h3>
                </div>
                <div class="builder-info">
                    <p>Experience: ${builder.experience} years</p>
                    <p>Properties: ${builder.properties.length}</p>
                </div>
                <div class="builder-actions">
                    <button onclick="editBuilder('${builder._id}')">Edit</button>
                    <button onclick="deleteBuilder('${builder._id}')">Delete</button>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading builders:', error);
        showPopup('Failed to load builders list');
    }
}

        let itemCounter = 0;
        var currentListName = '';


        // Load all carousels
        async function loadCarousels() {
            try {
                const response = await fetch('/api/carousels');
                const carousels = await response.json();
                displayCarousels(carousels);
            } catch (error) {
                console.error('Error loading carousels:', error);
                showPopup('Failed to load carousels');
            }
        }

        // Display carousels in list
        function displayCarousels(carousels) {
            const container = document.getElementById('carouselList');
            container.innerHTML = '<h2>Existing Carousels</h2>';

            carousels.forEach(carousel => {
                const div = document.createElement('div');
                div.className = 'carousel-entry';
                div.innerHTML = `
            <div>
                <strong>${carousel.name}</strong> (${carousel.carouselId})
                <br>
                Items: ${carousel.items.length}
            </div>
            <div>
                <button onclick="editCarousel('${carousel.carouselId}')">Edit</button>
                <button onclick="deleteCarousel('${carousel.carouselId}')">Delete</button>
            </div>
        `;
                container.appendChild(div);
            });
        }

        function addCarouselItem() {
            const template = document.getElementById('carouselItemTemplate');
            const container = document.getElementById('carouselItems');

            const clone = template.content.cloneNode(true);
            const div = clone.querySelector('.carousel-item');

            // Replace IDX with unique counter
            div.innerHTML = div.innerHTML.replace(/IDX/g, itemCounter++);
            div.querySelector('h4').textContent = `Item ${itemCounter}`;

            container.appendChild(div);
        }

        function removeCarouselItem(button) {
            button.closest('.carousel-item').remove();
        }

        async function editCarousel(carouselId) {
            try {
                const response = await fetch(`/api/carousels/${carouselId}`);
                const carousel = await response.json();

                // Populate form
                document.getElementById('carouselEditId').value = carousel._id;
                document.getElementById('carouselId').value = carousel.carouselId;
                document.getElementById('carouselName').value = carousel.name;
                document.getElementById('autoPlay').checked = carousel.autoPlay;
                document.getElementById('autoPlayInterval').value = carousel.autoPlayInterval;
                document.getElementById('showIndicator').checked = carousel.showIndicator;

                // Clear existing items
                document.getElementById('carouselItems').innerHTML = '';

                // Add existing items
                carousel.items.forEach(item => {
                    addCarouselItem();
                    const div = document.querySelector('.carousel-item:last-child');
                    div.querySelector('[id^="imageUrl_"]').value = item.imageUrl;
                    div.querySelector('[id^="title_"]').value = item.title;
                    div.querySelector('[id^="actionUrl_"]').value = item.actionUrl;
                    div.querySelector('[id^="propertyId_"]').value = item.propertyId;
                    div.querySelector('[id^="category_"]').value = item.category;
                });

            } catch (error) {
                console.error('Error loading carousel:', error);
                showPopup('Failed to load carousel');
            }
        }

        async function deleteCarousel(carouselId) {
            if (!confirm('Are you sure you want to delete this carousel?')) return;

            try {
                const response = await fetch(`/api/carousels/${carouselId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Failed to delete carousel');

                showPopup('Carousel deleted successfully');
                loadCarousels();
            } catch (error) {
                console.error('Error deleting carousel:', error);
                showPopup('Failed to delete carousel');
            }
        }

        // Handle form submission
        document.getElementById('carouselForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                carouselId: document.getElementById('carouselId').value,
                name: document.getElementById('carouselName').value,
                autoPlay: document.getElementById('autoPlay').checked,
                autoPlayInterval: parseInt(document.getElementById('autoPlayInterval').value),
                showIndicator: document.getElementById('showIndicator').checked,
                items: []
            };

            // Gather items
            document.querySelectorAll('.carousel-item').forEach(item => {
                formData.items.push({
                    imageUrl: item.querySelector('[id^="imageUrl_"]').value,
                    title: item.querySelector('[id^="title_"]').value,
                    actionUrl: item.querySelector('[id^="actionUrl_"]').value,
                    propertyId: item.querySelector('[id^="propertyId_"]').value || null,
                    category: item.querySelector('[id^="category_"]').value
                });
            });

            try {
                const editId = document.getElementById('carouselEditId').value;
                const method = editId ? 'PUT' : 'POST';
                const url = editId ? `/api/carousels/${editId}` : '/api/carousels';

                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) throw new Error('Failed to save carousel');

                showPopup('Carousel saved successfully');
                document.getElementById('carouselForm').reset();
                document.getElementById('carouselItems').innerHTML = '';
                loadCarousels();
            } catch (error) {
                console.error('Error saving carousel:', error);
                showPopup('Failed to save carousel');
            }
        });


        document.addEventListener('DOMContentLoaded', function () {
            const deeplinkForm = document.getElementById('deeplinkForm');
            const generatedDeeplink = document.getElementById('generatedDeeplink');
            const copyDeeplinkButton = document.getElementById('copyDeeplink');

            deeplinkForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(deeplinkForm);
                const params = new URLSearchParams();

                for (const [key, value] of formData.entries()) {
                    if (value) {
                        if (key === 'amenities') {
                            const amenitiesArray = value.split(',').map(item => item.trim());
                            amenitiesArray.forEach((amenity, index) => {
                                params.append(`amenities[${index}]`, amenity);
                            });
                        } else {
                            params.append(key, value);
                        }
                    }
                }

                const deeplink = `ofo://filter?${params.toString()}`;
                generatedDeeplink.textContent = deeplink;
            });

            copyDeeplinkButton.addEventListener('click', function () {
                navigator.clipboard.writeText(generatedDeeplink.textContent).then(() => {
                    alert('Deeplink copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            // Arrays of options
            const propertyTypes = ["Apartment", "House", "Villa", "Office", "Shop", "Warehouse", "Land"];
            const viewTypes = ["City View", "Sea View", "Mountain View", "Garden View", "Park View"];
            const propertyConditions = ["Brand New", "Newly Renovated", "Well Maintained", "Needs Minor Repairs", "Needs Major Renovation"];
            const legalStatuses = ["Clear Title", "Freehold", "Leasehold", "Power of Attorney", "Cooperative Society"];
            const constructionStatuses = ["Not Started", "Under Construction", "Completed", "Renovating"];
            const ownershipTypes = ["Freehold", "Leasehold", "Cooperative", "Condominium", "Timeshare"];
            const financingOptions = ["Conventional Mortgage", "FHA Loan", "VA Loan", "Cash Only"];
            const propertyTaxClasses = ["Residential", "Commercial", "Industrial", "Agricultural"];
            const environmentalCertifications = ["LEED Certified", "ENERGY STAR", "BREEAM", "Green Globes"];
            const propertyManagementServices = ["Full Service", "Partial Service", "On-Call Service"];
            const investmentStrategies = ["Buy and Hold", "Fix and Flip", "Rental Income", "Development"];
            const amenities = [
                "Swimming Pool", "Gym", "Sauna", "Jacuzzi", "Children's Play Area",
                "BBQ Area", "Garden", "Rooftop Terrace", "Security System",
                "Concierge Service", "Parking", "Elevator", "Pet-Friendly",
                "Wheelchair Accessible", "Storage Space", "Laundry Facility"
            ];
            const facilities = [
                "24/7 Security", "CCTV", "Visitor Parking", "High-Speed Internet",
                "Satellite/Cable TV", "Central Air Conditioning", "Central Heating",
                "Backup Generator", "Solar Panels", "Water Treatment Plant",
                "Fire Safety System", "Earthquake Resistant", "Waste Management",
                "Electric Vehicle Charging", "Bicycle Storage"
            ];


            // Function to populate select elements
            function populateSelect(selectId, options) {
                const select = document.getElementById(selectId);
                if (select) {
                    options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.textContent = option;
                        optionElement.value = option.toLowerCase().replace(/\s+/g, '-');
                        select.appendChild(optionElement);
                    });
                }
            }

            // Function to populate multi-select elements
            function populateMultiSelect(selectId, options) {
                const select = document.getElementById(selectId);
                if (select) {
                    options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.textContent = option;
                        optionElement.value = option.toLowerCase().replace(/\s+/g, '-');
                        select.appendChild(optionElement);
                    });
                }
            }

            // Populate multi-select fields
            populateMultiSelect('amenitiess', amenities);
            populateMultiSelect('facilitiess', facilities);

            // Populate single-select fields
            populateSelect('propertyType', propertyTypes);
            populateSelect('viewType', viewTypes);
            populateSelect('propertyCondition', propertyConditions);
            populateSelect('legalStatus', legalStatuses);
            populateSelect('constructionStatus', constructionStatuses);
            populateSelect('ownershipType', ownershipTypes);
            populateSelect('propertyTaxClass', propertyTaxClasses);
            populateSelect('investmentStrategy', investmentStrategies);

            // Populate multi-select fields
            populateMultiSelect('financingOptions', financingOptions);
            populateMultiSelect('environmentalCertifications', environmentalCertifications);
            populateMultiSelect('propertyManagementServices', propertyManagementServices);

            // Populate new multi-select fields for Property Upload Form
            populateMultiSelect('amenitiess', amenities);
            populateMultiSelect('facilitiess', facilities);


            // Populate building form fields
            populateSelect('buildingType', propertyTypes);
            populateSelect('buildingCondition', propertyConditions);
            populateSelect('buildingLegalStatus', legalStatuses);
            populateSelect('buildingConstructionStatus', constructionStatuses);
            populateSelect('buildingOwnershipType', ownershipTypes);
            populateMultiSelect('buildingEnvironmentalCertifications', environmentalCertifications);
        });




        let categories = [];

        async function loadCategories() {
            try {
                const response = await fetch('https://propertify.onrender.com/api/categories');
                categories = await response.json();
                displayCategories();
            } catch (error) {
                console.error('Error loading categories:', error);
                showPopup('Failed to load categories. Please try again.');
            }
        }
        function displayCategories() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.innerHTML = `
            <p>${category.name} - Icon: ${category.iconUrl}</p>
            <button onclick="editCategory('${category._id}')">Edit</button>
            <button onclick="deleteCategory('${category._id}')">Delete</button>
        `;
                categoryList.appendChild(categoryElement);
            });
        }

        function editCategory(id) {
            const category = categories.find(c => c.id === id);
            if (category) {
                document.getElementById('categoryId').value = category.id;
                document.getElementById('categoryName').value = category.name;
                document.getElementById('categoryIcon').value = category.iconUrl;
            }
        }

        async function saveCategory(event) {
            event.preventDefault();
            const categoryId = document.getElementById('categoryId').value;
            const categoryData = {
                name: document.getElementById('categoryName').value,
                iconUrl: document.getElementById('categoryIcon').value
            };
            try {
                let response;
                if (categoryId) {
                    // Update existing category
                    response = await fetch(`https://propertify.onrender.com/api/categories/${categoryId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(categoryData)
                    });
                } else {
                    // Add new category
                    response = await fetch('https://propertify.onrender.com/api/categories', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ categories: [categoryData] })
                    });
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                showPopup('Category saved successfully!');
                document.getElementById('categoryForm').reset();
                document.getElementById('categoryId').value = '';
                await loadCategories();
            } catch (error) {
                console.error('Error saving category:', error);
                showPopup('Failed to save category. Please try again.');
            }
        }

        async function deleteCategory(id) {
            if (confirm('Are you sure you want to delete this category?')) {
                try {
                    const response = await fetch(`https://propertify.onrender.com/api/categories/${id}`, {
                        method: 'DELETE'
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    showPopup('Category deleted successfully!');
                    await loadCategories();
                } catch (error) {
                    console.error('Error deleting category:', error);
                    showPopup('Failed to delete category. Please try again.');
                }
            }
        }


        document.getElementById("buildingUploadForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);

            const buildingData = {
                buildingId: formData.get('buildingId'),
                name: formData.get('name'),
                frontRoad: formData.get('frontRoad'),
                parkingArea: formData.get('parkingArea'),
                description: formData.get('description'),
                areaUSP: formData.get('areaUSP'),
                ownerName: formData.get('ownerName'),
                ownerId: formData.get('ownerId'),
                storey: formData.get('storey'),
                age: formData.get('age'),
                type: formData.get('type'),
                luda: formData.get('luda'),
                totalProperties: formData.get('totalProperties'),
                developmentStatus: formData.get('developmentStatus'),
                allowPreBooking: formData.get('allowPreBooking') === 'on',
                allocatedProperties: formData.get('allocatedProperties'),
                freeProperties: formData.get('freeProperties'),
                contactNumber: formData.get('contactNumber'),
                numberOfFlatsAvailable: parseInt(formData.get('numberOfFlatsAvailable')),
                totalFloors: parseInt(formData.get('totalFloors')),
                flatsDetails: [],
                areaUSP: formData.get('areaUSP'),
                brochureLink: formData.get('brochureLink'),
                mapLink: formData.get('mapLink'),
                connectedProperties: formData.get('connectedProperties').split(',').map(id => id.trim()),
                location: {
                    type: 'Point',
                    coordinates: [
                        parseFloat(formData.get('longitude')),
                        parseFloat(formData.get('latitude'))
                    ]
                }

            };

            for (let i = 1; i <= buildingData.totalFloors; i++) {
                buildingData.flatsDetails.push({
                    floorNumber: i,
                    flatsOnFloor: parseInt(formData.get(`flatsOnFloor${i}`)),
                    availableFlats: parseInt(formData.get(`availableFlats${i}`))
                });
            }

            const galleryImages = form.querySelector('input[name="galleryList"]').files;
            const apiFormData = new FormData();
            for (let i = 0; i < galleryImages.length; i++) {
                apiFormData.append('galleryList', galleryImages[i]);
            }

            apiFormData.append('data', JSON.stringify(buildingData));
            try {
                const response = await fetch('https://propertify.onrender.com/api/buildings/saveBuildingDetails', {
                    method: 'POST',
                    body: apiFormData
                });

                if (!response.ok) {
                    throw new Error('Failed to upload building details');
                }

                const result = await response.json();
                console.log('Building details uploaded successfully:', result);
                alert('Building details uploaded successfully!');
                form.reset();
            } catch (error) {
                console.error('Error uploading building details:', error);
                alert('Failed to upload building details. Please try again.');
            }
        });

        document.getElementById('totalFloors').addEventListener('change', function (e) {
            const totalFloors = parseInt(e.target.value);
            const container = document.getElementById('flatsDetailsContainer');
            container.innerHTML = '<h3>Flats Details</h3>';

            for (let i = 1; i <= totalFloors; i++) {
                container.innerHTML += `
      <div>
        <h4>Floor ${i}</h4>
        <label for="flatsOnFloor${i}">Number of Flats on Floor:</label>
        <input type="number" id="flatsOnFloor${i}" name="flatsOnFloor${i}" required>
        <label for="availableFlats${i}">Available Flats on Floor:</label>
        <input type="number" id="availableFlats${i}" name="availableFlats${i}" required>
      </div>
    `;
            }
        });


        ////////
        function showPropertyPopup(formData) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');

            let message = '<h3>Property Details:</h3><ul>';
            for (let [key, value] of formData.entries()) {
                if (key !== 'post_image' && key !== 'floor_plan_image' && key !== 'gallery_images') {
                    message += `<li><strong>${key}:</strong> ${value}</li>`;
                } else {
                    message += `<li><strong>${key}:</strong> ${value.name}</li>`;
                }
            }
            message += '</ul><p>Do you want to upload this property?</p>';
            message += '<button onclick="confirmUpload()">Yes, Upload</button> ';
            message += '<button onclick="cancelUpload()">Cancel</button>';

            popupMessage.innerHTML = message;
            popup.style.display = 'block';
        }

        let propertyFormData;


        let map, marker;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 0, lng: 0 },
                zoom: 2
            });

            marker = new google.maps.Marker({
                map: map,
                draggable: true
            });

            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(event.latLng);
            });

            google.maps.event.addListener(marker, 'dragend', function (event) {
                updateLatLng(event.latLng);
            });

            document.getElementById('getCurrentLocation').addEventListener('click', getCurrentLocation);
        }

        function placeMarker(location) {
            marker.setPosition(location);
            map.setCenter(location);
            updateLatLng(location);
        }

        function updateLatLng(location) {
            document.getElementById('latitude').value = location.lat();
            document.getElementById('longitude').value = location.lng();
            updateLocationDisplay(location);
        }

        function updateLocationDisplay(location) {
            const locationDisplay = document.getElementById('locationDisplay');
            locationDisplay.textContent = `Latitude: ${location.lat().toFixed(6)}, Longitude: ${location.lng().toFixed(6)}`;
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        placeMarker(pos);
                        map.setZoom(15);
                    },
                    () => {
                        handleLocationError(true, map.getCenter());
                    }
                );
            } else {
                handleLocationError(false, map.getCenter());
            }
        }
        function handleLocationError(browserHasGeolocation, pos) {
            alert(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
        }


        document.querySelector('button[onclick="openTab(event, \'PropertyUpload\')"]').addEventListener('click', function () {
            setTimeout(initMap, 0);
        });


        // Add this function at the start of your script
        function prefillForm() {
            // Helper function to set value for single inputs
            function setValue(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = value;
                    } else {
                        element.value = value;
                    }
                }
            }

            // Helper function to set multiple select values
            function setMultipleSelect(id, values) {
                const element = document.getElementById(id);
                if (element) {
                    Array.from(element.options).forEach(option => {
                        option.selected = values.includes(option.value);
                    });
                }
            }

            // Basic Information
            setValue('post_title', '3BHK Luxury Apartment');
            setValue('type_name', 'Apartment');
            setValue('purpose', 'Rent');
            setValue('building_id', 'BUILD123');
            setValue('price', '25000');
            setValue('priceUnit', 'INR');
            setValue('area', '1500');
            setValue('areaUnit', 'sqft');
            setValue('bedrooms', '3');
            setValue('bathrooms', '2');
            setValue('floor', '5');
            setValue('furnishing', 'Semi-Furnished');
            setValue('furnishStatus', 'Ready to move');
            setValue('carpetArea', '1200');
            setValue('superBuiltupArea', '1500');
            setValue('available', true);
            setValue('category', '1');
            setValue('region', 'City Center');

            // Status and Additional Info
            setValue('construction_status', 'Ready');
            setValue('possession', 'Immediate');
            setValue('broker_status', 'Verified');
            setValue('agreement', '11 months');
            setValue('address', '123 Main Street, City Center');
            setValue('post_description', 'Luxurious 3BHK apartment with modern amenities, great location, and beautiful views.');
            setValue('latitude', '28.6139');
            setValue('longitude', '77.2090');

            // Multiple Selections
            setMultipleSelect('financingOptions', ['conventional-mortgage', 'fha-loan']);
            setMultipleSelect('environmentalCertifications', ['leed-certified', 'energy-star']);
            setMultipleSelect('propertyManagementServices', ['full-service', 'on-call-service']);
            setMultipleSelect('amenitiess', ['swimming-pool', 'gym', 'parking']);
            setMultipleSelect('facilitiess', ['24/7-security', 'backup-generator']);

            // Set values for chip inputs
            setValue('amenities', 'Gym, Swimming Pool, Security');
            setValue('usp', 'Prime Location, Metro Nearby');
            setValue('location_advantage', 'Near Metro, Shopping Mall');
            setValue('facilities', '24x7 Security, Power Backup');
            setValue('tags', 'Premium, Family-Friendly');
            setValue('contactList', '9876543210, 8765432109');

            // Additional Fields
            setValue('viewType', 'city-view');
            setValue('propertyCondition', 'well-maintained');
            setValue('legalStatus', 'clear-title');
            setValue('ownershipType', 'freehold');
            setValue('propertyTaxClass', 'residential');
            setValue('investmentStrategy', 'rental-income');

            // Location Fields
            if (map && marker) {
                const position = new google.maps.LatLng(28.6139, 77.2090);
                marker.setPosition(position);
                map.setCenter(position);
                map.setZoom(15);
                updateLatLng(position);
            }
        }

        // Add button to HTML for testing
        const prefillButton = document.createElement('button');
        prefillButton.type = 'button';
        prefillButton.textContent = 'Pre-fill Form (Testing)';
        prefillButton.className = 'prefill-button';
        prefillButton.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
`;
        prefillButton.onclick = prefillForm;

        // Add button to document when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            document.body.appendChild(prefillButton);
        });



        const propertyUploadForm = document.getElementById('propertyUploadForm');

        if (!propertyUploadForm) {
            console.error('Property upload form not found!');
        } else {
            propertyUploadForm.onsubmit = async function (e) {
                // Prevent the default form submission
                e.preventDefault();

                try {
                    // Create FormData object
                    const formData = new FormData();

                    // Helper function for multiple select values
                    function getMultiSelectValues(id) {
                        const element = document.getElementById(id);
                        if (!element) {
                            console.warn(`Multiple select with id '${id}' not found`);
                            return [];
                        }
                        return Array.from(element.selectedOptions).map(opt => opt.value);
                    }

                    // Prepare property data object
                    const propertyData = {
                        // Basic Information
                        post_title: document.getElementById('post_title').value,
                        type_name: document.getElementById('type_name').value,
                        purpose: document.getElementById('purpose').value,
                        building_id: document.getElementById('building_id').value || null,
                        price: parseFloat(document.getElementById('price').value),
                        priceUnit: document.getElementById('priceUnit').value,
                        area: parseFloat(document.getElementById('area').value),
                        areaUnit: document.getElementById('areaUnit').value,
                        bedrooms: parseInt(document.getElementById('bedrooms').value),
                        bathrooms: parseInt(document.getElementById('bathrooms').value),
                        floor: document.getElementById('floor').value,
                        furnishing: document.getElementById('furnishing').value,

                        // Additional Details
                        carpetArea: parseFloat(document.getElementById('carpetArea').value) || null,
                        superBuiltupArea: parseFloat(document.getElementById('superBuiltupArea').value) || null,
                        available: document.getElementById('available').checked,
                        category: parseInt(document.getElementById('category').value) || null,
                        region: document.getElementById('region').value,
                        possession: document.getElementById('possession').value,
                        agreement: document.getElementById('agreement').value,

                        // Location
                        address: document.getElementById('address').value,
                        location: {
                            type: 'Point',
                            coordinates: [
                                parseFloat(document.getElementById('longitude').value),
                                parseFloat(document.getElementById('latitude').value)
                            ]
                        },

                        // Description
                        post_description: document.getElementById('post_description').value,

                        // Contact Information
                        contactList: document.getElementById('contactList').value
                            ? document.getElementById('contactList').value.split(',').map(contact => contact.trim())
                            : [],

                        // Multiple Select Fields
                        financingOptions: getMultiSelectValues('financingOptions'),
                        environmentalCertifications: getMultiSelectValues('environmentalCertifications'),
                        propertyManagementServices: getMultiSelectValues('propertyManagementServices'),
                        amenities: getMultiSelectValues('amenitiess'),
                        facilities: getMultiSelectValues('facilitiess'),




                        // Additional Attributes
                        viewTypes: document.getElementById('viewType').value,
                        propertyConditions: document.getElementById('propertyCondition').value,
                        legalStatuses: document.getElementById('legalStatus').value,
                        constructionStatuses: document.getElementById('constructionStatus').value,
                        ownershipTypes: document.getElementById('ownershipType').value,
                        propertyTaxClasses: document.getElementById('propertyTaxClass').value,
                        investmentStrategies: document.getElementById('investmentStrategy').value
                    };

                    // Append the property data as a JSON string
                    formData.append('data', JSON.stringify(propertyData));

                    // Handle image files
                    const postImage = document.getElementById('post_image').files[0];
                    if (postImage) {
                        formData.append('post_image', postImage);
                    }

                    const floorPlanImage = document.getElementById('floor_plan_image').files[0];
                    if (floorPlanImage) {
                        formData.append('floor_plan_image', floorPlanImage);
                    }

                    const galleryImages = document.getElementById('gallery_images').files;
                    if (galleryImages.length > 0) {
                        Array.from(galleryImages).forEach(file => {
                            formData.append('galleryList', file);
                        });
                    }

                    // Log the data being sent
                    console.log('Submitting property data:', propertyData);
                    console.log('Files being uploaded:', {
                        post_image: postImage?.name,
                        floor_plan_image: floorPlanImage?.name,
                        gallery_images: Array.from(galleryImages || []).map(f => f.name)
                    });

                    // Make the API request
                    const response = await fetch('https://propertify.onrender.com/api/upload/property', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    console.log('Upload success:', result);
                    showPopup('Property uploaded successfully!');

                    // Reset form and clear previews
                    this.reset();
                    clearImagePreviews();
                    clearChips();

                    if (typeof marker !== 'undefined' && marker) {
                        marker.setPosition(null);
                    }

                } catch (error) {
                    console.error('Error uploading property:', error);
                    showPopup('Error uploading property: ' + error.message);
                }

                // Return false to ensure the form doesn't submit traditionally
                return false;
            };
        }

        // Also add a button type attribute to your submit button if not already present
        document.querySelector('#propertyUploadForm button[type="submit"]')?.setAttribute('type', 'submit');
        function showPopup(message, isHTML = false) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            if (isHTML) {
                popupMessage.innerHTML = message;
            } else {
                popupMessage.textContent = message;
            }
            popup.style.display = 'block';
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function clearImagePreviews() {
            document.getElementById('post_image_preview').style.display = 'none';
            document.getElementById('floor_plan_image_preview').style.display = 'none';
            document.getElementById('gallery_images_preview').innerHTML = '';
        }

        function clearChips() {
            const chipContainers = document.querySelectorAll('.chip-container');
            chipContainers.forEach(container => container.innerHTML = '');
            const hiddenInputs = document.querySelectorAll('input[type="hidden"]');
            hiddenInputs.forEach(input => input.value = '');
        }

        // Image preview functionality
        document.getElementById('post_image').addEventListener('change', function (e) {
            previewImage(this, 'post_image_preview');
        });

        document.getElementById('floor_plan_image').addEventListener('change', function (e) {
            previewImage(this, 'floor_plan_image_preview');
        });

        document.getElementById('gallery_images').addEventListener('change', function (e) {
            const preview = document.getElementById('gallery_images').addEventListener('change', function (e) {
                const preview = document.getElementById('gallery_images_preview');
                preview.innerHTML = '';
                for (const file of this.files) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'image-upload-preview';
                    preview.appendChild(img);
                }
            });
        });

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        let newOptionCount = 1;
        document.getElementById('newListOptionForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const listName = document.getElementById('newListName').value;
            const options = [];

            for (let i = 0; i < newOptionCount; i++) {
                const imageLink = document.getElementById(`newImageLink${i}`)?.value;
                const textView = document.getElementById(`newTextView${i}`)?.value;
                const link = document.getElementById(`newLink${i}`)?.value;

                if (imageLink && textView && link) {
                    options.push({ imagelink: imageLink, textview: textView, link: link });
                }
            }

            try {
                const response = await fetch(`${BASE_URL}/api/list-options/add-complete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ listName, options })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('List option added/updated:', result);
                showPopup(result.message); // This will show "List updated successfully" or "List created successfully"

                // Reset the form
                this.reset();
                document.getElementById('newOptionsContainer').innerHTML = `
            <div class="option-item">
                <label for="newImageLink0">Image Link:</label>
                <input type="text" id="newImageLink0" required>
                <label for="newTextView0">Text View:</label>
                <input type="text" id="newTextView0" required>
                <label for="newLink0">Link:</label>
                <input type="text" id="newLink0" required>
            </div>
        `;
                newOptionCount = 1;

                // Refresh the list of available list options in the dropdown
                await loadAvailableLists();

            } catch (error) {
                console.error('Error adding/updating list option:', error);
                showPopup('Failed to add/update list option. Please try again.');
            }
        });

        // Function to load available lists

        const BASE_URL = 'https://propertify.onrender.com';


        async function loadAvailableLists() {
            try {
                const response = await fetch(`${BASE_URL}/api/list-options`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const lists = await response.json();

                const listSelector = document.getElementById('listSelector');
                listSelector.innerHTML = '<option value="">Select a list</option>';
                lists.forEach(list => {
                    const option = document.createElement('option');
                    option.value = list.listName;
                    option.textContent = list.listName;
                    listSelector.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading available lists:', error);
                showPopup('Failed to load available lists. Please try again.  ' + error);
            }
        }




        document.addEventListener('DOMContentLoaded', loadAvailableLists);

        function showPopup(message) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');

            if (message.includes('\n')) {
                // Multiline message, use a <pre> tag
                popupMessage.innerHTML = `<pre>${message}</pre>`;
            } else {
                // Single-line message, use regular text
                popupMessage.textContent = message;
            }

            popup.style.display = 'block';

            // Hide the popup after 3 seconds
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        let allBuildings = [];
        let allProperties = [];

        async function loadBuildingsAndProperties() {
            try {
                const [buildingsResponse, propertiesResponse] = await Promise.all([
                    fetch('https://propertify.onrender.com/api/buildings'),
                    fetch('https://propertify.onrender.com/api/properties/all')
                ]);

                allBuildings = await buildingsResponse.json();
                allProperties = await propertiesResponse.json();

                displayBuildingsAndProperties();
                setupSearch();
            } catch (error) {
                console.error('Error loading buildings and properties:', error);
                showPopup('Failed to load buildings and properties. Please try again.');
            }
        }

        function displayBuildingsAndProperties() {
            const grid = document.getElementById('buildingsPropertiesGrid');
            grid.innerHTML = '';

            // Display buildings
            allBuildings.forEach(building => {
                const buildingElement = createBuildingElement(building);
                grid.appendChild(buildingElement);
            });

            // Display properties
            allProperties.forEach(property => {
                const propertyElement = createPropertyElement(property);
                grid.appendChild(propertyElement);
            });
        }

        function createBuildingElement(building) {
            const buildingElement = document.createElement('div');
            buildingElement.className = 'grid-item building';
            buildingElement.innerHTML = `
                <h3>Building: ${building.name}</h3>
                <img src="${building.galleryList[0] || 'placeholder-building-image.jpg'}" alt="${building.name}">
                <p><strong>ID:</strong> ${building.buildingId}</p>
                <p><strong>Address:</strong> ${building.address || 'N/A'}</p>
                <div class="building-properties">
                    <h4>Associated Properties:</h4>
                    ${getAssociatedProperties(building.buildingId)}
                </div>
            `;
            return buildingElement;
        }

        function createPropertyElement(property) {
            const propertyElement = document.createElement('div');
            propertyElement.className = 'grid-item property';
            propertyElement.innerHTML = `
        <h3>Property: ${property.post_title}</h3>
        <img src="${property.post_image || 'placeholder-property-image.jpg'}" alt="${property.post_title}">
        <p><strong>ID:</strong> ${property.post_id}</p>
        <p><strong>Type:</strong> ${property.type_name}</p>
        <p><strong>Building:</strong> ${getBuildingName(property.building_id) || 'Not assigned'}</p>
        <div class="connect-property">
            <select id="building-select-${property.post_id}">
                <option value="">Select a building</option>
                ${allBuildings.map(b => `<option value="${b.buildingId}">${b.name}</option>`).join('')}
            </select>
            <button onclick="connectPropertyToBuilding('${property.post_id}')">Connect</button>
        </div>
    `;
            return propertyElement;
        }

        function getAssociatedProperties(buildingId) {
            const associatedProperties = allProperties.filter(p => p.building_id === buildingId);
            if (associatedProperties.length === 0) {
                return '<p>No properties associated</p>';
            }
            return associatedProperties.map(p => `<div class="property-item">${p.post_title}</div>`).join('');
        }

        function getBuildingName(buildingId) {
            const building = allBuildings.find(b => b.buildingId === buildingId);
            return building ? building.name : null;
        }

        async function connectPropertyToBuilding(propertyId) {
            const selectElement = document.getElementById(`building-select-${propertyId}`);
            const buildingId = selectElement.value;

            if (!buildingId) {
                showPopup('Please select a building to connect.');
                return;
            }

            console.log('Connecting property:', propertyId, 'to building:', buildingId);

            try {
                const response = await fetch(`https://propertify.onrender.com/api/properties/${propertyId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ building_id: buildingId }),
                });

                const responseData = await response.json();

                if (!response.ok) {
                    throw new Error(`Failed to update property: ${response.status} ${response.statusText}. ${JSON.stringify(responseData)}`);
                }

                showPopup('Property connected to building successfully!');
                await loadBuildingsAndProperties();
            } catch (error) {
                console.error('Error connecting property to building:', error);
                showPopup(`Failed to connect property to building. Error: ${error.message}`);
            }
        }


        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const gridItems = document.querySelectorAll('.grid-item');

            searchInput.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                gridItems.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
        }

        function createBuildingElement(building) {
            const buildingElement = document.createElement('div');
            buildingElement.className = 'grid-item building';
            buildingElement.innerHTML = `
                <h3>Building: ${building.name}</h3>
                <img src="${building.galleryList[0] || 'placeholder-building-image.jpg'}" alt="${building.name}">
                <p><strong>ID:</strong> ${building.buildingId}</p>
                <p><strong>Address:</strong> ${building.address || 'N/A'}</p>
                <div class="building-properties">
                    <h4>Associated Properties:</h4>
                    ${getAssociatedProperties(building.buildingId)}
                </div>
                <button class="delete-button" onclick="deleteBuilding('${building.buildingId}')">Delete Building</button>
            `;
            return buildingElement;
        }

        function createPropertyElement(property) {
            const propertyElement = document.createElement('div');
            propertyElement.className = 'grid-item property';
            propertyElement.innerHTML = `
                <h3>Property: ${property.post_title}</h3>
                <img src="${property.post_image || 'placeholder-property-image.jpg'}" alt="${property.post_title}">
                <p><strong>ID:</strong> ${property.post_id}</p>
                <p><strong>Type:</strong> ${property.type_name}</p>
                <p><strong>Building:</strong> ${getBuildingName(property.building_id) || 'Not assigned'}</p>
                <div class="connect-property">
                    <select id="building-select-${property.post_id}">
                        <option value="">Select a building</option>
                        ${allBuildings.map(b => `<option value="${b.buildingId}">${b.name}</option>`).join('')}
                    </select>
                    <button onclick="connectPropertyToBuilding('${property.post_id}')">Connect</button>
                </div>
                <button class="delete-button" onclick="deleteProperty('${property.post_id}')">Delete Property</button>`;
            return propertyElement;
        }
        async function deleteProperty(propertyId) {
            if (!confirm('Are you sure you want to delete this property?')) {
                return;
            }

            try {
                const response = await fetch(`https://propertify.onrender.com/api/properties/${propertyId}`, {
                    method: 'DELETE'
                });

                const responseData = await response.json();

                if (!response.ok) {
                    throw new Error(responseData.message || 'Failed to delete property');
                }

                showPopup('Property deleted successfully!');
                await loadBuildingsAndProperties(); // Refresh the data
            } catch (error) {
                console.error('Error deleting property:', error);
                showPopup(`Failed to delete property: ${error.message}`);
            }
        }

        async function deleteBuilding(buildingId) {
            if (!confirm('Are you sure you want to delete this building? This will also remove the building association from all properties.')) {
                return;
            }

            try {
                // First, remove the building association from all properties
                const propertiesResponse = await fetch(`https://propertify.onrender.com/api/properties/building/${buildingId}`);
                const associatedProperties = await propertiesResponse.json();

                for (const property of associatedProperties) {
                    await fetch(`https://propertify.onrender.com/api/properties/${property.post_id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ building_id: null }),
                    });
                }

                // Then, delete the building
                const response = await fetch(`https://propertify.onrender.com/api/buildings/${buildingId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Failed to delete building');
                }

                showPopup('Building deleted successfully!');
                await loadBuildingsAndProperties(); // Refresh the data
            } catch (error) {
                console.error('Error deleting building:', error);
                showPopup('Failed to delete building. Please try again.');
            }
        }




        /////////////////////////////////


        document.getElementById('addNewOptionButton').addEventListener('click', function () {
            const container = document.getElementById('newOptionsContainer');
            const newOption = document.createElement('div');
            newOption.className = 'option-item';
            newOption.innerHTML = `
                <label for="newImageLink${newOptionCount}">Image Link:</label>
                <input type="text" id="newImageLink${newOptionCount}" required>
                <label for="newTextView${newOptionCount}">Text View:</label>
                    <input type="text" id="newTextView${newOptionCount}" required>
                    <label for="newLink${newOptionCount}">Link:</label>
                     <input type="text" id="newLink${newOptionCount}" required>
`;
            container.appendChild(newOption);
            newOptionCount++;
        });



        function openPropertyUpload() {
            window.location.href = '/property-upload';
        }

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            if (tabName === 'CarouselManagement') {
                loadCarousels();
            }

            if (tabName === 'CategoryManagement') {
                loadCategories();
            }

            if (tabName === 'ListOptions') {
                loadAvailableLists();
            }

            if (tabName === 'BuildingsProperties') {
                loadBuildingsAndProperties();
            }


            // Add PropertyEdit handling
            if (tabName === 'PropertyEdit') {
                // Initialize the property edit tab
                initializePropertyEdit();
            }


            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Set the default open tab
        document.getElementById("defaultOpen").click();

        document.addEventListener('DOMContentLoaded', function () {
            openTab("ImageGallery");

            console.log('Script started');

            function openTab(tabName) {
                console.log('Opening tab:', tabName);
                var tabcontent = document.getElementsByClassName("tabcontent");
                for (var i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].classList.remove("active");
                }
                var tablinks = document.getElementsByClassName("tablinks");
                for (var i = 0; i < tablinks.length; i++) {
                    tablinks[i].classList.remove("active");
                }
                document.getElementById(tabName).classList.add("active");
                document.querySelector(`[data-tab="${tabName}"]`).classList.add("active");
            }
            // Set the default open tab
            document.getElementById("defaultOpen").click();

            openTab("ImageGallery");
            console.log('Default tab opened');
        });
        document.addEventListener('DOMContentLoaded', loadImages);


        if (tabName === 'CategoryManagement') {
            loadCategories();
        }

        if (tabName === 'ProjectManagement') {
        initializeProjectManagement();
    }

        // Add click event listeners to tab buttons
        var tabButtons = document.getElementsByClassName("tablinks");
        for (var i = 0; i < tabButtons.length; i++) {
            tabButtons[i].addEventListener("click", function (event) {
                openTab(event, this.getAttribute("onclick").split("'")[1]);
            });

        }

        async function initializePropertyEdit() {
    try {
        // Reset the form and clear any previous data
        clearEditForm();
        
        // Load property list into selector
        await loadPropertyList();
        
        // Initialize map
        if (typeof google !== 'undefined') {
            initializeEditMap();
        }
        
        // Initialize all dropdowns with their options
        populateEditDropdowns();
        
        // Set up contact chips functionality
        initializeContactChips();
        
        // Set up image preview handlers
        setupImagePreviewHandlers();
        
        console.log('Property Edit tab initialized successfully');
    } catch (error) {
        console.error('Error initializing Property Edit tab:', error);
        showPopup('Error initializing edit form');
    }
}

// Function to initialize the map for property editing
function initializeEditMap() {
    const mapContainer = document.getElementById('edit_map');
    const map = new google.maps.Map(mapContainer, {
        center: { lat: 0, lng: 0 },
        zoom: 2
    });

    const marker = new google.maps.Marker({
        map: map,
        draggable: true
    });

    // Add click event listener to map
    google.maps.event.addListener(map, 'click', function(event) {
        marker.setPosition(event.latLng);
        updateEditLatLng(event.latLng);
    });

    // Add dragend event listener to marker
    google.maps.event.addListener(marker, 'dragend', function(event) {
        updateEditLatLng(event.latLng);
    });

    // Store map and marker references
    mapContainer.map = map;
    mapContainer.marker = marker;
}

// Function to update latitude and longitude fields
function updateEditLatLng(location) {
    document.getElementById('edit_latitude').value = location.lat();
    document.getElementById('edit_longitude').value = location.lng();
    document.getElementById('edit_locationDisplay').textContent = 
        `Latitude: ${location.lat().toFixed(6)}, Longitude: ${location.lng().toFixed(6)}`;
}

// Function to populate all dropdowns
function populateEditDropdowns() {
    // Property Type options
    const propertyTypes = ["Apartment", "House", "Villa", "Office", "Shop", "Warehouse", "Land"];
    populateDropdown('edit_type_name', propertyTypes);

    // View Type options
    const viewTypes = ["City View", "Sea View", "Mountain View", "Garden View", "Park View"];
    populateDropdown('edit_viewType', viewTypes);

    // Property Condition options
    const conditions = ["Brand New", "Newly Renovated", "Well Maintained", "Needs Minor Repairs", "Needs Major Renovation"];
    populateDropdown('edit_propertyCondition', conditions);

    // And so on for other dropdowns...
}

// Helper function to populate a dropdown
function populateDropdown(elementId, options) {
    const select = document.getElementById(elementId);
    if (!select) return;

    select.innerHTML = '<option value="">Select Option</option>';
    options.forEach(option => {
        const optionElement = document.createElement('option');
        optionElement.value = option.toLowerCase().replace(/\s+/g, '-');
        optionElement.textContent = option;
        select.appendChild(optionElement);
    });
}

// Function to set up image preview handlers
function setupImagePreviewHandlers() {
    // Main image preview
    document.getElementById('edit_post_image').addEventListener('change', function(e) {
        const preview = document.getElementById('edit_post_image_preview');
        handleImagePreview(this, preview);
    });

    // Floor plan preview
    document.getElementById('edit_floor_plan_image').addEventListener('change', function(e) {
        const preview = document.getElementById('edit_floor_plan_preview');
        handleImagePreview(this, preview);
    });

    // Gallery images preview
    document.getElementById('edit_gallery_images').addEventListener('change', function(e) {
        const preview = document.getElementById('edit_gallery_preview');
        handleGalleryPreview(this, preview);
    });
}

// Function to handle image preview
function handleImagePreview(input, preview) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Function to handle gallery preview
function handleGalleryPreview(input, previewContainer) {
    previewContainer.innerHTML = '';
    if (input.files) {
        Array.from(input.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = 'Gallery Preview';
                previewContainer.appendChild(img);
            };
            reader.readAsDataURL(file);
        });
    }
}

// Function to initialize contact chips
function initializeContactChips() {
    const input = document.getElementById('edit_contactListInput');
    const chipContainer = document.getElementById('edit_contactListChips');
    const hiddenInput = document.getElementById('edit_contactList');

    input.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            const value = this.value.trim();
            if (value) {
                addContactChip(value, chipContainer, hiddenInput);
                this.value = '';
            }
        }
    });
}

// Function to add a contact chip
function addContactChip(value, container, hiddenInput) {
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.innerHTML = `
        ${value}
        <button type="button" onclick="removeContactChip(this)">&times;</button>
    `;
    container.appendChild(chip);
    updateHiddenContactInput(container, hiddenInput);
}

// Function to remove a contact chip
function removeContactChip(button) {
    const chip = button.parentElement;
    const container = chip.parentElement;
    const hiddenInput = document.getElementById('edit_contactList');
    chip.remove();
    updateHiddenContactInput(container, hiddenInput);
}

// Function to update hidden contact input
function updateHiddenContactInput(container, hiddenInput) {
    const contacts = Array.from(container.querySelectorAll('.chip'))
        .map(chip => chip.textContent.trim().replace('×', ''));
    hiddenInput.value = contacts.join(',');
}




        document.addEventListener('DOMContentLoaded', function () {
            const BASE_URL = 'https://propertify.onrender.com';

        });


        async function loadListOptions() {
            const listName = document.getElementById('listSelector').value;
            if (!listName) {
                console.log('No list selected');
                return;
            }


            try {
                console.log('Fetching list options for:', listName);
                currentListName = listName;

                const response = await fetch(`https://propertify.onrender.com/api/list-options/${listName}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Received data:', data);

                if (!data || !data.options) {
                    console.error('Invalid data format received');
                    showPopup('Invalid data format received from server');
                    return;
                }

                displayOptions(data.options);
                document.getElementById('deleteListButton').style.display = 'block';
            } catch (error) {
                console.error('Error loading options:', error);
                showPopup('Failed to load options. Please try again.' + error);
            }

        }


        function displayOptions(options) {
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';

            if (!Array.isArray(options) || options.length === 0) {
                optionsList.innerHTML = '<p>No options found for this list</p>';
                return;
            }

            options.forEach((option) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option-item';
                optionElement.innerHTML = `
            <div class="option-content">
                <p><strong>Text:</strong> ${option.textview || 'N/A'}</p>
                <p><strong>Link:</strong> ${option.link || 'N/A'}</p>
                <p><strong>Image:</strong> ${option.imagelink || 'N/A'}</p>
            </div>
            <div class="option-actions">
                <button onclick="editOption('${option._id}', '${option.imagelink}', '${option.textview}', '${option.link}')" 
                        class="edit-button">Edit</button>
                <button onclick="deleteOption('${option._id}')" 
                        class="delete-button">Delete</button>
            </div>
        `;
                optionsList.appendChild(optionElement);
            });
        }

        function editOption(id, imagelink, textview, link) {
            document.getElementById('optionId').value = id;
            document.getElementById('imagelink').value = imagelink;
            document.getElementById('textview').value = textview;
            document.getElementById('link').value = link;
        }

        async function saveOptions() {
            const optionId = document.getElementById('optionId').value;


            if (!currentListName) {
                showPopup('Please select a list first');
                return;
            }

            const option = {
                imagelink: document.getElementById('imagelink').value,
                textview: document.getElementById('textview').value,
                link: document.getElementById('link').value
            };

            try {
                let response;
                if (optionId) {
                    // Update existing option

                    response = await fetch(`${BASE_URL}/api/list-options/${currentListName}/update-option/${optionId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(option)
                    });
                } else {
                    // Add new option
                    response = await fetch(`${BASE_URL}/api/list-options/${currentListName}/add-option`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(option)
                    });
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                    showPopup(" here is the response :::" + response.status)
                }

                const result = await response.json();
                console.log('Option saved:', result);
                //loadListOptions(); // Reload the options
                // document.getElementById('optionForm').reset();
                // document.getElementById('optionId').value = '';
                showPopup('Option saved successfully!');
            } catch (error) {
                console.error('Error saving option:', error);
                showPopup('Failed to save option. Please try again.');
            }
        }

        async function deleteOption(optionId) {
            if (!confirm('Are you sure you want to delete this option?')) return;

            try {
                const response = await fetch(`${BASE_URL}/api/list-options/${currentListName}/remove-option/${optionId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                loadListOptions(); // Reload the options
                showPopup('Option deleted successfully!');
            } catch (error) {
                console.error('Error deleting option:', error);
                showPopup('Failed to delete option. Please try again.');
            }
        }

        async function deleteList() {
            if (!confirm(`Are you sure you want to delete the entire list "${currentListName}"?`)) return;

            try {
                const response = await fetch(`${BASE_URL}/api/list-options/${currentListName}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                showPopup('List deleted successfully!');
                document.getElementById('listSelector').value = '';
                document.getElementById('optionsList').innerHTML = '';
                document.getElementById('deleteListButton').style.display = 'none';
                loadAvailableLists(); // Refresh the list of available lists
            } catch (error) {
                console.error('Error deleting list:', error);
                showPopup('Failed to delete list. Please try again.');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Event listener for list selector
            const listSelector = document.getElementById('listSelector');
            if (listSelector) {
                listSelector.addEventListener('change', loadListOptions);
            }

            // Event listener for option form
            // const optionForm = document.getElementById('optionForm');
            // if (optionForm) {
            //     optionForm.addEventListener('submit', async function (e) {
            //         e.preventDefault();
            //         await saveOptions(e);
            //     });
            // }

            // Initial load of available lists
            loadAvailableLists();
        });

        // Make sure these event listeners are set up
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('deleteListButton').addEventListener('click', deleteList);

            document.getElementById('categoryForm').addEventListener('submit', saveCategory);

            document.querySelector('button[onclick="openTab(event, \'CategoryManagement\')"]').addEventListener('click', loadCategories);


        });


        async function deleteOption(optionId) {
            const listName = document.getElementById('listSelector').value;
            if (!confirm('Are you sure you want to delete this option?')) return;

            try {
                const response = await fetch(`${BASE_URL}/api/list-options/${listName}/remove-option/${optionId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                loadListOptions(); // Reload the options
                showPopup('Option deleted successfully!');
            } catch (error) {
                console.error('Error deleting option:', error);
                showPopup('Failed to delete option. Please try again.');
            }
        }

        // Add this to your existing DOMContentLoaded event listener
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('optionForm').addEventListener('submit', saveOptions());
        });



        async function loadImages() {
            const imageGrid = document.getElementById('imageGrid');
            const images = await fetchImagesFromS3();

            imageGrid.innerHTML = ''; // Clear existing images

            images.forEach(imageUrl => {
                const imageItem = document.createElement('div');
                imageItem.className = 'imageItem';

                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = 'AWS S3 Image';

                const urlText = document.createElement('p');
                urlText.className = 'imageUrl';
                urlText.textContent = imageUrl;
                urlText.title = 'Click to copy URL';
                urlText.style.cursor = 'pointer';

                urlText.onclick = function () {
                    navigator.clipboard.writeText(imageUrl).then(() => {
                        // Temporarily change the text to indicate it was copied
                        const originalText = urlText.textContent;
                        urlText.textContent = 'Copied!';
                        setTimeout(() => {
                            urlText.textContent = originalText;
                        }, 1500);
                    }, (err) => {
                        console.error('Could not copy text: ', err);
                    });
                };

                imageItem.appendChild(img);
                imageItem.appendChild(urlText);
                imageGrid.appendChild(imageItem);
            });
        }

        async function uploadImage() {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file to upload');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('uploadedFileName', file);

                const uploadResponse = await fetch('/imageUpload', {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error(`Upload failed: ${uploadResponse.status} ${uploadResponse.statusText}`);
                }

                const result = await uploadResponse.json();

                // Display the uploaded image URL
                const uploadedImageUrl = document.getElementById('uploadedImageUrl');
                uploadedImageUrl.textContent = `Uploaded Image URL: ${result.response_data.Location}`;

                // Add copy functionality for the newly uploaded image URL
                const copyButton = document.createElement('button');
                copyButton.textContent = 'Copy URL';
                copyButton.onclick = function () {
                    navigator.clipboard.writeText(result.response_data.Location).then(() => {
                        const originalText = copyButton.textContent;
                        copyButton.textContent = 'Copied!';
                        setTimeout(() => {
                            copyButton.textContent = originalText;
                        }, 1500);
                    }, (err) => {
                        console.error('Could not copy text: ', err);
                    });
                };
                uploadedImageUrl.appendChild(copyButton);

                // Reload the image grid
                await loadImages();
            } catch (error) {
                console.error('Error uploading image:', error);
                alert(`Failed to upload image: ${error.message}`);
            }
        }


        // AWS S3 Image Gallery functions
        async function fetchImagesFromS3() {
            try {
                const response = await fetch('/api/list-images');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching images:', error);
                alert('Failed to fetch images. Please try again.');
                return [];
            }
        }

        async function loadImages() {
            const imageGrid = document.getElementById('imageGrid');
            const images = await fetchImagesFromS3();

            imageGrid.innerHTML = ''; // Clear existing images

            images.forEach(imageUrl => {
                const imageItem = document.createElement('div');
                imageItem.className = 'imageItem';

                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = 'AWS S3 Image';

                const urlText = document.createElement('p');
                urlText.className = 'imageUrl';
                urlText.textContent = imageUrl;

                const copyButton = document.createElement('button');
                copyButton.textContent = 'Copy URL';
                copyButton.onclick = function () {
                    navigator.clipboard.writeText(imageUrl).then(() => {
                        // Temporarily change the button text to indicate it was copied
                        const originalText = copyButton.textContent;
                        copyButton.textContent = 'Copied!';
                        setTimeout(() => {
                            copyButton.textContent = originalText;
                        }, 1500);
                    }, (err) => {
                        console.error('Could not copy text: ', err);
                    });
                };


                imageItem.appendChild(img);
                imageItem.appendChild(urlText);
                imageItem.appendChild(copyButton);
                imageGrid.appendChild(imageItem);
            });
        }

        async function uploadImage() {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file to upload');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('uploadedFileName', file);

                const uploadResponse = await fetch('/imageUpload', {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error(`Upload failed: ${uploadResponse.status} ${uploadResponse.statusText}`);
                }

                const result = await uploadResponse.json();

                // Display the uploaded image URL
                const uploadedImageUrl = document.getElementById('uploadedImageUrl');
                uploadedImageUrl.textContent = `Uploaded Image URL: ${result.response_data.Location}`;

                // Reload the image grid

                // Add copy functionality for the newly uploaded image URL
                const copyButton = document.createElement('button');
                copyButton.textContent = 'Copy URL';
                copyButton.onclick = function () {
                    navigator.clipboard.writeText(result.response_data.Location).then(() => {
                        const originalText = copyButton.textContent;
                        copyButton.textContent = 'Copied!';
                        setTimeout(() => {
                            copyButton.textContent = originalText;
                        }, 1500);
                    }, (err) => {
                        console.error('Could not copy text: ', err);
                    });
                };
                uploadedImageUrl.appendChild(copyButton);

                await loadImages();
            } catch (error) {
                console.error('Error uploading image:', error);
                alert(`Failed to upload image: ${error.message}`);
            }
        }


        try {
            console.log('Script started');

            document.addEventListener('DOMContentLoaded', function () {
                console.log('DOM fully loaded and parsed');



                async function fetchImagesFromS3() {
                    try {
                        const response = await fetch('/api/list-images');
                        if (!response.ok) {
                            throw new Error('Failed to fetch images');
                        }
                        return await response.json();
                    } catch (error) {
                        console.error('Error fetching images:', error);
                        showPopup('Failed to fetch images. Please try again.');
                        return [];
                    }
                }

                async function handleFetchImages(fetchButton, previewContainer) {
                    fetchButton.disabled = true;
                    fetchButton.textContent = 'Fetching...';

                    try {
                        const imageUrls = await fetchImagesFromS3();
                        previewContainer.innerHTML = '';

                        imageUrls.forEach((url, index) => {
                            const img = document.createElement('img');
                            img.src = url;
                            img.alt = `Image ${index + 1}`;
                            img.style.width = '100px';
                            img.style.height = '100px';
                            img.style.objectFit = 'cover';
                            img.style.margin = '5px';
                            img.style.cursor = 'pointer';
                            img.onclick = () => selectImage(url, previewContainer.id);
                            previewContainer.appendChild(img);
                        });

                        previewContainer.style.display = 'flex';
                        previewContainer.style.flexWrap = 'wrap';
                    } catch (error) {
                        console.error('Error handling image fetch:', error);
                        showPopup('Failed to handle image fetch. Please try again.');
                    } finally {
                        fetchButton.disabled = false;
                        fetchButton.textContent = 'Fetch Existing Images';
                    }
                }

                function selectImage(url, containerId) {
                    const section = containerId.replace('PreviewContainer', '');
                    const previewImg = document.getElementById(`${section}Preview`);
                    const hiddenInput = document.getElementById(`${section}Hidden`);
                    const urlDisplay = document.getElementById(`${section}Url`);

                    previewImg.src = url;
                    previewImg.style.display = 'block';
                    hiddenInput.value = url;
                    if (urlDisplay) {
                        urlDisplay.textContent = url;
                        urlDisplay.style.display = 'block';
                    }

                    showPopup('Image selected successfully!');
                }

                async function handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay) {
                    console.log('handleImageUpload called');
                    const file = fileInput.files[0];
                    if (file) {
                        console.log('File selected:', file.name);
                        uploadButton.textContent = 'Uploading...';
                        uploadButton.disabled = true;

                        try {
                            const formData = new FormData();
                            formData.append('file', file);

                            const response = await fetch('/api/upload', {
                                method: 'POST',
                                body: formData
                            });

                            if (!response.ok) {
                                throw new Error('Upload failed');
                            }

                            const data = await response.json();
                            const fileUrl = data.url;

                            console.log('File uploaded successfully:', fileUrl);
                            previewImg.src = fileUrl;
                            previewImg.style.display = 'block';
                            hiddenInput.value = fileUrl;
                            if (urlDisplay) {
                                urlDisplay.textContent = fileUrl;
                                urlDisplay.style.display = 'block';
                            }
                            uploadButton.textContent = 'Upload Complete';
                            showPopup('File uploaded successfully!');
                        } catch (error) {
                            console.error('Upload error:', error);
                            uploadButton.textContent = 'Upload Failed';
                            showPopup('File upload failed. Please try again.');
                        } finally {
                            uploadButton.disabled = false;
                        }
                    } else {
                        console.log('No file selected');
                        showPopup('Please select a file to upload.');
                    }
                }

                ['AppLogo', 'AppCompany', 'AppContact'].forEach(section => {
                    const uploadButton = document.getElementById(`upload${section}`);
                    const fetchButton = document.getElementById(`fetchImages${section}`);
                    const fileInput = document.getElementById(section.toLowerCase());
                    const previewImg = document.getElementById(`${section.toLowerCase()}Preview`);
                    const hiddenInput = document.getElementById(`${section.toLowerCase()}Hidden`);
                    const urlDisplay = document.getElementById(`${section.toLowerCase()}Url`);
                    const previewContainer = document.getElementById(`${section.toLowerCase()}PreviewContainer`);

                    if (uploadButton && fileInput && previewImg && hiddenInput && fetchButton && previewContainer) {
                        console.log(`Setting up event listeners for ${section}`);
                        uploadButton.addEventListener('click', () => {
                            fileInput.click();
                        });
                        fileInput.addEventListener('change', () => {
                            console.log(`${section} file selected`);
                            handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay);
                        });
                        fetchButton.addEventListener('click', () => {
                            console.log(`${section} fetch button clicked`);
                            handleFetchImages(fetchButton, previewContainer);
                        });
                    } else {
                        console.error(`Missing elements for ${section}`);
                    }
                });
            });

            console.log('Event listener added');
        } catch (error) {
            console.error('Error in script:', error);
        }


        document.getElementById('updateForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('Form submission started');




            const formData = new FormData(this);
            const jsonData = {
                header: {
                    startColor: formData.get('header.startColor') || "#ffffff",
                    endColor: formData.get('header.endColor') || "#ffffff"
                },
                button: {
                    startColor: formData.get('button.startColor') || "#ee0979",
                    endColor: formData.get('button.endColor') || "#ff6a00"
                },
                buttonBackground: {
                    startColor: formData.get('buttonBackground.startColor') || "#ee0979",
                    endColor: formData.get('buttonBackground.endColor') || "#ff6a00"
                },
                list_title_size: {
                    color: formData.get('list_title_size.color') || "#333333",
                    backgroundColor: formData.get('list_title_size.backgroundColor') || "#f2f2f2"
                },
                listbackground: {
                    backgroundColor: formData.get('listbackground.backgroundColor') || "#ededed"
                },
                search_filter: {
                    backgroundColor: formData.get('search_filter.backgroundColor') || "#000000"
                },
                list_price_size: parseInt(formData.get('list_price_size')) || 14,
                markerColor: formData.get('markerColor') || "#e1faeb",
                constantData: {
                    isPropertyUpload: formData.get('constantData.isPropertyUpload') === 'true',
                    homeUrls: formData.get('constantData.homeUrls') ? formData.get('constantData.homeUrls').split(',') : [],
                    isStrokeFilter: formData.get('constantData.isStrokeFilter') === 'true',
                    isMaterialElevation: formData.get('constantData.isMaterialElevation') === 'true',
                    headerHeight: parseInt(formData.get('constantData.headerHeight')) || 400,
                    appPackageName: formData.get('constantData.appPackageName') || "",
                    defaultLanguage: formData.get('constantData.defaultLanguage') || "",
                    currencyCode: formData.get('constantData.currencyCode') || "",
                    appName: formData.get('constantData.appName') || "",
                    appEmail: formData.get('constantData.appEmail') || "",
                    appLogo: formData.get('constantData.appLogo') || "",
                    appCompany: formData.get('constantData.appCompany') || "",
                    appWebsite: formData.get('constantData.appWebsite') || "",
                    appContact: formData.get('constantData.appContact') || "",
                    facebookLink: formData.get('constantData.facebookLink') || "",
                    twitterLink: formData.get('constantData.twitterLink') || "",
                    instagramLink: formData.get('constantData.instagramLink') || "",
                    youtubeLink: formData.get('constantData.youtubeLink') || "",
                    googlePlayLink: formData.get('constantData.googlePlayLink') || "",
                    appleStoreLink: formData.get('constantData.appleStoreLink') || "",
                    appVersion: formData.get('constantData.appVersion') || "",
                    appUpdateHideShow: formData.get('constantData.appUpdateHideShow') || "",
                    appUpdateVersionCode: parseInt(formData.get('constantData.appUpdateVersionCode')) || 0,
                    appUpdateDesc: formData.get('constantData.appUpdateDesc') || "",
                    appUpdateLink: formData.get('constantData.appUpdateLink') || "",
                    appUpdateCancelOption: formData.get('constantData.appUpdateCancelOption') || "",
                    priceColor: formData.get('constantData.priceColor') || "#000000",
                    callButtonColor: formData.get('constantData.callButtonColor') || "#e1faeb",
                    DetailPageButtonColor: {
                        startColor: formData.get('constantData.DetailPageButtonColor.startColor') || "#e1faeb",
                        endColor: formData.get('constantData.DetailPageButtonColor.endColor') || "#e1faeb"
                    },
                    isCallDirect: formData.get('constantData.isCallDirect') === 'true',
                    homePageLayoutOrder: formData.get('constantData.homePageLayoutOrder')
                        ? formData.get('constantData.homePageLayoutOrder').split(',').map(Number)
                        : [1, 3, 4, 5, 6],
                    shadowOnImage: formData.get('constantData.shadowOnImage') === 'true'
                },
                ads: getAdsData()
            };
            console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

            console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

            try {
                const response = await fetch('https://propertify.onrender.com/api/colors/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                console.log('Success:', data);
                showPopup('Form submitted successfully!');
            } catch (error) {
                console.error('Error:', error);
                showPopup(`An error occurred while submitting the form: ${error.message}`);
            }
        });

        function showPopup(message) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            popupMessage.textContent = message;
            popup.style.display = 'block';

            // Hide the popup after 3 seconds
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function getAdsData() {
            console.log('getAdsData function called');
            const ads = [];
            const adItems = document.querySelectorAll('.ad-item');
            console.log('Number of ad items found:', adItems.length);

            adItems.forEach((item, index) => {
                console.log(`Processing ad item ${index + 1}`);
                const nameInput = item.querySelector(`input[name="ads[${index}].name"]`);
                const headerInput = item.querySelector(`input[name="ads[${index}].header"]`);
                const pageLinkInput = item.querySelector(`input[name="ads[${index}].pagelink"]`);
                const imageLinksInput = item.querySelector(`input[name="ads[${index}].imagelinks"]`);
                const contactInput = item.querySelector(`input[name="ads[${index}].contact"]`);
                const typeSelect = item.querySelector(`select[name="ads[${index}].type"]`);

                console.log('Input values:', {
                    name: nameInput ? nameInput.value : 'not found',
                    header: headerInput ? headerInput.value : 'not found',
                    pagelink: pageLinkInput ? pageLinkInput.value : 'not found',
                    imagelinks: imageLinksInput ? imageLinksInput.value : 'not found',
                    contact: contactInput ? contactInput.value : 'not found',
                    type: typeSelect ? typeSelect.value : 'not found'
                });

                const ad = {
                    name: nameInput ? nameInput.value.trim() : "",
                    header: headerInput ? headerInput.value.trim() : "",
                    pagelink: pageLinkInput ? pageLinkInput.value.trim() : "",
                    imagelinks: imageLinksInput ? imageLinksInput.value.split(',').map(link => link.trim()) : [],
                    contact: contactInput ? contactInput.value.split(',').map(contact => contact.trim()) : [],
                    type: {
                        type: typeSelect ? typeSelect.value : ""
                    }
                };

                if (ad.type.type === 'BANNER') {
                    ad.type.width = parseInt(item.querySelector(`input[name="ads[${index}].width"]`)?.value) || 0;
                    ad.type.height = parseInt(item.querySelector(`input[name="ads[${index}].height"]`)?.value) || 0;
                } else if (ad.type.type === 'POPUP') {
                    ad.type.delay = parseInt(item.querySelector(`input[name="ads[${index}].delay"]`)?.value) || 0;
                } else if (ad.type.type === 'INTERSTITIAL') {
                    ad.type.fullscreen = item.querySelector(`input[name="ads[${index}].fullscreen"]`)?.checked || false;
                }

                console.log('Processed ad object:', ad);

                // Only include the ad if it has any non-empty fields
                if (ad.name || ad.header || ad.pagelink || ad.imagelinks.length > 0 || ad.contact.length > 0) {
                    ads.push(ad);
                }
            });

            console.log('Final ads array:', ads);
            return ads;
        }

        function showAdTypeFields(selectElement) {
            const adItem = selectElement.closest('.ad-item');
            const bannerFields = adItem.querySelector('.banner-fields');
            const popupFields = adItem.querySelector('.popup-fields');
            const interstitialFields = adItem.querySelector('.interstitial-fields');

            bannerFields.style.display = 'none';
            popupFields.style.display = 'none';
            interstitialFields.style.display = 'none';

            switch (selectElement.value) {
                case 'BANNER':
                    bannerFields.style.display = 'block';
                    break;
                case 'POPUP':
                    popupFields.style.display = 'block';
                    break;
                case 'INTERSTITIAL':
                    interstitialFields.style.display = 'block';
                    break;
            }
        }



        document.addEventListener('DOMContentLoaded', function () {
            const addAdButton = document.getElementById('addAdButton');
            const adsContainer = document.getElementById('adsContainer');
            let adCount = 1;

            addAdButton.addEventListener('click', function () {
                adCount++;
                const newAdHtml = `
            <div class="ad-item">
                <h3>Ad ${adCount}</h3>
                <label for="ad${adCount}Name">Name:</label>
                <input type="text" id="ad${adCount}Name" name="ads[${adCount - 1}].name" value="">

                <label for="ad${adCount}Header">Header:</label>
                <input type="text" id="ad${adCount}Header" name="ads[${adCount - 1}].header" value="">

                <label for="ad${adCount}PageLink">Page Link:</label>
                <input type="url" id="ad${adCount}PageLink" name="ads[${adCount - 1}].pagelink" value="">

                <label for="ad${adCount}ImageLinks">Image Links (comma-separated):</label>
                <input type="text" id="ad${adCount}ImageLinks" name="ads[${adCount - 1}].imagelinks" value="">

                <label for="ad${adCount}Contact">Contact Info (comma-separated):</label>
                <input type="text" id="ad${adCount}Contact" name="ads[${adCount - 1}].contact" value="">

                <label for="ad${adCount}Type">Type:</label>
                <select id="ad${adCount}Type" name="ads[${adCount - 1}].type" onchange="showAdTypeFields(this)">
                    <option value="BANNER">Banner</option>
                    <option value="POPUP">Popup</option>
                    <option value="INTERSTITIAL">Interstitial</option>
                </select>

                <div class="banner-fields" style="display: none;">
                    <label for="ad${adCount}Width">Width:</label>
                    <input type="number" id="ad${adCount}Width" name="ads[${adCount - 1}].width" value="">
                    <label for="ad${adCount}Height">Height:</label>
                    <input type="number" id="ad${adCount}Height" name="ads[${adCount - 1}].height" value="">
                </div>

                <div class="popup-fields" style="display: none;">
                    <label for="ad${adCount}Delay">Delay (ms):</label>
                    <input type="number" id="ad${adCount}Delay" name="ads[${adCount - 1}].delay" value="">
                </div>

                <div class="interstitial-fields" style="display: none;">
                    <label for="ad${adCount}Fullscreen">Fullscreen:</label>
                    <input type="checkbox" id="ad${adCount}Fullscreen" name="ads[${adCount - 1}].fullscreen">
                </div>
            </div>
        `;
                adsContainer.insertAdjacentHTML('beforeend', newAdHtml);
            });
        });



        /////////////

        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM fully loaded and parsed=========>>>');
            async function fetchImagesFromS3() {
                try {
                    const response = await fetch('/api/list-images');
                    if (!response.ok) {
                        throw new Error('Failed to fetch images');
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Error fetching images:', error);
                    showPopup('Failed to fetch images. Please try again.');
                    return [];
                }
            }

            async function handleFetchImages(fetchButton, previewContainer) {
                fetchButton.disabled = true;
                fetchButton.textContent = 'Fetching...';

                try {
                    const imageUrls = await fetchImagesFromS3();
                    previewContainer.innerHTML = '';

                    imageUrls.forEach((url, index) => {
                        const img = document.createElement('img');
                        img.src = url;
                        img.alt = `Image ${index + 1}`;
                        img.style.width = '100px';
                        img.style.height = '100px';
                        img.style.objectFit = 'cover';
                        img.style.margin = '5px';
                        img.style.cursor = 'pointer';
                        img.onclick = () => selectImage(url, previewContainer.id);
                        previewContainer.appendChild(img);
                    });

                    previewContainer.style.display = 'flex';
                    previewContainer.style.flexWrap = 'wrap';
                } catch (error) {
                    console.error('Error handling image fetch:', error);
                    showPopup('Failed to handle image fetch. Please try again.');
                } finally {
                    fetchButton.disabled = false;
                    fetchButton.textContent = 'Fetch Existing Images';
                }
            }

            function selectImage(url, containerId) {
                const section = containerId.replace('PreviewContainer', '');
                const previewImg = document.getElementById(`${section}Preview`);
                const hiddenInput = document.getElementById(`${section}Hidden`);
                const urlDisplay = document.getElementById(`${section}Url`);

                previewImg.src = url;
                previewImg.style.display = 'block';
                hiddenInput.value = url;
                if (urlDisplay) {
                    urlDisplay.textContent = url;
                    urlDisplay.style.display = 'block';
                }

                showPopup('Image selected successfully!');
            }

            async function handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay) {
                console.log('handleImageUpload called');
                const file = fileInput.files[0];
                if (file) {
                    console.log('File selected:', file.name);
                    uploadButton.textContent = 'Uploading...';
                    uploadButton.disabled = true;

                    try {
                        const formData = new FormData();
                        formData.append('file', file);

                        const response = await fetch('/api/upload', {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            throw new Error('Upload failed');
                        }

                        const data = await response.json();
                        const fileUrl = data.url;

                        console.log('File uploaded successfully:', fileUrl);
                        previewImg.src = fileUrl;
                        previewImg.style.display = 'block';
                        hiddenInput.value = fileUrl;
                        if (urlDisplay) {
                            urlDisplay.textContent = fileUrl;
                            urlDisplay.style.display = 'block';
                        }
                        uploadButton.textContent = 'Upload Complete';
                        showPopup('File uploaded successfully!');
                    } catch (error) {
                        console.error('Upload error:', error);
                        uploadButton.textContent = 'Upload Failed';
                        showPopup('File upload failed. Please try again.');
                    } finally {
                        uploadButton.disabled = false;
                    }
                } else {
                    console.log('No file selected');
                    showPopup('Please select a file to upload.');
                }
            }

            async function uploadToS3(file) {
                console.log('Uploading to S3:', file.name);
                const response = await fetch(`/api/get-upload-url?fileName=${file.name}&fileType=${file.type}`);
                const { signedRequest, url } = await response.json();

                await fetch(signedRequest, {
                    method: 'PUT',
                    body: file,
                    headers: { 'Content-Type': file.type }
                });

                return url;
            }

            function showPopup(message) {
                console.log('Showing popup:', message);
                const popup = document.getElementById('popup');
                const popupMessage = document.getElementById('popup-message');
                popupMessage.textContent = message;
                popup.style.display = 'block';

                setTimeout(() => {
                    popup.style.display = 'none';
                }, 3000);
            }

            ['AppLogo', 'AppCompany', 'AppContact'].forEach(section => {
                const uploadButton = document.getElementById(`upload${section}`);
                const fetchButton = document.getElementById(`fetchImages${section}`);
                const fileInput = document.getElementById(section.toLowerCase());
                const previewImg = document.getElementById(`${section.toLowerCase()}Preview`);
                const hiddenInput = document.getElementById(`${section.toLowerCase()}Hidden`);
                const urlDisplay = document.getElementById(`${section.toLowerCase()}Url`);
                const previewContainer = document.getElementById(`${section.toLowerCase()}PreviewContainer`);

                if (uploadButton && fileInput && previewImg && hiddenInput && fetchButton && previewContainer) {
                    console.log(`Setting up event listeners for ${section}`);
                    uploadButton.addEventListener('click', () => {
                        fileInput.click(); // Trigger file input when upload button is clicked
                    });
                    fileInput.addEventListener('change', () => {
                        console.log(`${section} file selected`);
                        handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay);
                    });
                    fetchButton.addEventListener('click', () => {
                        console.log(`${section} fetch button clicked`);
                        handleFetchImages(fetchButton, previewContainer);
                    });
                } else {
                    console.error(`Missing elements for ${section}`);
                }
            });
        });

        console.log('Event listener added');

        document.getElementById('updateForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('Form submission started');

            try {
                const formData = new FormData(this);
                const jsonData = {
                    header: {
                        startColor: formData.get('header.startColor') || "#ffffff",
                        endColor: formData.get('header.endColor') || "#ffffff"
                    },
                    button: {
                        startColor: formData.get('button.startColor') || "#ee0979",
                        endColor: formData.get('button.endColor') || "#ff6a00"
                    },
                    buttonBackground: {
                        startColor: formData.get('buttonBackground.startColor') || "#ee0979",
                        endColor: formData.get('buttonBackground.endColor') || "#ff6a00"
                    },
                    list_title_size: {
                        color: formData.get('list_title_size.color') || "#333333",
                        backgroundColor: formData.get('list_title_size.backgroundColor') || "#f2f2f2"
                    },
                    listbackground: {
                        backgroundColor: formData.get('listbackground.backgroundColor') || "#ededed"
                    },
                    search_filter: {
                        backgroundColor: formData.get('search_filter.backgroundColor') || "#000000"
                    },
                    list_price_size: parseInt(formData.get('list_price_size')) || 14,
                    markerColor: formData.get('markerColor') || "#e1faeb",
                    constantData: {
                        // ... (keep all the constantData fields as they were)
                    }
                };

                // Check if ads data is not empty
                const adsData = getAdsData();
                if (adsData.length > 0 && adsData.some(ad => Object.values(ad).some(value => value !== ''))) {
                    jsonData.ads = adsData;
                }

                console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

                const response = await fetch('https://propertify.onrender.com/api/colors/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                console.log('Success:', data);
                showPopup('Form submitted successfully!');
            } catch (error) {
                console.error('Error:', error);
                showPopup(`An error occurred while submitting the form: ${error.message}`);
            }
        });



        function showPopup(message) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            popupMessage.textContent = message;
            popup.style.display = 'block';

            // Hide the popup after 3 seconds
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function showSeparateAdTypeFields() {
            const adType = document.getElementById('adType').value;
            document.getElementById('separateBannerFields').style.display = adType === 'BANNER' ? 'block' : 'none';
            document.getElementById('separatePopupFields').style.display = adType === 'POPUP' ? 'block' : 'none';
            document.getElementById('separateInterstitialFields').style.display = adType === 'INTERSTITIAL' ? 'block' : 'none';
        }

        // Function to open ad form popup
        function openSeparateAdForm(ad = null) {
            const form = document.getElementById('separateAdForm');
            form.reset();
            if (ad) {
                // Populate form for editing
                Object.keys(ad).forEach(key => {
                    const input = form.elements[key];
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = ad[key];
                        } else if (key === 'type') {
                            input.value = ad[key].type;
                        } else {
                            input.value = Array.isArray(ad[key]) ? ad[key].join(', ') : ad[key];
                        }
                    }
                });
                document.getElementById('adId').value = ad._id;
            } else {
                document.getElementById('adId').value = '';
            }
            showSeparateAdTypeFields();
            document.getElementById('adFormPopup').style.display = 'block';
        }

        // Function to close ad form popup
        function closeSeparateAdForm() {
            document.getElementById('adFormPopup').style.display = 'none';
        }

        // Function to add or update an ad
        function openSeparateAdForm(ad = null) {
            const form = document.getElementById('separateAdForm');
            form.reset();
            if (ad) {
                // Populate form for editing
                Object.keys(ad).forEach(key => {
                    const input = form.elements[key];
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = ad[key];
                        } else if (key === 'type') {
                            input.value = ad[key].type;
                        } else if (key === 'imagelinks' || key === 'contact') {
                            input.value = ad[key].join(', ');
                        } else {
                            input.value = ad[key];
                        }
                    }
                });
                document.getElementById('adId').value = ad._id;
            } else {
                document.getElementById('adId').value = '';
            }
            showSeparateAdTypeFields();
            document.getElementById('adFormPopup').style.display = 'block';
        }

        // Function to add or update an ad
        async function saveSeparateAd(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const adData = Object.fromEntries(formData.entries());

            adData.type = { type: adData.type };

            // Add type-specific fields
            if (adData.type.type === 'BANNER') {
                adData.type.width = parseInt(adData.width) || 0;
                adData.type.height = parseInt(adData.height) || 0;
            } else if (adData.type.type === 'POPUP') {
                adData.type.delay = parseInt(adData.delay) || 0;
            } else if (adData.type.type === 'INTERSTITIAL') {
                adData.type.fullscreen = adData.fullscreen === 'on';
            }

            // Convert imagelinks and contact to arrays
            adData.imagelinks = adData.imagelinks.split(',').map(link => link.trim());
            adData.contact = adData.contact.split(',').map(contact => contact.trim());

            try {
                // Fetch existing ads
                const response = await fetch('https://propertify.onrender.com/api/colors/ads');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                let ads = await response.json();

                if (adData.adId) {
                    // Edit existing ad
                    const index = ads.findIndex(ad => ad._id === adData.adId);
                    if (index !== -1) {
                        ads[index] = { ...ads[index], ...adData };
                    }
                } else {
                    // Add new ad
                    ads.push(adData);
                }

                // Update all ads
                const updateResponse = await fetch('https://propertify.onrender.com/api/colors/update-ads', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ads: ads })
                });

                if (!updateResponse.ok) {
                    throw new Error(`HTTP error! status: ${updateResponse.status}`);
                }

                console.log('Ad saved successfully');
                closeSeparateAdForm();
                listSeparateAds(); // Refresh the ads list
            } catch (error) {
                console.error('Error saving ad:', error);
                alert('Failed to save ad. Please try again.');
            }
        }

        // Function to list all ads
        async function listSeparateAds() {
            try {
                const response = await fetch('https://propertify.onrender.com/api/colors/ads');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const ads = await response.json();
                const adsList = document.getElementById('adsList');
                adsList.innerHTML = '';
                ads.forEach(ad => {
                    const adElement = document.createElement('div');
                    adElement.innerHTML = `
                <h4>${ad.name}</h4>
                <p>Type: ${ad.type.type}</p>
                <button onclick='openSeparateAdForm(${JSON.stringify(ad)})'>Edit</button>
                <button onclick="deleteSeparateAd('${ad._id}')">Delete</button>
            `;
                    adsList.appendChild(adElement);
                });
            } catch (error) {
                console.error('Error listing ads:', error);
                alert('Failed to list ads. Please try again.');
            }
        }

        // Function to delete an ad
        async function deleteSeparateAd(adId) {
            if (confirm('Are you sure you want to delete this ad?')) {
                try {
                    // Fetch existing ads
                    const response = await fetch('https://propertify.onrender.com/api/colors/ads');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    let ads = await response.json();

                    // Remove the ad with the given adId
                    ads = ads.filter(ad => ad._id !== adId);

                    // Update ads
                    const updateResponse = await fetch('https://propertify.onrender.com/api/colors/update-ads', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ads: ads })
                    });

                    if (!updateResponse.ok) {
                        throw new Error(`HTTP error! status: ${updateResponse.status}`);
                    }

                    console.log('Ad deleted successfully');
                    listSeparateAds(); // Refresh the ads list
                } catch (error) {
                    console.error('Error deleting ad:', error);
                    alert('Failed to delete ad. Please try again.');
                }
            }
            if (confirm('Are you sure you want to delete this ad?')) {
                try {
                    const response = await fetch(`https://propertify.onrender.com/api/colors/ads/${adId}`, {
                        method: 'DELETE'
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    console.log('Ad deleted successfully');
                    listSeparateAds(); // Refresh the ads list
                } catch (error) {
                    console.error('Error deleting ad:', error);
                    alert('Failed to delete ad. Please try again.');
                }
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('addNewAdButton').addEventListener('click', () => openSeparateAdForm());
            document.getElementById('listAdsButton').addEventListener('click', listSeparateAds);
            document.getElementById('separateAdForm').addEventListener('submit', saveSeparateAd);
        });

    </script>
</body>

</html>