<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS S3 Image Gallery and Update Colors API Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .imageUrl {
            background-color: #f0f0f0;
            padding: 5px;
            border-radius: 3px;
            font-size: 0.8em;
            word-break: break-all;
            transition: background-color 0.3s ease;
        }

        .imageUrl:hover {
            background-color: #e0e0e0;
        }

        .tab {
            overflow: hidden;
            border: 1px solid #d3fb3e;
            background-color: #000000;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }

        h1,
        h2 {
            text-align: center;
        }

        #imageGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .imageItem {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .imageItem img {
            max-width: 100%;
            height: auto;
        }



        #uploadSection {
            margin-bottom: 30px;
            text-align: center;
        }

        #uploadedImageUrl {
            margin-top: 10px;
            font-weight: bold;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
            box-sizing: border-box;
        }

        button {
            margin-top: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .color-input {
            display: flex;
            align-items: center;
        }

        .color-input input[type="color"] {
            width: 50px;
            margin-right: 10px;
            padding: 0;
            height: 30px;
        }

        .color-input input[type="text"] {
            flex-grow: 1;
        }

        .ad-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            background-color: #f9f9f9;
        }

        .image-upload {
            margin-top: 10px;
        }

        .image-upload input[type="file"] {
            display: inline-block;
            width: auto;
        }

        .image-upload button {
            display: inline-block;
            margin-left: 10px;
        }

        .image-preview {
            max-width: 200px;
            margin-top: 10px;
            display: none;
        }

        .popup {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .popup-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .uploaded-url {
            word-break: break-all;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .image-selection {
            margin-top: 10px;
        }

        .image-selection select {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
        }

        .delete-button {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            margin-top: 10px;
        }

        .delete-button:hover {
            background-color: #cc0000;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            padding: 15px;
        }

        .grid-item {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 0.9em;
            background-color: #f9f9f9;
        }

        .grid-item.building {
            background-color: #e6f3ff;
        }

        .grid-item.property {
            background-color: #fff0e6;
        }

        .grid-item img {
            max-width: 100%;
            height: 120px;
            object-fit: cover;
            margin-bottom: 10px;
        }

        .building-properties {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 5px;
            background-color: #ffffff;
            border: 1px solid #ddd;
        }

        .property-item {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        #searchInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
        }

        .connect-property {
            margin-top: 10px;
        }

        .connect-property select {
            width: 70%;
            padding: 5px;
        }

        .connect-property button {
            width: 28%;
            padding: 5px;
            margin-left: 2%;
        }

        .property-upload-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .property-upload-form label {
            display: block;
            margin-bottom: 5px;
        }

        .property-upload-form input,
        .property-upload-form select,
        .property-upload-form textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        .property-upload-form .full-width {
            grid-column: 1 / -1;
        }

        .image-upload-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
        }

        .property-upload-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .property-upload-form .full-width {
            grid-column: 1 / -1;
        }

        .map-container {
            height: 400px;
            margin-bottom: 15px;
        }

        .chip-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }

        .chip {
            background-color: #e0e0e0;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
        }

        .chip button {
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 5px;
        }
    </style>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCAxLPWJ3If855zICuSdKNWCYrSDhPauVM&libraries=places"></script>

</head>

<body>

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'ImageGallery')" id="defaultOpen">AWS S3 Image Gallery</button>
        <button class="tablinks" onclick="openTab(event, 'UpdateColors')">Update Colors API Form</button>
        <button class="tablinks" onclick="openTab(event, 'ListOptions')">List Options</button>
        <button class="tablinks" onclick="openTab(event, 'NewListOption')">New List Option</button>
        <button class="tablinks" onclick="openTab(event, 'BuildingsProperties')">Buildings & Properties</button>
        <button class="tablinks" onclick="openTab(event, 'PropertyUpload')">Upload Property</button>


    </div>


    <div id="PropertyUpload" class="tabcontent">
        <h1>Upload Property</h1>
        <form id="propertyUploadForm" class="property-upload-form">
            <div>
                <label for="post_title">Property Title:</label>
                <input type="text" id="post_title" name="post_title" required>
            </div>
            <div>
                <label for="type_name">Property Type:</label>
                <select id="type_name" name="type_name" required>
                    <option value="">Select Type</option>
                    <option value="Apartment">Apartment</option>
                    <option value="House">House</option>
                    <option value="Villa">Villa</option>
                    <option value="Office">Office</option>
                    <option value="Shop">Shop</option>
                    <option value="Warehouse">Warehouse</option>
                    <option value="Land">Land</option>
                </select>
            </div>
            <div>
                <label for="purpose">Purpose:</label>
                <select id="purpose" name="purpose" required>
                    <option value="">Select Purpose</option>
                    <option value="Rent">Rent</option>
                    <option value="Sale">Sale</option>
                </select>
            </div>
            <div>
                <label for="building_id">Building ID:</label>
                <input type="text" id="building_id" name="building_id">
            </div>
            <div>
                <label for="price">Price:</label>
                <input type="number" id="price" name="price" required>
            </div>
            <div>
                <label for="priceUnit">Price Unit:</label>
                <input type="text" id="priceUnit" name="priceUnit" required>
            </div>
            <div>
                <label for="area">Area:</label>
                <input type="text" id="area" name="area" required>
            </div>
            <div>
                <label for="areaUnit">Area Unit:</label>
                <input type="text" id="areaUnit" name="areaUnit" required>
            </div>
            <div>
                <label for="bedrooms">Bedrooms:</label>
                <input type="number" id="bedrooms" name="bedrooms" required>
            </div>
            <div>
                <label for="bathrooms">Bathrooms:</label>
                <input type="number" id="bathrooms" name="bathrooms" required>
            </div>
            <div>
                <label for="floor">Floor:</label>
                <input type="text" id="floor" name="floor">
            </div>
            <div>
                <label for="furnishing">Furnishing:</label>
                <select id="furnishing" name="furnishing" required>
                    <option value="">Select Furnishing</option>
                    <option value="Furnished">Furnished</option>
                    <option value="Semi-Furnished">Semi-Furnished</option>
                    <option value="Unfurnished">Unfurnished</option>
                </select>
            </div>
            <div>
                <label for="furnishStatus">Furnish Status:</label>
                <input type="text" id="furnishStatus" name="furnishStatus">
            </div>
            <div>
                <label for="carpetArea">Carpet Area:</label>
                <input type="number" id="carpetArea" name="carpetArea">
            </div>
            <div>
                <label for="superBuiltupArea">Super Built-up Area:</label>
                <input type="number" id="superBuiltupArea" name="superBuiltupArea">
            </div>
            <div>
                <label for="available">Available:</label>
                <input type="checkbox" id="available" name="available">
            </div>
            <div>
                <label for="category">Category:</label>
                <input type="number" id="category" name="category">
            </div>
            <div>
                <label for="region">Region:</label>
                <input type="text" id="region" name="region">
            </div>
            <div>
                <label for="construction_status">Construction Status:</label>
                <input type="text" id="construction_status" name="construction_status">
            </div>
            <div>
                <label for="possession">Possession:</label>
                <input type="text" id="possession" name="possession">
            </div>
            <div>
                <label for="broker_status">Broker Status:</label>
                <input type="text" id="broker_status" name="broker_status">
            </div>
            <div>
                <label for="agreement">Agreement:</label>
                <input type="text" id="agreement" name="agreement">
            </div>
            <div class="full-width">
                <label for="address">Address:</label>
                <textarea id="address" name="address" required></textarea>
            </div>
            <div class="full-width">
                <label>Location:</label>
                <button type="button" id="getCurrentLocation">Get Current Location</button>
                <div id="map" class="map-container"></div>
                <input type="hidden" id="latitude" name="latitude" required>
                <input type="hidden" id="longitude" name="longitude" required>
                <p id="locationDisplay"></p>
            </div>
            <div class="full-width">
                <label for="post_description">Description:</label>
                <textarea id="post_description" name="post_description" required></textarea>
            </div>
            <div class="full-width">
                <label for="amenities">Amenities:</label>
                <input type="text" id="amenitiesInput" placeholder="Type and press Enter to add">
                <div id="amenitiesChips" class="chip-container"></div>
                <input type="hidden" id="amenities" name="amenities">
            </div>
            <div class="full-width">
                <label for="usp">USP (Unique Selling Points):</label>
                <input type="text" id="uspInput" placeholder="Type and press Enter to add">
                <div id="uspChips" class="chip-container"></div>
                <input type="hidden" id="usp" name="usp">
            </div>
            <div class="full-width">
                <label for="location_advantage">Location Advantages:</label>
                <input type="text" id="locationAdvantageInput" placeholder="Type and press Enter to add">
                <div id="locationAdvantageChips" class="chip-container"></div>
                <input type="hidden" id="location_advantage" name="location_advantage">
            </div>
            <div class="full-width">
                <label for="facilities">Facilities:</label>
                <input type="text" id="facilitiesInput" placeholder="Type and press Enter to add">
                <div id="facilitiesChips" class="chip-container"></div>
                <input type="hidden" id="facilities" name="facilities">
            </div>
            <div class="full-width">
                <label for="tags">Tags:</label>
                <input type="text" id="tagsInput" placeholder="Type and press Enter to add">
                <div id="tagsChips" class="chip-container"></div>
                <input type="hidden" id="tags" name="tags">
            </div>
            <div class="full-width">
                <label for="contactList">Contact Numbers:</label>
                <input type="text" id="contactListInput" placeholder="Type and press Enter to add">
                <div id="contactListChips" class="chip-container"></div>
                <input type="hidden" id="contactList" name="contactList">
            </div>
            <div>
                <label for="post_image">Main Image:</label>
                <input type="file" id="post_image" name="post_image" accept="image/*" required>
                <img id="post_image_preview" class="image-upload-preview" src="#" alt="Main Image Preview"
                    style="display:none;">
            </div>
            <div>
                <label for="floor_plan_image">Floor Plan Image:</label>
                <input type="file" id="floor_plan_image" name="floor_plan_image" accept="image/*">
                <img id="floor_plan_image_preview" class="image-upload-preview" src="#" alt="Floor Plan Preview"
                    style="display:none;">
            </div>
            <div class="full-width">
                <label for="gallery_images">Gallery Images:</label>
                <input type="file" id="gallery_images" name="gallery_images" accept="image/*" multiple>
                <div id="gallery_images_preview"></div>
            </div>
            <div class="full-width">
                <button type="submit">Upload Property</button>
            </div>
        </form>
    </div>




    <div id="BuildingsProperties" class="tabcontent">
        <h1>Buildings and Properties</h1>
        <input type="text" id="searchInput" placeholder="Search buildings or properties...">
        <div class="grid-container" id="buildingsPropertiesGrid">
            <!-- Buildings and properties will be dynamically added here -->
        </div>
    </div>

    <div id="ListOptions" class="tabcontent">
        <h1>List Options Management</h1>
        <div>
            <h2>Available Lists</h2>
            <select id="listSelector">
                <option value="">Select a list</option>
                <option value="MainMenu">Main Menu</option>
                <option value="Categories">Categories</option>
                <option value="QuickLinks">Quick Links</option>
            </select>
            <button onclick="loadListOptions()">Load Options</button>
        </div>
        <div id="optionsList"></div>
        <div>
            <h2>Add/Edit Option</h2>
            <form id="optionForm">
                <input type="hidden" id="optionId">
                <label for="imagelink">Image Link:</label>
                <input type="text" id="imagelink" required>
                <label for="textview">Text View:</label>
                <input type="text" id="textview" required>
                <label for="link">Link:</label>
                <input type="text" id="link" required>
                <button type="submit">Save Option</button>
            </form>
        </div>
    </div>


    <div id="ImageGallery" class="tabcontent">
        <h1>AWS S3 Image Gallery</h1>

        <div id="uploadSection">
            <h2>Upload New Image</h2>
            <input type="file" id="imageUpload" accept="image/*">
            <button onclick="uploadImage()">Upload</button>
            <div id="uploadedImageUrl"></div>
        </div>

        <h2>Existing Images</h2>
        <div id="imageGrid"></div>
    </div>

    <div id="UpdateColors" class="tabcontent">
        <h1>Update Colors API Form</h1>
        <form id="updateForm">
            <h2>Header</h2>
            <div class="color-input">
                <input type="color" id="headerStartColor" value="#ffffff">
                <input type="text" name="header.startColor" value="#ffffff">
            </div>
            <div class="color-input">
                <input type="color" id="headerEndColor" value="#ffffff">
                <input type="text" name="header.endColor" value="#ffffff">
            </div>

            <h2>Button</h2>
            <div class="color-input">
                <input type="color" id="buttonStartColor" value="#ee0979">
                <input type="text" name="button.startColor" value="#ee0979">
            </div>
            <div class="color-input">
                <input type="color" id="buttonEndColor" value="#ff6a00">
                <input type="text" name="button.endColor" value="#ff6a00">
            </div>

            <h2>Button Background</h2>
            <div class="color-input">
                <input type="color" id="buttonBgStartColor" value="#ee0979">
                <input type="text" name="buttonBackground.startColor" value="#ee0979">
            </div>
            <div class="color-input">
                <input type="color" id="buttonBgEndColor" value="#ff6a00">
                <input type="text" name="buttonBackground.endColor" value="#ff6a00">
            </div>

            <h2>List Title Size</h2>
            <div class="color-input">
                <input type="color" id="listTitleColor" value="#333333">
                <input type="text" name="list_title_size.color" value="#333333">
            </div>
            <div class="color-input">
                <input type="color" id="listTitleBgColor" value="#f2f2f2">
                <input type="text" name="list_title_size.backgroundColor" value="#f2f2f2">
            </div>

            <h2>List Background</h2>
            <div class="color-input">
                <input type="color" id="listBgColor" value="#ededed">
                <input type="text" name="listbackground.backgroundColor" value="#ededed">
            </div>

            <h2>Search Filter</h2>
            <div class="color-input">
                <input type="color" id="searchFilterBgColor" value="#000000">
                <input type="text" name="search_filter.backgroundColor" value="#000000">
            </div>

            <h2>Other Settings</h2>
            <label for="listPriceSize">List Price Size:</label>
            <input type="number" id="listPriceSize" name="list_price_size" value="14">

            <div class="color-input">
                <input type="color" id="markerColor" value="#e1faeb">
                <input type="text" name="markerColor" value="#e1faeb">
            </div>

            <h2>Constant Data</h2>
            <label for="isPropertyUpload">Is Property Upload:</label>
            <select id="isPropertyUpload" name="constantData.isPropertyUpload">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="homeUrls">Home URLs:</label>
            <textarea id="homeUrls" name="constantData.homeUrls" rows="3"></textarea>

            <label for="isStrokeFilter">Is Stroke Filter:</label>
            <select id="isStrokeFilter" name="constantData.isStrokeFilter">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="isMaterialElevation">Is Material Elevation:</label>
            <select id="isMaterialElevation" name="constantData.isMaterialElevation">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="headerHeight">Header Height:</label>
            <input type="number" id="headerHeight" name="constantData.headerHeight" value="400">

            <label for="appPackageName">App Package Name:</label>
            <input type="text" id="appPackageName" name="constantData.appPackageName" value="">

            <label for="defaultLanguage">Default Language:</label>
            <input type="text" id="defaultLanguage" name="constantData.defaultLanguage" value="">

            <label for="currencyCode">Currency Code:</label>
            <input type="text" id="currencyCode" name="constantData.currencyCode" value="">

            <label for="appName">App Name:</label>
            <input type="text" id="appName" name="constantData.appName" value="">

            <label for="appEmail">App Email:</label>
            <input type="email" id="appEmail" name="constantData.appEmail" value="">

            <label for="appWebsite">App Website:</label>
            <input type="url" id="appWebsite" name="constantData.appWebsite" value="">

            <label for="facebookLink">Facebook Link:</label>
            <input type="url" id="facebookLink" name="constantData.facebookLink"
                value="https://www.geetikabuilders.in/gk/index.html">

            <label for="twitterLink">Twitter Link:</label>
            <input type="url" id="twitterLink" name="constantData.twitterLink" value="">

            <label for="instagramLink">Instagram Link:</label>
            <input type="url" id="instagramLink" name="constantData.instagramLink" value="">

            <label for="youtubeLink">YouTube Link:</label>
            <input type="url" id="youtubeLink" name="constantData.youtubeLink" value="">

            <label for="googlePlayLink">Google Play Link:</label>
            <input type="url" id="googlePlayLink" name="constantData.googlePlayLink" value="">

            <label for="appleStoreLink">Apple Store Link:</label>
            <input type="url" id="appleStoreLink" name="constantData.appleStoreLink" value="">

            <label for="appVersion">App Version:</label>
            <input type="text" id="appVersion" name="constantData.appVersion" value="">

            <label for="appUpdateHideShow">App Update Hide/Show:</label>
            <input type="text" id="appUpdateHideShow" name="constantData.appUpdateHideShow" value="">

            <label for="appUpdateVersionCode">App Update Version Code:</label>
            <input type="number" id="appUpdateVersionCode" name="constantData.appUpdateVersionCode" value="0">

            <label for="appUpdateDesc">App Update Description:</label>
            <textarea id="appUpdateDesc" name="constantData.appUpdateDesc" rows="3"></textarea>

            <label for="appUpdateLink">App Update Link:</label>
            <input type="url" id="appUpdateLink" name="constantData.appUpdateLink" value="">

            <label for="appUpdateCancelOption">App Update Cancel Option:</label>
            <input type="text" id="appUpdateCancelOption" name="constantData.appUpdateCancelOption" value="">

            <div class="color-input">
                <input type="color" id="priceColor" value="#000000">
                <input type="text" name="constantData.priceColor" value="#000000">
            </div>

            <div class="color-input">
                <input type="color" id="callButtonColor" value="#e1faeb">
                <input type="text" name="constantData.callButtonColor" value="#e1faeb">
            </div>

            <h3>Detail Page Button Color</h3>
            <div class="color-input">
                <input type="color" id="detailPageButtonStartColor" value="#e1faeb">
                <input type="text" name="constantData.DetailPageButtonColor.startColor" value="#e1faeb">
            </div>
            <div class="color-input">
                <input type="color" id="detailPageButtonEndColor" value="#e1faeb">
                <input type="text" name="constantData.DetailPageButtonColor.endColor" value="#e1faeb">
            </div>

            <label for="homePageLayoutOrder">Home Page Layout Order:</label>
            <input type="text" id="homePageLayoutOrder" name="constantData.homePageLayoutOrder" value="1,3,4,5,6">

            <label for="isCallDirect">Is Call Direct:</label>
            <select id="isCallDirect" name="constantData.isCallDirect">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>

            <label for="shadowOnImage">Shadow On Image:</label>
            <select id="shadowOnImage" name="constantData.shadowOnImage">
                <option value="true">Yes</option>
                <option value="false" selected>No</option>
            </select>


            <h2>Ads</h2>
            <div id="adsContainer">
                <div class="ad-item">
                    <h3>Ad 1</h3>
                    <label for="ad1Name">Name:</label>
                    <input type="text" id="ad1Name" name="ads[0].name" value="">

                    <label for="ad1Header">Header:</label>
                    <input type="text" id="ad1Header" name="ads[0].header" value="">

                    <label for="ad1PageLink">Page Link:</label>
                    <input type="url" id="ad1PageLink" name="ads[0].pagelink" value="">

                    <label for="ad1ImageLinks">Image Links (comma-separated):</label>
                    <input type="text" id="ad1ImageLinks" name="ads[0].imagelinks" value="">

                    <label for="ad1Contact">Contact Info (comma-separated):</label>
                    <input type="text" id="ad1Contact" name="ads[0].contact" value="">

                    <label for="ad1Type">Type:</label>
                    <select id="ad1Type" name="ads[0].type" onchange="showAdTypeFields(this)">
                        <option value="BANNER">Banner</option>
                        <option value="POPUP">Popup</option>
                        <option value="INTERSTITIAL">Interstitial</option>
                    </select>

                    <div class="banner-fields" style="display: none;">
                        <label for="ad1Width">Width:</label>
                        <input type="number" id="ad1Width" name="ads[0].width" value="">
                        <label for="ad1Height">Height:</label>
                        <input type="number" id="ad1Height" name="ads[0].height" value="">
                    </div>

                    <div class="popup-fields" style="display: none;">
                        <label for="ad1Delay">Delay (ms):</label>
                        <input type="number" id="ad1Delay" name="ads[0].delay" value="">
                    </div>

                    <div class="interstitial-fields" style="display: none;">
                        <label for="ad1Fullscreen">Fullscreen:</label>
                        <input type="checkbox" id="ad1Fullscreen" name="ads[0].fullscreen">
                    </div>
                </div>
            </div>

            <button type="button" id="addAdButton">Add Another Ad</button>

            <button type="submit">Submit</button>
        </form>
    </div>

    <div id="NewListOption" class="tabcontent">
        <h1>Create New List Option</h1>
        <form id="newListOptionForm">
            <label for="newListName">List Name:</label>
            <input type="text" id="newListName" required>

            <div id="newOptionsContainer">
                <div class="option-item">
                    <label for="newImageLink0">Image Link:</label>
                    <input type="text" id="newImageLink0" required>
                    <label for="newTextView0">Text View:</label>
                    <input type="text" id="newTextView0" required>
                    <label for="newLink0">Link:</label>
                    <input type="text" id="newLink0" required>
                </div>
            </div>

            <button type="button" id="addNewOptionButton">Add Another Option</button>
            <button type="submit">Create New List Option</button>
        </form>
    </div>

    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">&times;</span>
            <p id="popup-message"></p>
        </div>
    </div>

    <div id="separateAdsManagement">
        <h2>Separate Ads Management</h2>
        <button type="button" id="addNewAdButton">Add New Ad</button>
        <button type="button" id="listAdsButton">List All Ads</button>
        <div id="adsList"></div>
    </div>

    <div id="adFormPopup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closeAdForm()">&times;</span>
            <h3>Ad Form</h3>
            <form id="separateAdForm">
                <input type="hidden" id="adId" name="adId">
                <label for="adName">Name:</label>
                <input type="text" id="adName" name="name" required>
                <label for="adHeader">Header:</label>
                <input type="text" id="adHeader" name="header">
                <label for="adPageLink">Page Link:</label>
                <input type="url" id="adPageLink" name="pagelink">
                <label for="adImageLinks">Image Links (comma-separated):</label>
                <input type="text" id="adImageLinks" name="imagelinks">
                <label for="adContact">Contact Info (comma-separated):</label>
                <input type="text" id="adContact" name="contact">
                <label for="adType">Type:</label>
                <select id="adType" name="type" onchange="showSeparateAdTypeFields()">
                    <option value="BANNER">Banner</option>
                    <option value="POPUP">Popup</option>
                    <option value="INTERSTITIAL">Interstitial</option>
                </select>
                <div id="separateBannerFields" style="display: none;">
                    <label for="adWidth">Width:</label>
                    <input type="number" id="adWidth" name="width">
                    <label for="adHeight">Height:</label>
                    <input type="number" id="adHeight" name="height">
                </div>
                <div id="separatePopupFields" style="display: none;">
                    <label for="adDelay">Delay (ms):</label>
                    <input type="number" id="adDelay" name="delay">
                </div>
                <div id="separateInterstitialFields" style="display: none;">
                    <label for="adFullscreen">Fullscreen:</label>
                    <input type="checkbox" id="adFullscreen" name="fullscreen">
                </div>
                <button type="submit">Save Ad</button>
            </form>
        </div>
    </div>
    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">&times;</span>
            <div id="popup-message"></div>
        </div>
    </div>

<div id="BuildingUpload" class="tabcontent">
    <h1>Upload Building Details</h1>
    <form id="buildingUploadForm">
      <div>
        <label for="buildingId">Building ID:</label>
        <input type="text" id="buildingId" name="buildingId" required>
      </div>
      <div>
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
      </div>
      <div>
        <label for="frontRoad">Front Road:</label>
        <input type="text" id="frontRoad" name="frontRoad">
      </div>
      <div>
        <label for="parkingArea">Parking Area:</label>
        <input type="text" id="parkingArea" name="parkingArea">
      </div>
      <div>
        <label for="description">Description:</label>
        <textarea id="description" name="description"></textarea>
      </div>
      <div>
        <label for="areaUSP">Area USP:</label>
        <input type="text" id="areaUSP" name="areaUSP">
      </div>
      <div>
        <label for="ownerName">Owner Name:</label>
        <input type="text" id="ownerName" name="ownerName">
      </div>
      <div>
        <label for="ownerId">Owner ID:</label>
        <input type="text" id="ownerId" name="ownerId">
      </div>
      <div>
        <label for="storey">Storey:</label>
        <input type="text" id="storey" name="storey">
      </div>
      <div>
        <label for="age">Age:</label>
        <input type="text" id="age" name="age">
      </div>
      <div>
        <label for="type">Type:</label>
        <input type="text" id="type" name="type">
      </div>
      <div>
        <label for="luda">LUDA:</label>
        <input type="text" id="luda" name="luda">
      </div>
      <div>
        <label for="totalProperties">Total Properties:</label>
        <input type="text" id="totalProperties" name="totalProperties">
      </div>
      <div>
        <label for="developmentStatus">Development Status:</label>
        <input type="text" id="developmentStatus" name="developmentStatus">
      </div>
      <div>
        <label for="allowPreBooking">Allow Pre-Booking:</label>
        <input type="checkbox" id="allowPreBooking" name="allowPreBooking">
      </div>
      <div>
        <label for="allocatedProperties">Allocated Properties:</label>
        <input type="text" id="allocatedProperties" name="allocatedProperties">
      </div>
      <div>
        <label for="freeProperties">Free Properties:</label>
        <input type="text" id="freeProperties" name="freeProperties">
      </div>
      <div>
        <label for="contactNumber">Contact Number:</label>
        <input type="tel" id="contactNumber" name="contactNumber">
      </div>
      <div>
        <label for="latitude">Latitude:</label>
        <input type="number" id="latitude" name="latitude" step="any">
      </div>
      <div>
        <label for="longitude">Longitude:</label>
        <input type="number" id="longitude" name="longitude" step="any">
      </div>
      <div>
        <label for="galleryList">Gallery Images:</label>
        <input type="file" id="galleryList" name="galleryList" multiple accept="image/*">
      </div>
      <button type="submit">Upload Building</button>
    </form>
  </div>
  

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1035.0.min.js"></script>
    <script>

        function showPropertyPopup(formData) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');

            let message = '<h3>Property Details:</h3><ul>';
            for (let [key, value] of formData.entries()) {
                if (key !== 'post_image' && key !== 'floor_plan_image' && key !== 'gallery_images') {
                    message += `<li><strong>${key}:</strong> ${value}</li>`;
                } else {
                    message += `<li><strong>${key}:</strong> ${value.name}</li>`;
                }
            }
            message += '</ul><p>Do you want to upload this property?</p>';
            message += '<button onclick="confirmUpload()">Yes, Upload</button> ';
            message += '<button onclick="cancelUpload()">Cancel</button>';

            popupMessage.innerHTML = message;
            popup.style.display = 'block';
        }

        let propertyFormData;


        let map, marker;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 0, lng: 0 },
                zoom: 2
            });

            marker = new google.maps.Marker({
                map: map,
                draggable: true
            });

            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(event.latLng);
            });

            google.maps.event.addListener(marker, 'dragend', function (event) {
                updateLatLng(event.latLng);
            });

            document.getElementById('getCurrentLocation').addEventListener('click', getCurrentLocation);
        }

        function placeMarker(location) {
            marker.setPosition(location);
            map.setCenter(location);
            updateLatLng(location);
        }

        function updateLatLng(location) {
            document.getElementById('latitude').value = location.lat();
            document.getElementById('longitude').value = location.lng();
            updateLocationDisplay(location);
        }

        function updateLocationDisplay(location) {
            const locationDisplay = document.getElementById('locationDisplay');
            locationDisplay.textContent = `Latitude: ${location.lat().toFixed(6)}, Longitude: ${location.lng().toFixed(6)}`;
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        placeMarker(pos);
                        map.setZoom(15);
                    },
                    () => {
                        handleLocationError(true, map.getCenter());
                    }
                );
            } else {
                handleLocationError(false, map.getCenter());
            }
        }
        function handleLocationError(browserHasGeolocation, pos) {
            alert(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
        }


        document.querySelector('button[onclick="openTab(event, \'PropertyUpload\')"]').addEventListener('click', function () {
            setTimeout(initMap, 0);
        });


        function setupChipInput(inputId, chipsId, hiddenInputId) {
            const input = document.getElementById(inputId);
            const chipsContainer = document.getElementById(chipsId);
            const hiddenInput = document.getElementById(hiddenInputId);
            const chips = new Set();

            input.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const value = this.value.trim();
                    if (value && !chips.has(value)) {
                        addChip(value);
                        this.value = '';
                    }
                }
            });
        }

        function addChip(value) {
            chips.add(value);
            const chip = document.createElement('div');
            chip.className = 'chip';
            chip.innerHTML = `
                    ${value}
                    <button type="button" onclick="removeChip(this, '${value}', '${chipsId}', '${hiddenInputId}')">Ã—</button>
                `;
            chipsContainer.appendChild(chip);
            updateHiddenInput();
        }

        function updateHiddenInput() {
            hiddenInput.value = Array.from(chips).join(',');
        }


        function removeChip(button, value, chipsId, hiddenInputId) {
            const chipsContainer = document.getElementById(chipsId);
            const hiddenInput = document.getElementById(hiddenInputId);
            const chips = new Set(hiddenInput.value.split(','));

            chips.delete(value);
            button.parentElement.remove();
            hiddenInput.value = Array.from(chips).join(',');
        }

        // Set up chip inputs for various fields
        setupChipInput('amenitiesInput', 'amenitiesChips', 'amenities');
        setupChipInput('uspInput', 'uspChips', 'usp');
        setupChipInput('locationAdvantageInput', 'locationAdvantageChips', 'location_advantage');
        setupChipInput('facilitiesInput', 'facilitiesChips', 'facilities');
        setupChipInput('tagsInput', 'tagsChips', 'tags');
        setupChipInput('contactListInput', 'contactListChips', 'contactList');

        document.getElementById('propertyUploadForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData();




            // Text inputs
            formData.append('post_title', document.getElementById('post_title').value);
            formData.append('type_name', document.getElementById('type_name').value);
            formData.append('purpose', document.getElementById('purpose').value);
            formData.append('building_id', document.getElementById('building_id').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('priceUnit', document.getElementById('priceUnit').value);
            formData.append('area', document.getElementById('area').value);
            formData.append('areaUnit', document.getElementById('areaUnit').value);
            formData.append('bedrooms', document.getElementById('bedrooms').value);
            formData.append('bathrooms', document.getElementById('bathrooms').value);
            formData.append('floor', document.getElementById('floor').value);
            formData.append('furnishing', document.getElementById('furnishing').value);
            formData.append('furnishStatus', document.getElementById('furnishStatus').value);
            formData.append('carpetArea', document.getElementById('carpetArea').value);
            formData.append('superBuiltupArea', document.getElementById('superBuiltupArea').value);
            formData.append('available', document.getElementById('available').checked);
            formData.append('category', document.getElementById('category').value);
            formData.append('region', document.getElementById('region').value);
            formData.append('construction_status', document.getElementById('construction_status').value);
            formData.append('possession', document.getElementById('possession').value);
            formData.append('broker_status', document.getElementById('broker_status').value);
            formData.append('agreement', document.getElementById('agreement').value);
            formData.append('address', document.getElementById('address').value);
            formData.append('post_description', document.getElementById('post_description').value);

            // Hidden fields (location data)
            formData.append('latitude', document.getElementById('latitude').value);
            formData.append('longitude', document.getElementById('longitude').value);

            // Chip inputs
            formData.append('amenities', document.getElementById('amenities').value);
            formData.append('usp', document.getElementById('usp').value);
            formData.append('location_advantage', document.getElementById('location_advantage').value);
            formData.append('facilities', document.getElementById('facilities').value);
            formData.append('tags', document.getElementById('tags').value);
            formData.append('contactList', document.getElementById('contactList').value);





            const propertyData = {
                post_title: formData.get('post_title'),
                type_name: formData.get('type_name'),
                purpose: formData.get('purpose'),
                building_id: formData.get('building_id'),
                price: parseFloat(formData.get('price')),
                priceUnit: formData.get('priceUnit'),
                area: parseFloat(formData.get('area')),
                areaUnit: formData.get('areaUnit'),
                bedrooms: parseInt(formData.get('bedrooms')),
                bathrooms: parseInt(formData.get('bathrooms')),
                floor: parseInt(formData.get('floor')),
                furnishing: formData.get('furnishing'),
                furnishStatus: formData.get('furnishStatus'),
                carpetArea: parseFloat(formData.get('carpetArea')),
                superBuiltupArea: parseFloat(formData.get('superBuiltupArea')),
                available: formData.get('available') === 'true',
                category: parseInt(formData.get('category')),
                region: formData.get('region'),
                construction_status: formData.get('construction_status'),
                possession: formData.get('possession'),
                broker_status: formData.get('broker_status'),
                agreement: formData.get('agreement'),
                address: formData.get('address'),
                post_description: formData.get('post_description'),
                latitude: parseFloat(formData.get('latitude')),
                longitude: parseFloat(formData.get('longitude')),
                amenities: formData.getAll('amenities').join(','),
                usp: formData.getAll('usp').join(','),
                location_advantage: formData.getAll('location_advantage').join(','),
                facilities: formData.getAll('facilities').join(','),
                tags: formData.getAll('tags').join(','),
                contactList: formData.getAll('contactList').join(',')
            };


            // Create a new FormData object for the API request
            const apiFormData = new FormData();

            // Add the propertyData as a JSON string
            apiFormData.append('data', JSON.stringify(propertyData));


            const postImage = document.getElementById('post_image').files[0];
            if (postImage) {
                apiFormData.set('post_image', postImage);  // Use set instead of append to avoid duplication
            }

            const floorPlanImage = document.getElementById('floor_plan_image').files[0];
            if (floorPlanImage) {
                apiFormData.set('floor_plan_image', floorPlanImage);
            }

            const galleryImages = document.getElementById('gallery_images').files;
            apiFormData.delete('galleryList');  // Remove any existing entries
            for (let i = 0; i < galleryImages.length; i++) {
                apiFormData.append('galleryList', galleryImages[i]);
            }




            // Print form data
            console.log('Form data to be sent:');
            for (let [key, value] of apiFormData.entries()) {
                if (value instanceof File) {
                    console.log(key, value.name);
                } else {
                    console.log(key, value);
                }
            }

            // Show form data in popup
            let formDataString = 'Form data to be sent:\n\n';
            for (let [key, value] of apiFormData.entries()) {
                if (value instanceof File) {
                    formDataString += `${key}: ${value.name}\n`;
                } else {
                    formDataString += `${key}: ${value}\n`;
                }
            }
            showPopup(formDataString, true);


            // Log all form data (for debugging)
            for (let [key, value] of apiFormData.entries()) {
                console.log(key, value);
            }

            try {
                const response = await fetch('https://propertify.onrender.com/api/upload/property', {
                    method: 'POST',
                    body: apiFormData
                });

                if (!response.ok) {
                    throw new Error('Failed to upload property');
                }

                const result = await response.json();
                showPopup('Property uploaded successfully!');
                // this.reset();
                // clearImagePreviews();
                // clearChips();
            } catch (error) {
                console.error('Error uploading property:', error);
                showPopup('Failed to upload property. Please try again. ' + error);
            }
        });

        function showPopup(message, isHTML = false) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            if (isHTML) {
                popupMessage.innerHTML = message;
            } else {
                popupMessage.textContent = message;
            }
            popup.style.display = 'block';
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function clearImagePreviews() {
            document.getElementById('post_image_preview').style.display = 'none';
            document.getElementById('floor_plan_image_preview').style.display = 'none';
            document.getElementById('gallery_images_preview').innerHTML = '';
        }

        function clearChips() {
            const chipContainers = document.querySelectorAll('.chip-container');
            chipContainers.forEach(container => container.innerHTML = '');
            const hiddenInputs = document.querySelectorAll('input[type="hidden"]');
            hiddenInputs.forEach(input => input.value = '');
        }

        // Image preview functionality
        document.getElementById('post_image').addEventListener('change', function (e) {
            previewImage(this, 'post_image_preview');
        });

        document.getElementById('floor_plan_image').addEventListener('change', function (e) {
            previewImage(this, 'floor_plan_image_preview');
        });

        document.getElementById('gallery_images').addEventListener('change', function (e) {
            const preview = document.getElementById('gallery_images').addEventListener('change', function (e) {
                const preview = document.getElementById('gallery_images_preview');
                preview.innerHTML = '';
                for (const file of this.files) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'image-upload-preview';
                    preview.appendChild(img);
                }
            });
        });

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }


        ///////////
        let newOptionCount = 1;


        document.getElementById('newListOptionForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const listName = document.getElementById('newListName').value;
            const options = [];

            for (let i = 0; i < newOptionCount; i++) {
                const imageLink = document.getElementById(`newImageLink${i}`)?.value;
                const textView = document.getElementById(`newTextView${i}`)?.value;
                const link = document.getElementById(`newLink${i}`)?.value;

                if (imageLink && textView && link) {
                    options.push({ imagelink: imageLink, textview: textView, link: link });
                }
            }

            try {
                const response = await fetch(`${BASE_URL}/api/list-options/add-complete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ listName, options })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('List option added/updated:', result);
                showPopup(result.message); // This will show "List updated successfully" or "List created successfully"

                // Reset the form
                this.reset();
                document.getElementById('newOptionsContainer').innerHTML = `
            <div class="option-item">
                <label for="newImageLink0">Image Link:</label>
                <input type="text" id="newImageLink0" required>
                <label for="newTextView0">Text View:</label>
                <input type="text" id="newTextView0" required>
                <label for="newLink0">Link:</label>
                <input type="text" id="newLink0" required>
            </div>
        `;
                newOptionCount = 1;

                // Refresh the list of available list options in the dropdown
                await loadAvailableLists();

            } catch (error) {
                console.error('Error adding/updating list option:', error);
                showPopup('Failed to add/update list option. Please try again.');
            }
        });

        // Function to load available lists
        async function loadAvailableLists() {
            try {
                const response = await fetch(`${BASE_URL}/api/list-options`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const lists = await response.json();

                const listSelector = document.getElementById('listSelector');
                listSelector.innerHTML = '<option value="">Select a list</option>';
                lists.forEach(list => {
                    const option = document.createElement('option');
                    option.value = list.listName;
                    option.textContent = list.listName;
                    listSelector.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading available lists:', error);
                showPopup('Failed to load available lists. Please try again.');
            }
        }

        // Call this function when the page loads
        document.addEventListener('DOMContentLoaded', loadAvailableLists);


        let allBuildings = [];
        let allProperties = [];

        async function loadBuildingsAndProperties() {
            try {
                const [buildingsResponse, propertiesResponse] = await Promise.all([
                    fetch('https://propertify.onrender.com/api/buildings'),
                    fetch('https://propertify.onrender.com/api/properties/all')
                ]);

                allBuildings = await buildingsResponse.json();
                allProperties = await propertiesResponse.json();

                displayBuildingsAndProperties();
                setupSearch();
            } catch (error) {
                console.error('Error loading buildings and properties:', error);
                showPopup('Failed to load buildings and properties. Please try again.');
            }
        }

        function displayBuildingsAndProperties() {
            const grid = document.getElementById('buildingsPropertiesGrid');
            grid.innerHTML = '';

            // Display buildings
            allBuildings.forEach(building => {
                const buildingElement = createBuildingElement(building);
                grid.appendChild(buildingElement);
            });

            // Display properties
            allProperties.forEach(property => {
                const propertyElement = createPropertyElement(property);
                grid.appendChild(propertyElement);
            });
        }

        function createBuildingElement(building) {
            const buildingElement = document.createElement('div');
            buildingElement.className = 'grid-item building';
            buildingElement.innerHTML = `
                <h3>Building: ${building.name}</h3>
                <img src="${building.galleryList[0] || 'placeholder-building-image.jpg'}" alt="${building.name}">
                <p><strong>ID:</strong> ${building.buildingId}</p>
                <p><strong>Address:</strong> ${building.address || 'N/A'}</p>
                <div class="building-properties">
                    <h4>Associated Properties:</h4>
                    ${getAssociatedProperties(building.buildingId)}
                </div>
            `;
            return buildingElement;
        }

        function createPropertyElement(property) {
            const propertyElement = document.createElement('div');
            propertyElement.className = 'grid-item property';
            propertyElement.innerHTML = `
        <h3>Property: ${property.post_title}</h3>
        <img src="${property.post_image || 'placeholder-property-image.jpg'}" alt="${property.post_title}">
        <p><strong>ID:</strong> ${property.post_id}</p>
        <p><strong>Type:</strong> ${property.type_name}</p>
        <p><strong>Building:</strong> ${getBuildingName(property.building_id) || 'Not assigned'}</p>
        <div class="connect-property">
            <select id="building-select-${property.post_id}">
                <option value="">Select a building</option>
                ${allBuildings.map(b => `<option value="${b.buildingId}">${b.name}</option>`).join('')}
            </select>
            <button onclick="connectPropertyToBuilding('${property.post_id}')">Connect</button>
        </div>
    `;
            return propertyElement;
        }

        function getAssociatedProperties(buildingId) {
            const associatedProperties = allProperties.filter(p => p.building_id === buildingId);
            if (associatedProperties.length === 0) {
                return '<p>No properties associated</p>';
            }
            return associatedProperties.map(p => `<div class="property-item">${p.post_title}</div>`).join('');
        }

        function getBuildingName(buildingId) {
            const building = allBuildings.find(b => b.buildingId === buildingId);
            return building ? building.name : null;
        }

        async function connectPropertyToBuilding(propertyId) {
            const selectElement = document.getElementById(`building-select-${propertyId}`);
            const buildingId = selectElement.value;

            if (!buildingId) {
                showPopup('Please select a building to connect.');
                return;
            }

            console.log('Connecting property:', propertyId, 'to building:', buildingId);

            try {
                const response = await fetch(`https://propertify.onrender.com/api/properties/${propertyId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ building_id: buildingId }),
                });

                const responseData = await response.json();

                if (!response.ok) {
                    throw new Error(`Failed to update property: ${response.status} ${response.statusText}. ${JSON.stringify(responseData)}`);
                }

                showPopup('Property connected to building successfully!');
                await loadBuildingsAndProperties();
            } catch (error) {
                console.error('Error connecting property to building:', error);
                showPopup(`Failed to connect property to building. Error: ${error.message}`);
            }
        }


        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const gridItems = document.querySelectorAll('.grid-item');

            searchInput.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                gridItems.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
        }

        function createBuildingElement(building) {
            const buildingElement = document.createElement('div');
            buildingElement.className = 'grid-item building';
            buildingElement.innerHTML = `
                <h3>Building: ${building.name}</h3>
                <img src="${building.galleryList[0] || 'placeholder-building-image.jpg'}" alt="${building.name}">
                <p><strong>ID:</strong> ${building.buildingId}</p>
                <p><strong>Address:</strong> ${building.address || 'N/A'}</p>
                <div class="building-properties">
                    <h4>Associated Properties:</h4>
                    ${getAssociatedProperties(building.buildingId)}
                </div>
                <button class="delete-button" onclick="deleteBuilding('${building.buildingId}')">Delete Building</button>
            `;
            return buildingElement;
        }

        function createPropertyElement(property) {
            const propertyElement = document.createElement('div');
            propertyElement.className = 'grid-item property';
            propertyElement.innerHTML = `
                <h3>Property: ${property.post_title}</h3>
                <img src="${property.post_image || 'placeholder-property-image.jpg'}" alt="${property.post_title}">
                <p><strong>ID:</strong> ${property.post_id}</p>
                <p><strong>Type:</strong> ${property.type_name}</p>
                <p><strong>Building:</strong> ${getBuildingName(property.building_id) || 'Not assigned'}</p>
                <div class="connect-property">
                    <select id="building-select-${property.post_id}">
                        <option value="">Select a building</option>
                        ${allBuildings.map(b => `<option value="${b.buildingId}">${b.name}</option>`).join('')}
                    </select>
                    <button onclick="connectPropertyToBuilding('${property.post_id}')">Connect</button>
                </div>
                <button class="delete-button" onclick="deleteProperty('${property.post_id}')">Delete Property</button>`;
            return propertyElement;
        }
        async function deleteProperty(propertyId) {
            if (!confirm('Are you sure you want to delete this property?')) {
                return;
            }

            try {
                const response = await fetch(`https://propertify.onrender.com/api/properties/${propertyId}`, {
                    method: 'DELETE'
                });

                const responseData = await response.json();

                if (!response.ok) {
                    throw new Error(responseData.message || 'Failed to delete property');
                }

                showPopup('Property deleted successfully!');
                await loadBuildingsAndProperties(); // Refresh the data
            } catch (error) {
                console.error('Error deleting property:', error);
                showPopup(`Failed to delete property: ${error.message}`);
            }
        }

        async function deleteBuilding(buildingId) {
            if (!confirm('Are you sure you want to delete this building? This will also remove the building association from all properties.')) {
                return;
            }

            try {
                // First, remove the building association from all properties
                const propertiesResponse = await fetch(`https://propertify.onrender.com/api/properties/building/${buildingId}`);
                const associatedProperties = await propertiesResponse.json();

                for (const property of associatedProperties) {
                    await fetch(`https://propertify.onrender.com/api/properties/${property.post_id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ building_id: null }),
                    });
                }

                // Then, delete the building
                const response = await fetch(`https://propertify.onrender.com/api/buildings/${buildingId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error('Failed to delete building');
                }

                showPopup('Building deleted successfully!');
                await loadBuildingsAndProperties(); // Refresh the data
            } catch (error) {
                console.error('Error deleting building:', error);
                showPopup('Failed to delete building. Please try again.');
            }
        }




        /////////////////////////////////


        document.getElementById('addNewOptionButton').addEventListener('click', function () {
            const container = document.getElementById('newOptionsContainer');
            const newOption = document.createElement('div');
            newOption.className = 'option-item';
            newOption.innerHTML = `
                <label for="newImageLink${newOptionCount}">Image Link:</label>
                <input type="text" id="newImageLink${newOptionCount}" required>
                <label for="newTextView${newOptionCount}">Text View:</label>
                    <input type="text" id="newTextView${newOptionCount}" required>
                    <label for="newLink${newOptionCount}">Link:</label>
                     <input type="text" id="newLink${newOptionCount}" required>
`;
            container.appendChild(newOption);
            newOptionCount++;
        });



        function openPropertyUpload() {
            window.location.href = '/property-upload';
        }

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }


            if (tabName === 'ListOptions') {
                loadListOptions();
            }

            if (tabName === 'BuildingsProperties') {
                loadBuildingsAndProperties();
            }

            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Set the default open tab
        document.getElementById("defaultOpen").click();

        document.addEventListener('DOMContentLoaded', function () {
            openTab("ImageGallery");

            console.log('Script started');

            function openTab(tabName) {
                console.log('Opening tab:', tabName);
                var tabcontent = document.getElementsByClassName("tabcontent");
                for (var i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].classList.remove("active");
                }
                var tablinks = document.getElementsByClassName("tablinks");
                for (var i = 0; i < tablinks.length; i++) {
                    tablinks[i].classList.remove("active");
                }
                document.getElementById(tabName).classList.add("active");
                document.querySelector(`[data-tab="${tabName}"]`).classList.add("active");
            }
            // Set the default open tab
            document.getElementById("defaultOpen").click();

            openTab("ImageGallery");
            console.log('Default tab opened');
        });
        document.addEventListener('DOMContentLoaded', loadImages);



        // Add click event listeners to tab buttons
        var tabButtons = document.getElementsByClassName("tablinks");
        for (var i = 0; i < tabButtons.length; i++) {
            tabButtons[i].addEventListener("click", function (event) {
                openTab(event, this.getAttribute("onclick").split("'")[1]);
            });
        }

        const BASE_URL = 'https://propertify.onrender.com';

        async function loadListOptions() {
            const listName = document.getElementById('listSelector').value;
            if (!listName) return;

            try {
                const response = await fetch(`${BASE_URL}/api/list-options/${listName}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                displayOptions(data.options);
            } catch (error) {
                console.error('Error loading options:', error);
                showPopup('Failed to load options. Please try again.');
            }
        }

        function displayOptions(options) {
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';
            options.forEach((option) => {
                const optionElement = document.createElement('div');
                optionElement.innerHTML = `
            <p>${option.textview}</p>
            <button onclick="editOption('${option._id}', '${option.imagelink}', '${option.textview}', '${option.link}')">Edit</button>
            <button onclick="deleteOption('${option._id}')">Delete</button>
        `;
                optionsList.appendChild(optionElement);
            });
        }

        function editOption(id, imagelink, textview, link) {
            document.getElementById('optionId').value = id;
            document.getElementById('imagelink').value = imagelink;
            document.getElementById('textview').value = textview;
            document.getElementById('link').value = link;
        }

        async function saveOption(event) {
            event.preventDefault();
            const listName = document.getElementById('listSelector').value;e
            const optionId = document.getElementById('optionId').value;
            const option = {
                imagelink: document.getElementById('imagelink').value,
                textview: document.getElementById('textview').value,
                link: document.getElementById('link').value
            };

            try {
                let response;
                if (optionId === '') {
                    // Add new option
                    response = await fetch(`${BASE_URL}/api/list-options/${listName}/add-option`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(option)
                    });
                } else {
                    // Fetch all existing options
                    const getAllResponse = await fetch(`${BASE_URL}/api/list-options/${listName}`);
                    if (!getAllResponse.ok) {
                        throw new Error(`HTTP error! status: ${getAllResponse.status}`);
                    }
                    const allOptions = await getAllResponse.json();

                    // Update the specific option
                    const updatedOptions = allOptions.options.map(opt =>
                        opt._id === optionId ? { ...opt, ...option } : opt
                    );

                    // Update existing option
                    response = await fetch(`${BASE_URL}/api/list-options/${listName}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            options: updatedOptions
                        })
                    });
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                loadListOptions(); // Reload the options
                document.getElementById('optionForm').reset();
                document.getElementById('optionId').value = '';
                showPopup('Option saved successfully!');
            } catch (error) {
                console.error('Error saving option:', error);
                showPopup('Failed to save option. Please try again.');
            }
        }
        async function deleteOption(optionId) {
            const listName = document.getElementById('listSelector').value;
            if (!confirm('Are you sure you want to delete this option?')) return;

            try {
                const response = await fetch(`${BASE_URL}/api/list-options/${listName}/remove-option/${optionId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                loadListOptions(); // Reload the options
                showPopup('Option deleted successfully!');
            } catch (error) {
                console.error('Error deleting option:', error);
                showPopup('Failed to delete option. Please try again.');
            }
        }

        // Add this to your existing DOMContentLoaded event listener
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('optionForm').addEventListener('submit', saveOption);
        });

        async function loadImages() {
            const imageGrid = document.getElementById('imageGrid');
            const images = await fetchImagesFromS3();

            imageGrid.innerHTML = ''; // Clear existing images

            images.forEach(imageUrl => {
                const imageItem = document.createElement('div');
                imageItem.className = 'imageItem';

                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = 'AWS S3 Image';

                const urlText = document.createElement('p');
                urlText.className = 'imageUrl';
                urlText.textContent = imageUrl;
                urlText.title = 'Click to copy URL';
                urlText.style.cursor = 'pointer';

                urlText.onclick = function () {
                    navigator.clipboard.writeText(imageUrl).then(() => {
                        // Temporarily change the text to indicate it was copied
                        const originalText = urlText.textContent;
                        urlText.textContent = 'Copied!';
                        setTimeout(() => {
                            urlText.textContent = originalText;
                        }, 1500);
                    }, (err) => {
                        console.error('Could not copy text: ', err);
                    });
                };

                imageItem.appendChild(img);
                imageItem.appendChild(urlText);
                imageGrid.appendChild(imageItem);
            });
        }

        async function uploadImage() {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file to upload');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('uploadedFileName', file);

                const uploadResponse = await fetch('/imageUpload', {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error(`Upload failed: ${uploadResponse.status} ${uploadResponse.statusText}`);
                }

                const result = await uploadResponse.json();

                // Display the uploaded image URL
                const uploadedImageUrl = document.getElementById('uploadedImageUrl');
                uploadedImageUrl.textContent = `Uploaded Image URL: ${result.response_data.Location}`;

                // Reload the image grid
                await loadImages();
            } catch (error) {
                console.error('Error uploading image:', error);
                alert(`Failed to upload image: ${error.message}`);
            }
        }


        // AWS S3 Image Gallery functions
        async function fetchImagesFromS3() {
            try {
                const response = await fetch('/api/list-images');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching images:', error);
                alert('Failed to fetch images. Please try again.');
                return [];
            }
        }

        async function loadImages() {
            const imageGrid = document.getElementById('imageGrid');
            const images = await fetchImagesFromS3();

            imageGrid.innerHTML = ''; // Clear existing images

            images.forEach(imageUrl => {
                const imageItem = document.createElement('div');
                imageItem.className = 'imageItem';

                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = 'AWS S3 Image';

                const urlText = document.createElement('p');
                urlText.className = 'imageUrl';
                urlText.textContent = imageUrl;

                imageItem.appendChild(img);
                imageItem.appendChild(urlText);
                imageGrid.appendChild(imageItem);
            });
        }

        async function uploadImage() {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file to upload');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('uploadedFileName', file);

                const uploadResponse = await fetch('/imageUpload', {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error(`Upload failed: ${uploadResponse.status} ${uploadResponse.statusText}`);
                }

                const result = await uploadResponse.json();

                // Display the uploaded image URL
                const uploadedImageUrl = document.getElementById('uploadedImageUrl');
                uploadedImageUrl.textContent = `Uploaded Image URL: ${result.response_data.Location}`;

                // Reload the image grid
                await loadImages();
            } catch (error) {
                console.error('Error uploading image:', error);
                alert(`Failed to upload image: ${error.message}`);
            }
        }


        try {
            console.log('Script started');

            document.addEventListener('DOMContentLoaded', function () {
                console.log('DOM fully loaded and parsed');

                async function fetchImagesFromS3() {
                    try {
                        const response = await fetch('/api/list-images');
                        if (!response.ok) {
                            throw new Error('Failed to fetch images');
                        }
                        return await response.json();
                    } catch (error) {
                        console.error('Error fetching images:', error);
                        showPopup('Failed to fetch images. Please try again.');
                        return [];
                    }
                }

                async function handleFetchImages(fetchButton, previewContainer) {
                    fetchButton.disabled = true;
                    fetchButton.textContent = 'Fetching...';

                    try {
                        const imageUrls = await fetchImagesFromS3();
                        previewContainer.innerHTML = '';

                        imageUrls.forEach((url, index) => {
                            const img = document.createElement('img');
                            img.src = url;
                            img.alt = `Image ${index + 1}`;
                            img.style.width = '100px';
                            img.style.height = '100px';
                            img.style.objectFit = 'cover';
                            img.style.margin = '5px';
                            img.style.cursor = 'pointer';
                            img.onclick = () => selectImage(url, previewContainer.id);
                            previewContainer.appendChild(img);
                        });

                        previewContainer.style.display = 'flex';
                        previewContainer.style.flexWrap = 'wrap';
                    } catch (error) {
                        console.error('Error handling image fetch:', error);
                        showPopup('Failed to handle image fetch. Please try again.');
                    } finally {
                        fetchButton.disabled = false;
                        fetchButton.textContent = 'Fetch Existing Images';
                    }
                }

                function selectImage(url, containerId) {
                    const section = containerId.replace('PreviewContainer', '');
                    const previewImg = document.getElementById(`${section}Preview`);
                    const hiddenInput = document.getElementById(`${section}Hidden`);
                    const urlDisplay = document.getElementById(`${section}Url`);

                    previewImg.src = url;
                    previewImg.style.display = 'block';
                    hiddenInput.value = url;
                    if (urlDisplay) {
                        urlDisplay.textContent = url;
                        urlDisplay.style.display = 'block';
                    }

                    showPopup('Image selected successfully!');
                }

                async function handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay) {
                    console.log('handleImageUpload called');
                    const file = fileInput.files[0];
                    if (file) {
                        console.log('File selected:', file.name);
                        uploadButton.textContent = 'Uploading...';
                        uploadButton.disabled = true;

                        try {
                            const formData = new FormData();
                            formData.append('file', file);

                            const response = await fetch('/api/upload', {
                                method: 'POST',
                                body: formData
                            });

                            if (!response.ok) {
                                throw new Error('Upload failed');
                            }

                            const data = await response.json();
                            const fileUrl = data.url;

                            console.log('File uploaded successfully:', fileUrl);
                            previewImg.src = fileUrl;
                            previewImg.style.display = 'block';
                            hiddenInput.value = fileUrl;
                            if (urlDisplay) {
                                urlDisplay.textContent = fileUrl;
                                urlDisplay.style.display = 'block';
                            }
                            uploadButton.textContent = 'Upload Complete';
                            showPopup('File uploaded successfully!');
                        } catch (error) {
                            console.error('Upload error:', error);
                            uploadButton.textContent = 'Upload Failed';
                            showPopup('File upload failed. Please try again.');
                        } finally {
                            uploadButton.disabled = false;
                        }
                    } else {
                        console.log('No file selected');
                        showPopup('Please select a file to upload.');
                    }
                }

                ['AppLogo', 'AppCompany', 'AppContact'].forEach(section => {
                    const uploadButton = document.getElementById(`upload${section}`);
                    const fetchButton = document.getElementById(`fetchImages${section}`);
                    const fileInput = document.getElementById(section.toLowerCase());
                    const previewImg = document.getElementById(`${section.toLowerCase()}Preview`);
                    const hiddenInput = document.getElementById(`${section.toLowerCase()}Hidden`);
                    const urlDisplay = document.getElementById(`${section.toLowerCase()}Url`);
                    const previewContainer = document.getElementById(`${section.toLowerCase()}PreviewContainer`);

                    if (uploadButton && fileInput && previewImg && hiddenInput && fetchButton && previewContainer) {
                        console.log(`Setting up event listeners for ${section}`);
                        uploadButton.addEventListener('click', () => {
                            fileInput.click();
                        });
                        fileInput.addEventListener('change', () => {
                            console.log(`${section} file selected`);
                            handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay);
                        });
                        fetchButton.addEventListener('click', () => {
                            console.log(`${section} fetch button clicked`);
                            handleFetchImages(fetchButton, previewContainer);
                        });
                    } else {
                        console.error(`Missing elements for ${section}`);
                    }
                });
            });

            console.log('Event listener added');
        } catch (error) {
            console.error('Error in script:', error);
        }


        document.getElementById('updateForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('Form submission started');




            const formData = new FormData(this);
            const jsonData = {
                header: {
                    startColor: formData.get('header.startColor') || "#ffffff",
                    endColor: formData.get('header.endColor') || "#ffffff"
                },
                button: {
                    startColor: formData.get('button.startColor') || "#ee0979",
                    endColor: formData.get('button.endColor') || "#ff6a00"
                },
                buttonBackground: {
                    startColor: formData.get('buttonBackground.startColor') || "#ee0979",
                    endColor: formData.get('buttonBackground.endColor') || "#ff6a00"
                },
                list_title_size: {
                    color: formData.get('list_title_size.color') || "#333333",
                    backgroundColor: formData.get('list_title_size.backgroundColor') || "#f2f2f2"
                },
                listbackground: {
                    backgroundColor: formData.get('listbackground.backgroundColor') || "#ededed"
                },
                search_filter: {
                    backgroundColor: formData.get('search_filter.backgroundColor') || "#000000"
                },
                list_price_size: parseInt(formData.get('list_price_size')) || 14,
                markerColor: formData.get('markerColor') || "#e1faeb",
                constantData: {
                    isPropertyUpload: formData.get('constantData.isPropertyUpload') === 'true',
                    homeUrls: formData.get('constantData.homeUrls') ? formData.get('constantData.homeUrls').split(',') : [],
                    isStrokeFilter: formData.get('constantData.isStrokeFilter') === 'true',
                    isMaterialElevation: formData.get('constantData.isMaterialElevation') === 'true',
                    headerHeight: parseInt(formData.get('constantData.headerHeight')) || 400,
                    appPackageName: formData.get('constantData.appPackageName') || "",
                    defaultLanguage: formData.get('constantData.defaultLanguage') || "",
                    currencyCode: formData.get('constantData.currencyCode') || "",
                    appName: formData.get('constantData.appName') || "",
                    appEmail: formData.get('constantData.appEmail') || "",
                    appLogo: formData.get('constantData.appLogo') || "",
                    appCompany: formData.get('constantData.appCompany') || "",
                    appWebsite: formData.get('constantData.appWebsite') || "",
                    appContact: formData.get('constantData.appContact') || "",
                    facebookLink: formData.get('constantData.facebookLink') || "",
                    twitterLink: formData.get('constantData.twitterLink') || "",
                    instagramLink: formData.get('constantData.instagramLink') || "",
                    youtubeLink: formData.get('constantData.youtubeLink') || "",
                    googlePlayLink: formData.get('constantData.googlePlayLink') || "",
                    appleStoreLink: formData.get('constantData.appleStoreLink') || "",
                    appVersion: formData.get('constantData.appVersion') || "",
                    appUpdateHideShow: formData.get('constantData.appUpdateHideShow') || "",
                    appUpdateVersionCode: parseInt(formData.get('constantData.appUpdateVersionCode')) || 0,
                    appUpdateDesc: formData.get('constantData.appUpdateDesc') || "",
                    appUpdateLink: formData.get('constantData.appUpdateLink') || "",
                    appUpdateCancelOption: formData.get('constantData.appUpdateCancelOption') || "",
                    priceColor: formData.get('constantData.priceColor') || "#000000",
                    callButtonColor: formData.get('constantData.callButtonColor') || "#e1faeb",
                    DetailPageButtonColor: {
                        startColor: formData.get('constantData.DetailPageButtonColor.startColor') || "#e1faeb",
                        endColor: formData.get('constantData.DetailPageButtonColor.endColor') || "#e1faeb"
                    },
                    isCallDirect: formData.get('constantData.isCallDirect') === 'true',
                    homePageLayoutOrder: formData.get('constantData.homePageLayoutOrder')
                        ? formData.get('constantData.homePageLayoutOrder').split(',').map(Number)
                        : [1, 3, 4, 5, 6],
                    shadowOnImage: formData.get('constantData.shadowOnImage') === 'true'
                },
                ads: getAdsData()
            };
            console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

            console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

            try {
                const response = await fetch('https://propertify.onrender.com/api/colors/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                console.log('Success:', data);
                showPopup('Form submitted successfully!');
            } catch (error) {
                console.error('Error:', error);
                showPopup(`An error occurred while submitting the form: ${error.message}`);
            }
        });

        function showPopup(message) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            popupMessage.textContent = message;
            popup.style.display = 'block';

            // Hide the popup after 3 seconds
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function getAdsData() {
            console.log('getAdsData function called');
            const ads = [];
            const adItems = document.querySelectorAll('.ad-item');
            console.log('Number of ad items found:', adItems.length);

            adItems.forEach((item, index) => {
                console.log(`Processing ad item ${index + 1}`);
                const nameInput = item.querySelector(`input[name="ads[${index}].name"]`);
                const headerInput = item.querySelector(`input[name="ads[${index}].header"]`);
                const pageLinkInput = item.querySelector(`input[name="ads[${index}].pagelink"]`);
                const imageLinksInput = item.querySelector(`input[name="ads[${index}].imagelinks"]`);
                const contactInput = item.querySelector(`input[name="ads[${index}].contact"]`);
                const typeSelect = item.querySelector(`select[name="ads[${index}].type"]`);

                console.log('Input values:', {
                    name: nameInput ? nameInput.value : 'not found',
                    header: headerInput ? headerInput.value : 'not found',
                    pagelink: pageLinkInput ? pageLinkInput.value : 'not found',
                    imagelinks: imageLinksInput ? imageLinksInput.value : 'not found',
                    contact: contactInput ? contactInput.value : 'not found',
                    type: typeSelect ? typeSelect.value : 'not found'
                });

                const ad = {
                    name: nameInput ? nameInput.value.trim() : "",
                    header: headerInput ? headerInput.value.trim() : "",
                    pagelink: pageLinkInput ? pageLinkInput.value.trim() : "",
                    imagelinks: imageLinksInput ? imageLinksInput.value.split(',').map(link => link.trim()) : [],
                    contact: contactInput ? contactInput.value.split(',').map(contact => contact.trim()) : [],
                    type: {
                        type: typeSelect ? typeSelect.value : ""
                    }
                };

                if (ad.type.type === 'BANNER') {
                    ad.type.width = parseInt(item.querySelector(`input[name="ads[${index}].width"]`)?.value) || 0;
                    ad.type.height = parseInt(item.querySelector(`input[name="ads[${index}].height"]`)?.value) || 0;
                } else if (ad.type.type === 'POPUP') {
                    ad.type.delay = parseInt(item.querySelector(`input[name="ads[${index}].delay"]`)?.value) || 0;
                } else if (ad.type.type === 'INTERSTITIAL') {
                    ad.type.fullscreen = item.querySelector(`input[name="ads[${index}].fullscreen"]`)?.checked || false;
                }

                console.log('Processed ad object:', ad);

                // Only include the ad if it has any non-empty fields
                if (ad.name || ad.header || ad.pagelink || ad.imagelinks.length > 0 || ad.contact.length > 0) {
                    ads.push(ad);
                }
            });

            console.log('Final ads array:', ads);
            return ads;
        }

        function showAdTypeFields(selectElement) {
            const adItem = selectElement.closest('.ad-item');
            const bannerFields = adItem.querySelector('.banner-fields');
            const popupFields = adItem.querySelector('.popup-fields');
            const interstitialFields = adItem.querySelector('.interstitial-fields');

            bannerFields.style.display = 'none';
            popupFields.style.display = 'none';
            interstitialFields.style.display = 'none';

            switch (selectElement.value) {
                case 'BANNER':
                    bannerFields.style.display = 'block';
                    break;
                case 'POPUP':
                    popupFields.style.display = 'block';
                    break;
                case 'INTERSTITIAL':
                    interstitialFields.style.display = 'block';
                    break;
            }
        }



        document.addEventListener('DOMContentLoaded', function () {
            const addAdButton = document.getElementById('addAdButton');
            const adsContainer = document.getElementById('adsContainer');
            let adCount = 1;

            addAdButton.addEventListener('click', function () {
                adCount++;
                const newAdHtml = `
            <div class="ad-item">
                <h3>Ad ${adCount}</h3>
                <label for="ad${adCount}Name">Name:</label>
                <input type="text" id="ad${adCount}Name" name="ads[${adCount - 1}].name" value="">

                <label for="ad${adCount}Header">Header:</label>
                <input type="text" id="ad${adCount}Header" name="ads[${adCount - 1}].header" value="">

                <label for="ad${adCount}PageLink">Page Link:</label>
                <input type="url" id="ad${adCount}PageLink" name="ads[${adCount - 1}].pagelink" value="">

                <label for="ad${adCount}ImageLinks">Image Links (comma-separated):</label>
                <input type="text" id="ad${adCount}ImageLinks" name="ads[${adCount - 1}].imagelinks" value="">

                <label for="ad${adCount}Contact">Contact Info (comma-separated):</label>
                <input type="text" id="ad${adCount}Contact" name="ads[${adCount - 1}].contact" value="">

                <label for="ad${adCount}Type">Type:</label>
                <select id="ad${adCount}Type" name="ads[${adCount - 1}].type" onchange="showAdTypeFields(this)">
                    <option value="BANNER">Banner</option>
                    <option value="POPUP">Popup</option>
                    <option value="INTERSTITIAL">Interstitial</option>
                </select>

                <div class="banner-fields" style="display: none;">
                    <label for="ad${adCount}Width">Width:</label>
                    <input type="number" id="ad${adCount}Width" name="ads[${adCount - 1}].width" value="">
                    <label for="ad${adCount}Height">Height:</label>
                    <input type="number" id="ad${adCount}Height" name="ads[${adCount - 1}].height" value="">
                </div>

                <div class="popup-fields" style="display: none;">
                    <label for="ad${adCount}Delay">Delay (ms):</label>
                    <input type="number" id="ad${adCount}Delay" name="ads[${adCount - 1}].delay" value="">
                </div>

                <div class="interstitial-fields" style="display: none;">
                    <label for="ad${adCount}Fullscreen">Fullscreen:</label>
                    <input type="checkbox" id="ad${adCount}Fullscreen" name="ads[${adCount - 1}].fullscreen">
                </div>
            </div>
        `;
                adsContainer.insertAdjacentHTML('beforeend', newAdHtml);
            });
        });



        /////////////

        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM fully loaded and parsed=========>>>');
            async function fetchImagesFromS3() {
                try {
                    const response = await fetch('/api/list-images');
                    if (!response.ok) {
                        throw new Error('Failed to fetch images');
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Error fetching images:', error);
                    showPopup('Failed to fetch images. Please try again.');
                    return [];
                }
            }

            async function handleFetchImages(fetchButton, previewContainer) {
                fetchButton.disabled = true;
                fetchButton.textContent = 'Fetching...';

                try {
                    const imageUrls = await fetchImagesFromS3();
                    previewContainer.innerHTML = '';

                    imageUrls.forEach((url, index) => {
                        const img = document.createElement('img');
                        img.src = url;
                        img.alt = `Image ${index + 1}`;
                        img.style.width = '100px';
                        img.style.height = '100px';
                        img.style.objectFit = 'cover';
                        img.style.margin = '5px';
                        img.style.cursor = 'pointer';
                        img.onclick = () => selectImage(url, previewContainer.id);
                        previewContainer.appendChild(img);
                    });

                    previewContainer.style.display = 'flex';
                    previewContainer.style.flexWrap = 'wrap';
                } catch (error) {
                    console.error('Error handling image fetch:', error);
                    showPopup('Failed to handle image fetch. Please try again.');
                } finally {
                    fetchButton.disabled = false;
                    fetchButton.textContent = 'Fetch Existing Images';
                }
            }

            function selectImage(url, containerId) {
                const section = containerId.replace('PreviewContainer', '');
                const previewImg = document.getElementById(`${section}Preview`);
                const hiddenInput = document.getElementById(`${section}Hidden`);
                const urlDisplay = document.getElementById(`${section}Url`);

                previewImg.src = url;
                previewImg.style.display = 'block';
                hiddenInput.value = url;
                if (urlDisplay) {
                    urlDisplay.textContent = url;
                    urlDisplay.style.display = 'block';
                }

                showPopup('Image selected successfully!');
            }

            async function handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay) {
                console.log('handleImageUpload called');
                const file = fileInput.files[0];
                if (file) {
                    console.log('File selected:', file.name);
                    uploadButton.textContent = 'Uploading...';
                    uploadButton.disabled = true;

                    try {
                        const formData = new FormData();
                        formData.append('file', file);

                        const response = await fetch('/api/upload', {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            throw new Error('Upload failed');
                        }

                        const data = await response.json();
                        const fileUrl = data.url;

                        console.log('File uploaded successfully:', fileUrl);
                        previewImg.src = fileUrl;
                        previewImg.style.display = 'block';
                        hiddenInput.value = fileUrl;
                        if (urlDisplay) {
                            urlDisplay.textContent = fileUrl;
                            urlDisplay.style.display = 'block';
                        }
                        uploadButton.textContent = 'Upload Complete';
                        showPopup('File uploaded successfully!');
                    } catch (error) {
                        console.error('Upload error:', error);
                        uploadButton.textContent = 'Upload Failed';
                        showPopup('File upload failed. Please try again.');
                    } finally {
                        uploadButton.disabled = false;
                    }
                } else {
                    console.log('No file selected');
                    showPopup('Please select a file to upload.');
                }
            }

            async function uploadToS3(file) {
                console.log('Uploading to S3:', file.name);
                const response = await fetch(`/api/get-upload-url?fileName=${file.name}&fileType=${file.type}`);
                const { signedRequest, url } = await response.json();

                await fetch(signedRequest, {
                    method: 'PUT',
                    body: file,
                    headers: { 'Content-Type': file.type }
                });

                return url;
            }

            function showPopup(message) {
                console.log('Showing popup:', message);
                const popup = document.getElementById('popup');
                const popupMessage = document.getElementById('popup-message');
                popupMessage.textContent = message;
                popup.style.display = 'block';

                setTimeout(() => {
                    popup.style.display = 'none';
                }, 3000);
            }

            ['AppLogo', 'AppCompany', 'AppContact'].forEach(section => {
                const uploadButton = document.getElementById(`upload${section}`);
                const fetchButton = document.getElementById(`fetchImages${section}`);
                const fileInput = document.getElementById(section.toLowerCase());
                const previewImg = document.getElementById(`${section.toLowerCase()}Preview`);
                const hiddenInput = document.getElementById(`${section.toLowerCase()}Hidden`);
                const urlDisplay = document.getElementById(`${section.toLowerCase()}Url`);
                const previewContainer = document.getElementById(`${section.toLowerCase()}PreviewContainer`);

                if (uploadButton && fileInput && previewImg && hiddenInput && fetchButton && previewContainer) {
                    console.log(`Setting up event listeners for ${section}`);
                    uploadButton.addEventListener('click', () => {
                        fileInput.click(); // Trigger file input when upload button is clicked
                    });
                    fileInput.addEventListener('change', () => {
                        console.log(`${section} file selected`);
                        handleImageUpload(fileInput, previewImg, hiddenInput, uploadButton, urlDisplay);
                    });
                    fetchButton.addEventListener('click', () => {
                        console.log(`${section} fetch button clicked`);
                        handleFetchImages(fetchButton, previewContainer);
                    });
                } else {
                    console.error(`Missing elements for ${section}`);
                }
            });
        });

        console.log('Event listener added');

        document.getElementById('updateForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('Form submission started');

            try {
                const formData = new FormData(this);
                const jsonData = {
                    header: {
                        startColor: formData.get('header.startColor') || "#ffffff",
                        endColor: formData.get('header.endColor') || "#ffffff"
                    },
                    button: {
                        startColor: formData.get('button.startColor') || "#ee0979",
                        endColor: formData.get('button.endColor') || "#ff6a00"
                    },
                    buttonBackground: {
                        startColor: formData.get('buttonBackground.startColor') || "#ee0979",
                        endColor: formData.get('buttonBackground.endColor') || "#ff6a00"
                    },
                    list_title_size: {
                        color: formData.get('list_title_size.color') || "#333333",
                        backgroundColor: formData.get('list_title_size.backgroundColor') || "#f2f2f2"
                    },
                    listbackground: {
                        backgroundColor: formData.get('listbackground.backgroundColor') || "#ededed"
                    },
                    search_filter: {
                        backgroundColor: formData.get('search_filter.backgroundColor') || "#000000"
                    },
                    list_price_size: parseInt(formData.get('list_price_size')) || 14,
                    markerColor: formData.get('markerColor') || "#e1faeb",
                    constantData: {
                        // ... (keep all the constantData fields as they were)
                    }
                };

                // Check if ads data is not empty
                const adsData = getAdsData();
                if (adsData.length > 0 && adsData.some(ad => Object.values(ad).some(value => value !== ''))) {
                    jsonData.ads = adsData;
                }

                console.log('Prepared JSON data:', JSON.stringify(jsonData, null, 2));

                const response = await fetch('https://propertify.onrender.com/api/colors/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                console.log('Success:', data);
                showPopup('Form submitted successfully!');
            } catch (error) {
                console.error('Error:', error);
                showPopup(`An error occurred while submitting the form: ${error.message}`);
            }
        });



        function showPopup(message) {
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            popupMessage.textContent = message;
            popup.style.display = 'block';

            // Hide the popup after 3 seconds
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function showSeparateAdTypeFields() {
            const adType = document.getElementById('adType').value;
            document.getElementById('separateBannerFields').style.display = adType === 'BANNER' ? 'block' : 'none';
            document.getElementById('separatePopupFields').style.display = adType === 'POPUP' ? 'block' : 'none';
            document.getElementById('separateInterstitialFields').style.display = adType === 'INTERSTITIAL' ? 'block' : 'none';
        }

        // Function to open ad form popup
        function openSeparateAdForm(ad = null) {
            const form = document.getElementById('separateAdForm');
            form.reset();
            if (ad) {
                // Populate form for editing
                Object.keys(ad).forEach(key => {
                    const input = form.elements[key];
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = ad[key];
                        } else if (key === 'type') {
                            input.value = ad[key].type;
                        } else {
                            input.value = Array.isArray(ad[key]) ? ad[key].join(', ') : ad[key];
                        }
                    }
                });
                document.getElementById('adId').value = ad._id;
            } else {
                document.getElementById('adId').value = '';
            }
            showSeparateAdTypeFields();
            document.getElementById('adFormPopup').style.display = 'block';
        }

        // Function to close ad form popup
        function closeSeparateAdForm() {
            document.getElementById('adFormPopup').style.display = 'none';
        }

        // Function to add or update an ad
        function openSeparateAdForm(ad = null) {
            const form = document.getElementById('separateAdForm');
            form.reset();
            if (ad) {
                // Populate form for editing
                Object.keys(ad).forEach(key => {
                    const input = form.elements[key];
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = ad[key];
                        } else if (key === 'type') {
                            input.value = ad[key].type;
                        } else if (key === 'imagelinks' || key === 'contact') {
                            input.value = ad[key].join(', ');
                        } else {
                            input.value = ad[key];
                        }
                    }
                });
                document.getElementById('adId').value = ad._id;
            } else {
                document.getElementById('adId').value = '';
            }
            showSeparateAdTypeFields();
            document.getElementById('adFormPopup').style.display = 'block';
        }

        // Function to add or update an ad
        async function saveSeparateAd(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const adData = Object.fromEntries(formData.entries());

            adData.type = { type: adData.type };

            // Add type-specific fields
            if (adData.type.type === 'BANNER') {
                adData.type.width = parseInt(adData.width) || 0;
                adData.type.height = parseInt(adData.height) || 0;
            } else if (adData.type.type === 'POPUP') {
                adData.type.delay = parseInt(adData.delay) || 0;
            } else if (adData.type.type === 'INTERSTITIAL') {
                adData.type.fullscreen = adData.fullscreen === 'on';
            }

            // Convert imagelinks and contact to arrays
            adData.imagelinks = adData.imagelinks.split(',').map(link => link.trim());
            adData.contact = adData.contact.split(',').map(contact => contact.trim());

            try {
                // Fetch existing ads
                const response = await fetch('https://propertify.onrender.com/api/colors/ads');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                let ads = await response.json();

                if (adData.adId) {
                    // Edit existing ad
                    const index = ads.findIndex(ad => ad._id === adData.adId);
                    if (index !== -1) {
                        ads[index] = { ...ads[index], ...adData };
                    }
                } else {
                    // Add new ad
                    ads.push(adData);
                }

                // Update all ads
                const updateResponse = await fetch('https://propertify.onrender.com/api/colors/update-ads', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ads: ads })
                });

                if (!updateResponse.ok) {
                    throw new Error(`HTTP error! status: ${updateResponse.status}`);
                }

                console.log('Ad saved successfully');
                closeSeparateAdForm();
                listSeparateAds(); // Refresh the ads list
            } catch (error) {
                console.error('Error saving ad:', error);
                alert('Failed to save ad. Please try again.');
            }
        }

        // Function to list all ads
        async function listSeparateAds() {
            try {
                const response = await fetch('https://propertify.onrender.com/api/colors/ads');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const ads = await response.json();
                const adsList = document.getElementById('adsList');
                adsList.innerHTML = '';
                ads.forEach(ad => {
                    const adElement = document.createElement('div');
                    adElement.innerHTML = `
                <h4>${ad.name}</h4>
                <p>Type: ${ad.type.type}</p>
                <button onclick='openSeparateAdForm(${JSON.stringify(ad)})'>Edit</button>
                <button onclick="deleteSeparateAd('${ad._id}')">Delete</button>
            `;
                    adsList.appendChild(adElement);
                });
            } catch (error) {
                console.error('Error listing ads:', error);
                alert('Failed to list ads. Please try again.');
            }
        }

        // Function to delete an ad
        async function deleteSeparateAd(adId) {
            if (confirm('Are you sure you want to delete this ad?')) {
                try {
                    // Fetch existing ads
                    const response = await fetch('https://propertify.onrender.com/api/colors/ads');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    let ads = await response.json();

                    // Remove the ad with the given adId
                    ads = ads.filter(ad => ad._id !== adId);

                    // Update ads
                    const updateResponse = await fetch('https://propertify.onrender.com/api/colors/update-ads', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ads: ads })
                    });

                    if (!updateResponse.ok) {
                        throw new Error(`HTTP error! status: ${updateResponse.status}`);
                    }

                    console.log('Ad deleted successfully');
                    listSeparateAds(); // Refresh the ads list
                } catch (error) {
                    console.error('Error deleting ad:', error);
                    alert('Failed to delete ad. Please try again.');
                }
            }
            if (confirm('Are you sure you want to delete this ad?')) {
                try {
                    const response = await fetch(`https://propertify.onrender.com/api/colors/ads/${adId}`, {
                        method: 'DELETE'
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    console.log('Ad deleted successfully');
                    listSeparateAds(); // Refresh the ads list
                } catch (error) {
                    console.error('Error deleting ad:', error);
                    alert('Failed to delete ad. Please try again.');
                }
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('addNewAdButton').addEventListener('click', () => openSeparateAdForm());
            document.getElementById('listAdsButton').addEventListener('click', listSeparateAds);
            document.getElementById('separateAdForm').addEventListener('submit', saveSeparateAd);
        });

    </script>
</body>

</html>